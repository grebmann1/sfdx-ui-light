/*! For license information please see bundle.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("OpenAIAgentsBundle",[],t):"object"==typeof exports?exports.OpenAIAgentsBundle=t():e.OpenAIAgentsBundle=t()}(this,()=>(()=>{var e={251:(e,t)=>{t.read=function(e,t,n,s,r){var a,i,o=8*r-s-1,u=(1<<o)-1,c=u>>1,l=-7,d=n?r-1:0,p=n?-1:1,h=e[t+d];for(d+=p,a=h&(1<<-l)-1,h>>=-l,l+=o;l>0;a=256*a+e[t+d],d+=p,l-=8);for(i=a&(1<<-l)-1,a>>=-l,l+=s;l>0;i=256*i+e[t+d],d+=p,l-=8);if(0===a)a=1-c;else{if(a===u)return i?NaN:1/0*(h?-1:1);i+=Math.pow(2,s),a-=c}return(h?-1:1)*i*Math.pow(2,a-s)},t.write=function(e,t,n,s,r,a){var i,o,u,c=8*a-r-1,l=(1<<c)-1,d=l>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,h=s?0:a-1,f=s?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,i=l):(i=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-i))<1&&(i--,u*=2),(t+=i+d>=1?p/u:p*Math.pow(2,1-d))*u>=2&&(i++,u/=2),i+d>=l?(o=0,i=l):i+d>=1?(o=(t*u-1)*Math.pow(2,r),i+=d):(o=t*Math.pow(2,d-1)*Math.pow(2,r),i=0));r>=8;e[n+h]=255&o,h+=f,o/=256,r-=8);for(i=i<<r|o,c+=r;c>0;e[n+h]=255&i,h+=f,i/=256,c-=8);e[n+h-f]|=128*m}},271:(e,t,n)=>{"use strict";var s=n(526),r=n(251),a="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.hp=u,t.IS=50;var i=2147483647;function o(e){if(e>i)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,u.prototype),t}function u(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return d(e)}return c(e,t,n)}function c(e,t,n){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!u.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|m(e,t),s=o(n),r=s.write(e,t);return r!==n&&(s=s.slice(0,r)),s}(e,t);if(ArrayBuffer.isView(e))return function(e){if(U(e,Uint8Array)){var t=new Uint8Array(e);return h(t.buffer,t.byteOffset,t.byteLength)}return p(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(U(e,ArrayBuffer)||e&&U(e.buffer,ArrayBuffer))return h(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(U(e,SharedArrayBuffer)||e&&U(e.buffer,SharedArrayBuffer)))return h(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var s=e.valueOf&&e.valueOf();if(null!=s&&s!==e)return u.from(s,t,n);var r=function(e){if(u.isBuffer(e)){var t=0|f(e.length),n=o(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||B(e.length)?o(0):p(e):"Buffer"===e.type&&Array.isArray(e.data)?p(e.data):void 0}(e);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return l(e),o(e<0?0:0|f(e))}function p(e){for(var t=e.length<0?0:0|f(e.length),n=o(t),s=0;s<t;s+=1)n[s]=255&e[s];return n}function h(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var s;return s=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(s,u.prototype),s}function f(e){if(e>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return 0|e}function m(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||U(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,s=arguments.length>2&&!0===arguments[2];if(!s&&0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return L(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Z(e).length;default:if(r)return s?-1:L(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){var s=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return E(this,t,n);case"utf8":case"utf-8":return A(this,t,n);case"ascii":return C(this,t,n);case"latin1":case"binary":return O(this,t,n);case"base64":return T(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,n);default:if(s)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),s=!0}}function y(e,t,n){var s=e[t];e[t]=e[n],e[n]=s}function _(e,t,n,s,r){if(0===e.length)return-1;if("string"==typeof n?(s=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),B(n=+n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=u.from(t,s)),u.isBuffer(t))return 0===t.length?-1:v(e,t,n,s,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,s,r);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,s,r){var a,i=1,o=e.length,u=t.length;if(void 0!==s&&("ucs2"===(s=String(s).toLowerCase())||"ucs-2"===s||"utf16le"===s||"utf-16le"===s)){if(e.length<2||t.length<2)return-1;i=2,o/=2,u/=2,n/=2}function c(e,t){return 1===i?e[t]:e.readUInt16BE(t*i)}if(r){var l=-1;for(a=n;a<o;a++)if(c(e,a)===c(t,-1===l?0:a-l)){if(-1===l&&(l=a),a-l+1===u)return l*i}else-1!==l&&(a-=a-l),l=-1}else for(n+u>o&&(n=o-u),a=n;a>=0;a--){for(var d=!0,p=0;p<u;p++)if(c(e,a+p)!==c(t,p)){d=!1;break}if(d)return a}return-1}function w(e,t,n,s){n=Number(n)||0;var r=e.length-n;s?(s=Number(s))>r&&(s=r):s=r;var a=t.length;s>a/2&&(s=a/2);for(var i=0;i<s;++i){var o=parseInt(t.substr(2*i,2),16);if(B(o))return i;e[n+i]=o}return i}function b(e,t,n,s){return F(L(t,e.length-n),e,n,s)}function x(e,t,n,s){return F(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,s)}function S(e,t,n,s){return F(Z(t),e,n,s)}function k(e,t,n,s){return F(function(e,t){for(var n,s,r,a=[],i=0;i<e.length&&!((t-=2)<0);++i)s=(n=e.charCodeAt(i))>>8,r=n%256,a.push(r),a.push(s);return a}(t,e.length-n),e,n,s)}function T(e,t,n){return 0===t&&n===e.length?s.fromByteArray(e):s.fromByteArray(e.slice(t,n))}function A(e,t,n){n=Math.min(e.length,n);for(var s=[],r=t;r<n;){var a,i,o,u,c=e[r],l=null,d=c>239?4:c>223?3:c>191?2:1;if(r+d<=n)switch(d){case 1:c<128&&(l=c);break;case 2:128==(192&(a=e[r+1]))&&(u=(31&c)<<6|63&a)>127&&(l=u);break;case 3:a=e[r+1],i=e[r+2],128==(192&a)&&128==(192&i)&&(u=(15&c)<<12|(63&a)<<6|63&i)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:a=e[r+1],i=e[r+2],o=e[r+3],128==(192&a)&&128==(192&i)&&128==(192&o)&&(u=(15&c)<<18|(63&a)<<12|(63&i)<<6|63&o)>65535&&u<1114112&&(l=u)}null===l?(l=65533,d=1):l>65535&&(l-=65536,s.push(l>>>10&1023|55296),l=56320|1023&l),s.push(l),r+=d}return function(e){var t=e.length;if(t<=I)return String.fromCharCode.apply(String,e);for(var n="",s=0;s<t;)n+=String.fromCharCode.apply(String,e.slice(s,s+=I));return n}(s)}u.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),u.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),u.poolSize=8192,u.from=function(e,t,n){return c(e,t,n)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array),u.alloc=function(e,t,n){return function(e,t,n){return l(e),e<=0?o(e):void 0!==t?"string"==typeof n?o(e).fill(t,n):o(e).fill(t):o(e)}(e,t,n)},u.allocUnsafe=function(e){return d(e)},u.allocUnsafeSlow=function(e){return d(e)},u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(U(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),U(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,s=t.length,r=0,a=Math.min(n,s);r<a;++r)if(e[r]!==t[r]){n=e[r],s=t[r];break}return n<s?-1:s<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var s=u.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var a=e[n];if(U(a,Uint8Array))r+a.length>s.length?u.from(a).copy(s,r):Uint8Array.prototype.set.call(s,a,r);else{if(!u.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(s,r)}r+=a.length}return s},u.byteLength=m,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)y(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},u.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?A(this,0,e):g.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.IS;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},a&&(u.prototype[a]=u.prototype.inspect),u.prototype.compare=function(e,t,n,s,r){if(U(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===s&&(s=0),void 0===r&&(r=this.length),t<0||n>e.length||s<0||r>this.length)throw new RangeError("out of range index");if(s>=r&&t>=n)return 0;if(s>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(r>>>=0)-(s>>>=0),i=(n>>>=0)-(t>>>=0),o=Math.min(a,i),c=this.slice(s,r),l=e.slice(t,n),d=0;d<o;++d)if(c[d]!==l[d]){a=c[d],i=l[d];break}return a<i?-1:i<a?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return _(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return _(this,e,t,n,!1)},u.prototype.write=function(e,t,n,s){if(void 0===t)s="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)s=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===s&&(s="utf8")):(s=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");s||(s="utf8");for(var a=!1;;)switch(s){case"hex":return w(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":case"latin1":case"binary":return x(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase(),a=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var I=4096;function C(e,t,n){var s="";n=Math.min(e.length,n);for(var r=t;r<n;++r)s+=String.fromCharCode(127&e[r]);return s}function O(e,t,n){var s="";n=Math.min(e.length,n);for(var r=t;r<n;++r)s+=String.fromCharCode(e[r]);return s}function E(e,t,n){var s=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>s)&&(n=s);for(var r="",a=t;a<n;++a)r+=q[e[a]];return r}function R(e,t,n){for(var s=e.slice(t,n),r="",a=0;a<s.length-1;a+=2)r+=String.fromCharCode(s[a]+256*s[a+1]);return r}function P(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function N(e,t,n,s,r,a){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<a)throw new RangeError('"value" argument is out of bounds');if(n+s>e.length)throw new RangeError("Index out of range")}function $(e,t,n,s,r,a){if(n+s>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function D(e,t,n,s,a){return t=+t,n>>>=0,a||$(e,0,n,4),r.write(e,t,n,s,23,4),n+4}function j(e,t,n,s,a){return t=+t,n>>>=0,a||$(e,0,n,8),r.write(e,t,n,s,52,8),n+8}u.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var s=this.subarray(e,t);return Object.setPrototypeOf(s,u.prototype),s},u.prototype.readUintLE=u.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);for(var s=this[e],r=1,a=0;++a<t&&(r*=256);)s+=this[e+a]*r;return s},u.prototype.readUintBE=u.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);for(var s=this[e+--t],r=1;t>0&&(r*=256);)s+=this[e+--t]*r;return s},u.prototype.readUint8=u.prototype.readUInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),this[e]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);for(var s=this[e],r=1,a=0;++a<t&&(r*=256);)s+=this[e+a]*r;return s>=(r*=128)&&(s-=Math.pow(2,8*t)),s},u.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);for(var s=t,r=1,a=this[e+--s];s>0&&(r*=256);)a+=this[e+--s]*r;return a>=(r*=128)&&(a-=Math.pow(2,8*t)),a},u.prototype.readInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||P(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){e>>>=0,t||P(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return e>>>=0,t||P(e,4,this.length),r.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||P(e,4,this.length),r.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||P(e,8,this.length),r.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||P(e,8,this.length),r.read(this,e,!1,52,8)},u.prototype.writeUintLE=u.prototype.writeUIntLE=function(e,t,n,s){e=+e,t>>>=0,n>>>=0,s||N(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,a=0;for(this[t]=255&e;++a<n&&(r*=256);)this[t+a]=e/r&255;return t+n},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(e,t,n,s){e=+e,t>>>=0,n>>>=0,s||N(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,a=1;for(this[t+r]=255&e;--r>=0&&(a*=256);)this[t+r]=e/a&255;return t+n},u.prototype.writeUint8=u.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeIntLE=function(e,t,n,s){if(e=+e,t>>>=0,!s){var r=Math.pow(2,8*n-1);N(this,e,t,n,r-1,-r)}var a=0,i=1,o=0;for(this[t]=255&e;++a<n&&(i*=256);)e<0&&0===o&&0!==this[t+a-1]&&(o=1),this[t+a]=(e/i|0)-o&255;return t+n},u.prototype.writeIntBE=function(e,t,n,s){if(e=+e,t>>>=0,!s){var r=Math.pow(2,8*n-1);N(this,e,t,n,r-1,-r)}var a=n-1,i=1,o=0;for(this[t+a]=255&e;--a>=0&&(i*=256);)e<0&&0===o&&0!==this[t+a+1]&&(o=1),this[t+a]=(e/i|0)-o&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeFloatLE=function(e,t,n){return D(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return D(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,s){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),s||0===s||(s=this.length),t>=e.length&&(t=e.length),t||(t=0),s>0&&s<n&&(s=n),s===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(s<0)throw new RangeError("sourceEnd out of bounds");s>this.length&&(s=this.length),e.length-t<s-n&&(s=e.length-t+n);var r=s-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,s):Uint8Array.prototype.set.call(e,this.subarray(n,s),t),r},u.prototype.fill=function(e,t,n,s){if("string"==typeof e){if("string"==typeof t?(s=t,t=0,n=this.length):"string"==typeof n&&(s=n,n=this.length),void 0!==s&&"string"!=typeof s)throw new TypeError("encoding must be a string");if("string"==typeof s&&!u.isEncoding(s))throw new TypeError("Unknown encoding: "+s);if(1===e.length){var r=e.charCodeAt(0);("utf8"===s&&r<128||"latin1"===s)&&(e=r)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var i=u.isBuffer(e)?e:u.from(e,s),o=i.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(a=0;a<n-t;++a)this[a+t]=i[a%o]}return this};var M=/[^+/0-9A-Za-z-_]/g;function L(e,t){var n;t=t||1/0;for(var s=e.length,r=null,a=[],i=0;i<s;++i){if((n=e.charCodeAt(i))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(i+1===s){(t-=3)>-1&&a.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&a.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function Z(e){return s.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(M,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function F(e,t,n,s){for(var r=0;r<s&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function U(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function B(e){return e!=e}var q=function(){for(var e="0123456789abcdef",t=new Array(256),n=0;n<16;++n)for(var s=16*n,r=0;r<16;++r)t[s+r]=e[n]+e[r];return t}()},526:(e,t)=>{"use strict";t.byteLength=function(e){var t=o(e),n=t[0],s=t[1];return 3*(n+s)/4-s},t.toByteArray=function(e){var t,n,a=o(e),i=a[0],u=a[1],c=new r(function(e,t,n){return 3*(t+n)/4-n}(0,i,u)),l=0,d=u>0?i-4:i;for(n=0;n<d;n+=4)t=s[e.charCodeAt(n)]<<18|s[e.charCodeAt(n+1)]<<12|s[e.charCodeAt(n+2)]<<6|s[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;return 2===u&&(t=s[e.charCodeAt(n)]<<2|s[e.charCodeAt(n+1)]>>4,c[l++]=255&t),1===u&&(t=s[e.charCodeAt(n)]<<10|s[e.charCodeAt(n+1)]<<4|s[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t),c},t.fromByteArray=function(e){for(var t,s=e.length,r=s%3,a=[],i=16383,o=0,u=s-r;o<u;o+=i)a.push(c(e,o,o+i>u?u:o+i));return 1===r?(t=e[s-1],a.push(n[t>>2]+n[t<<4&63]+"==")):2===r&&(t=(e[s-2]<<8)+e[s-1],a.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),a.join("")};for(var n=[],s=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0;i<64;++i)n[i]=a[i],s[a.charCodeAt(i)]=i;function o(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e){return n[e>>18&63]+n[e>>12&63]+n[e>>6&63]+n[63&e]}function c(e,t,n){for(var s,r=[],a=t;a<n;a+=3)s=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),r.push(u(s));return r.join("")}s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},585:e=>{var t=1e3,n=60*t,s=60*n,r=24*s,a=7*r;function i(e,t,n,s){var r=t>=1.5*n;return Math.round(e/n)+" "+s+(r?"s":"")}e.exports=function(e,o){o=o||{};var u,c,l=typeof e;if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var i=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(i){var o=parseFloat(i[1]);switch((i[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return o*a;case"days":case"day":case"d":return o*r;case"hours":case"hour":case"hrs":case"hr":case"h":return o*s;case"minutes":case"minute":case"mins":case"min":case"m":return o*n;case"seconds":case"second":case"secs":case"sec":case"s":return o*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if("number"===l&&isFinite(e))return o.long?(u=e,(c=Math.abs(u))>=r?i(u,c,r,"day"):c>=s?i(u,c,s,"hour"):c>=n?i(u,c,n,"minute"):c>=t?i(u,c,t,"second"):u+" ms"):function(e){var a=Math.abs(e);return a>=r?Math.round(e/r)+"d":a>=s?Math.round(e/s)+"h":a>=n?Math.round(e/n)+"m":a>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},736:(e,t,n)=>{e.exports=function(e){function t(e){let n,r,a,i=null;function o(...e){if(!o.enabled)return;const s=o,r=Number(new Date),a=r-(n||r);s.diff=a,s.prev=n,s.curr=r,n=r,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(n,r)=>{if("%%"===n)return"%";i++;const a=t.formatters[r];if("function"==typeof a){const t=e[i];n=a.call(s,t),e.splice(i,1),i--}return n}),t.formatArgs.call(s,e),(s.log||t.log).apply(s,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=s,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==i?i:(r!==t.namespaces&&(r=t.namespaces,a=t.enabled(e)),a),set:e=>{i=e}}),"function"==typeof t.init&&t.init(o),o}function s(e,n){const s=t(this.namespace+(void 0===n?":":n)+e);return s.log=this.log,s}function r(e,t){let n=0,s=0,r=-1,a=0;for(;n<e.length;)if(s<t.length&&(t[s]===e[n]||"*"===t[s]))"*"===t[s]?(r=s,a=n,s++):(n++,s++);else{if(-1===r)return!1;s=r+1,a++,n=a}for(;s<t.length&&"*"===t[s];)s++;return s===t.length}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names,...t.skips.map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const e of n)"-"===e[0]?t.skips.push(e.slice(1)):t.names.push(e)},t.enabled=function(e){for(const n of t.skips)if(r(e,n))return!1;for(const n of t.names)if(r(e,n))return!0;return!1},t.humanize=n(585),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(n=>{t[n]=e[n]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},833:(e,t,n)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let s=0,r=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(s++,"%c"===e&&(r=s))}),t.splice(r,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(736)(t);const{formatters:s}=e.exports;s.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,n),a.exports}n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return(()=>{"use strict";n.r(s),n.d(s,{Agents:()=>i,AgentsCore:()=>t,AgentsOpenAI:()=>r});var e={};n.r(e),n.d(e,{AssistantContent:()=>oi,AssistantMessageItem:()=>ci,AudioContent:()=>ti,ComputerCallResultItem:()=>_i,ComputerToolOutput:()=>ai,ComputerUseCallItem:()=>yi,FunctionCallItem:()=>mi,FunctionCallResultItem:()=>gi,HostedToolCallItem:()=>fi,ImageContent:()=>ni,InputFile:()=>ei,InputImage:()=>Qa,InputText:()=>Xa,ItemBase:()=>Ka,MessageItem:()=>hi,ModelItem:()=>Si,OutputModelItem:()=>xi,OutputText:()=>Va,ReasoningItem:()=>wi,ReasoningText:()=>Ya,Refusal:()=>Ha,SharedBase:()=>Ga,StreamEvent:()=>Oi,StreamEventGenericItem:()=>Ci,StreamEventResponseCompleted:()=>Ii,StreamEventResponseStarted:()=>Ai,StreamEventTextStream:()=>Ti,ToolCallItem:()=>vi,ToolOutputImage:()=>ri,ToolOutputText:()=>si,UnknownItem:()=>bi,UsageData:()=>ki,UserContent:()=>li,UserMessageItem:()=>di,computerActions:()=>ii});var t={};n.r(t),n.d(t,{Agent:()=>$o,AgentHooks:()=>ja,AgentsError:()=>Wt,BatchTraceProcessor:()=>Jr,ConsoleSpanExporter:()=>zr,GuardrailExecutionError:()=>Xt,Handoff:()=>Ua,InputGuardrailTripwireTriggered:()=>Qt,MCPServerSSE:()=>yr,MCPServerStdio:()=>mr,MCPServerStreamableHttp:()=>gr,MaxTurnsExceededError:()=>Kt,ModelBehaviorError:()=>Ht,NoopSpan:()=>na,NoopTrace:()=>ra,OutputGuardrailTripwireTriggered:()=>en,RunAgentUpdatedStreamEvent:()=>Hi,RunContext:()=>Ri,RunHandoffCallItem:()=>Bi,RunHandoffOutputItem:()=>qi,RunItemStreamEvent:()=>Ki,RunMessageOutputItem:()=>Li,RunRawModelStreamEvent:()=>Gi,RunReasoningItem:()=>Ui,RunResult:()=>Ni,RunState:()=>ko,RunToolApprovalItem:()=>zi,RunToolCallItem:()=>Zi,RunToolCallOutputItem:()=>Fi,Runner:()=>Eo,RuntimeEventEmitter:()=>Ar,Span:()=>ta,StreamedRunResult:()=>$i,SystemError:()=>Gt,ToolCallError:()=>Yt,Trace:()=>sa,TraceProvider:()=>aa,Usage:()=>Ei,UserError:()=>Vt,addTraceProcessor:()=>Ra,assistant:()=>Mo,computerTool:()=>gn,createAgentSpan:()=>da,createCustomSpan:()=>va,createFunctionSpan:()=>ha,createGenerationSpan:()=>ya,createGuardrailSpan:()=>ba,createHandoffSpan:()=>ma,createMCPListToolsSpan:()=>Oa,createMCPToolStaticFilter:()=>Lo,createResponseSpan:()=>ca,createSpeechGroupSpan:()=>Ia,createSpeechSpan:()=>Ta,createTranscriptionSpan:()=>Sa,defineOutputGuardrail:()=>Za,extractAllTextOutput:()=>Ji,generateGroupId:()=>ea,generateSpanId:()=>Qr,generateTraceId:()=>Yr,getAllMcpTools:()=>br,getCurrentSpan:()=>jr,getCurrentTrace:()=>Dr,getGlobalTraceProvider:()=>oa,getHandoff:()=>qa,getLogger:()=>pn,getOrCreateTrace:()=>Zr,getTransferMessage:()=>Fa,handoff:()=>Ba,hostedMcpTool:()=>yn,invalidateServerToolsCache:()=>vr,mcpToFunctionTool:()=>xr,protocol:()=>e,resetCurrentSpan:()=>Ur,run:()=>No,setCurrentSpan:()=>Fr,setDefaultModelProvider:()=>Ja,setTraceProcessors:()=>Pa,setTracingDisabled:()=>Na,startTraceExportLoop:()=>$a,system:()=>jo,tool:()=>vn,user:()=>Do,withAgentSpan:()=>pa,withCustomSpan:()=>wa,withFunctionSpan:()=>fa,withGenerationSpan:()=>_a,withGuardrailSpan:()=>xa,withHandoffSpan:()=>ga,withMCPListToolsSpan:()=>Ea,withResponseSpan:()=>la,withSpeechGroupSpan:()=>Ca,withSpeechSpan:()=>Aa,withTrace:()=>Lr,withTranscriptionSpan:()=>ka});var r={};n.r(r),n.d(r,{OpenAIChatCompletionsModel:()=>bp,OpenAIProvider:()=>xp,OpenAIResponsesModel:()=>hp,OpenAITracingExporter:()=>Sp,codeInterpreterTool:()=>tp,fileSearchTool:()=>ep,imageGenerationTool:()=>np,setDefaultOpenAIClient:()=>Jd,setDefaultOpenAIKey:()=>Wd,setDefaultOpenAITracingExporter:()=>kp,setOpenAIAPI:()=>zd,setTracingExportApiKey:()=>qd,webSearchTool:()=>Qd});var a={};n.r(a),n.d(a,{DEFAULT_OPENAI_REALTIME_MODEL:()=>Dh,DEFAULT_OPENAI_REALTIME_SESSION_CONFIG:()=>jh,ModelBehaviorError:()=>Ht,OpenAIRealtimeBase:()=>Mh,OpenAIRealtimeWebRTC:()=>Lh,OpenAIRealtimeWebSocket:()=>Fh,OutputGuardrailTripwireTriggered:()=>en,RealtimeAgent:()=>Np,RealtimeSession:()=>Uh,UserError:()=>Vt,tool:()=>vn,utils:()=>Bh});var i={};async function o(e){try{return[null,await e()]}catch(e){return[e,null]}}function u(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}n.r(i),n.d(i,{Agent:()=>$o,AgentHooks:()=>ja,AgentsError:()=>Wt,BatchTraceProcessor:()=>Jr,ConsoleSpanExporter:()=>zr,GuardrailExecutionError:()=>Xt,Handoff:()=>Ua,InputGuardrailTripwireTriggered:()=>Qt,MCPServerSSE:()=>yr,MCPServerStdio:()=>mr,MCPServerStreamableHttp:()=>gr,MaxTurnsExceededError:()=>Kt,ModelBehaviorError:()=>Ht,NoopSpan:()=>na,NoopTrace:()=>ra,OpenAIChatCompletionsModel:()=>bp,OpenAIProvider:()=>xp,OpenAIResponsesModel:()=>hp,OpenAITracingExporter:()=>Sp,OutputGuardrailTripwireTriggered:()=>en,RunAgentUpdatedStreamEvent:()=>Hi,RunContext:()=>Ri,RunHandoffCallItem:()=>Bi,RunHandoffOutputItem:()=>qi,RunItemStreamEvent:()=>Ki,RunMessageOutputItem:()=>Li,RunRawModelStreamEvent:()=>Gi,RunReasoningItem:()=>Ui,RunResult:()=>Ni,RunState:()=>ko,RunToolApprovalItem:()=>zi,RunToolCallItem:()=>Zi,RunToolCallOutputItem:()=>Fi,Runner:()=>Eo,RuntimeEventEmitter:()=>Ar,Span:()=>ta,StreamedRunResult:()=>$i,SystemError:()=>Gt,ToolCallError:()=>Yt,Trace:()=>sa,TraceProvider:()=>aa,Usage:()=>Ei,UserError:()=>Vt,addTraceProcessor:()=>Ra,assistant:()=>Mo,codeInterpreterTool:()=>tp,computerTool:()=>gn,createAgentSpan:()=>da,createCustomSpan:()=>va,createFunctionSpan:()=>ha,createGenerationSpan:()=>ya,createGuardrailSpan:()=>ba,createHandoffSpan:()=>ma,createMCPListToolsSpan:()=>Oa,createMCPToolStaticFilter:()=>Lo,createResponseSpan:()=>ca,createSpeechGroupSpan:()=>Ia,createSpeechSpan:()=>Ta,createTranscriptionSpan:()=>Sa,defineOutputGuardrail:()=>Za,extractAllTextOutput:()=>Ji,fileSearchTool:()=>ep,generateGroupId:()=>ea,generateSpanId:()=>Qr,generateTraceId:()=>Yr,getAllMcpTools:()=>br,getCurrentSpan:()=>jr,getCurrentTrace:()=>Dr,getGlobalTraceProvider:()=>oa,getHandoff:()=>qa,getLogger:()=>pn,getOrCreateTrace:()=>Zr,getTransferMessage:()=>Fa,handoff:()=>Ba,hostedMcpTool:()=>yn,imageGenerationTool:()=>np,invalidateServerToolsCache:()=>vr,mcpToFunctionTool:()=>xr,protocol:()=>e,realtime:()=>a,resetCurrentSpan:()=>Ur,run:()=>No,setCurrentSpan:()=>Fr,setDefaultModelProvider:()=>Ja,setDefaultOpenAIClient:()=>Jd,setDefaultOpenAIKey:()=>Wd,setDefaultOpenAITracingExporter:()=>kp,setOpenAIAPI:()=>zd,setTraceProcessors:()=>Pa,setTracingDisabled:()=>Na,setTracingExportApiKey:()=>qd,startTraceExportLoop:()=>$a,system:()=>jo,tool:()=>vn,user:()=>Do,webSearchTool:()=>Qd,withAgentSpan:()=>pa,withCustomSpan:()=>wa,withFunctionSpan:()=>fa,withGenerationSpan:()=>_a,withGuardrailSpan:()=>xa,withHandoffSpan:()=>ga,withMCPListToolsSpan:()=>Ea,withResponseSpan:()=>la,withSpeechGroupSpan:()=>Ca,withSpeechSpan:()=>Aa,withTrace:()=>Lr,withTranscriptionSpan:()=>ka});const c=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};class l extends Error{}class d extends l{constructor(e,t,n,s){super(`${d.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.requestID=s?.get("x-request-id"),this.error=t;const r=t;this.code=r?.code,this.param=r?.param,this.type=r?.type}static makeMessage(e,t,n){const s=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new h({message:n,cause:c(t)});const r=t?.error;return 400===e?new m(e,r,n,s):401===e?new g(e,r,n,s):403===e?new y(e,r,n,s):404===e?new _(e,r,n,s):409===e?new v(e,r,n,s):422===e?new w(e,r,n,s):429===e?new b(e,r,n,s):e>=500?new x(e,r,n,s):new d(e,r,n,s)}}class p extends d{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class h extends d{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class f extends h{constructor({message:e}={}){super({message:e??"Request timed out."})}}class m extends d{}class g extends d{}class y extends d{}class _ extends d{}class v extends d{}class w extends d{}class b extends d{}class x extends d{}class S extends l{constructor(){super("Could not parse response content as the length limit was reached")}}class k extends l{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class T extends Error{constructor(e){super(e)}}function A(e){return void 0!==e&&"function"in e&&void 0!==e.function}function I(e){return"auto-parseable-response-format"===e?.$brand}function C(e){return"auto-parseable-tool"===e?.$brand}function O(e,t){const n=e.choices.map(e=>{if("length"===e.finish_reason)throw new S;if("content_filter"===e.finish_reason)throw new k;return N(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>function(e,t){const n=e.tools?.find(e=>A(e)&&e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:C(n)?n.$parseRaw(t.function.arguments):n?.function.strict?JSON.parse(t.function.arguments):null}}}(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?E(t,e.message.content):null}}});return{...e,choices:n}}function E(e,t){return"json_schema"!==e.response_format?.type?null:"json_schema"===e.response_format?.type?"$parseRaw"in e.response_format?e.response_format.$parseRaw(t):JSON.parse(t):null}function R(e,t){if(!e||!("tools"in e)||!e.tools)return!1;const n=e.tools?.find(e=>A(e)&&e.function?.name===t.function.name);return A(n)&&(C(n)||n?.function.strict||!1)}function P(e){return!!I(e.response_format)||(e.tools?.some(e=>C(e)||"function"===e.type&&!0===e.function.strict)??!1)}function N(e){for(const t of e||[])if("function"!==t.type)throw new l(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}const $=Symbol("Let zodToJsonSchema decide on which parser to use"),D={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},j=e=>"_def"in e?e._def:e;var M,L;!function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const n of e)t[n]=n;return t},e.getValidEnumValues=t=>{const n=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),s={};for(const e of n)s[e]=t[e];return e.objectValues(s)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},e.find=(e,t)=>{for(const n of e)if(t(n))return n},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(M||(M={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(L||(L={}));const Z=M.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),F=e=>{switch(typeof e){case"undefined":return Z.undefined;case"string":return Z.string;case"number":return Number.isNaN(e)?Z.nan:Z.number;case"boolean":return Z.boolean;case"function":return Z.function;case"bigint":return Z.bigint;case"symbol":return Z.symbol;case"object":return Array.isArray(e)?Z.array:null===e?Z.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?Z.promise:"undefined"!=typeof Map&&e instanceof Map?Z.map:"undefined"!=typeof Set&&e instanceof Set?Z.set:"undefined"!=typeof Date&&e instanceof Date?Z.date:Z.object;default:return Z.unknown}},U=M.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class B extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},n={_errors:[]},s=e=>{for(const r of e.issues)if("invalid_union"===r.code)r.unionErrors.map(s);else if("invalid_return_type"===r.code)s(r.returnTypeError);else if("invalid_arguments"===r.code)s(r.argumentsError);else if(0===r.path.length)n._errors.push(t(r));else{let e=n,s=0;for(;s<r.path.length;){const n=r.path[s];s===r.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(r))):e[n]=e[n]||{_errors:[]},e=e[n],s++}}};return s(this),n}static assert(e){if(!(e instanceof B))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,M.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},n=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}B.create=e=>new B(e);const q=(e,t)=>{let n;switch(e.code){case U.invalid_type:n=e.received===Z.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case U.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,M.jsonStringifyReplacer)}`;break;case U.unrecognized_keys:n=`Unrecognized key(s) in object: ${M.joinValues(e.keys,", ")}`;break;case U.invalid_union:n="Invalid input";break;case U.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${M.joinValues(e.options)}`;break;case U.invalid_enum_value:n=`Invalid enum value. Expected ${M.joinValues(e.options)}, received '${e.received}'`;break;case U.invalid_arguments:n="Invalid function arguments";break;case U.invalid_return_type:n="Invalid function return type";break;case U.invalid_date:n="Invalid date";break;case U.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:M.assertNever(e.validation):n="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case U.too_small:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case U.too_big:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case U.custom:n="Invalid input";break;case U.invalid_intersection_types:n="Intersection results could not be merged";break;case U.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case U.not_finite:n="Number must be finite";break;default:n=t.defaultError,M.assertNever(e)}return{message:n}};let z=q;function J(e,t){const n=z,s=(e=>{const{data:t,path:n,errorMaps:s,issueData:r}=e,a=[...n,...r.path||[]],i={...r,path:a};if(void 0!==r.message)return{...r,path:a,message:r.message};let o="";const u=s.filter(e=>!!e).slice().reverse();for(const e of u)o=e(i,{data:t,defaultError:o}).message;return{...r,path:a,message:o}})({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===q?void 0:q].filter(e=>!!e)});e.common.issues.push(s)}class W{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const s of t){if("aborted"===s.status)return G;"dirty"===s.status&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const e of t){const t=await e.key,s=await e.value;n.push({key:t,value:s})}return W.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const s of t){const{key:t,value:r}=s;if("aborted"===t.status)return G;if("aborted"===r.status)return G;"dirty"===t.status&&e.dirty(),"dirty"===r.status&&e.dirty(),"__proto__"===t.value||void 0===r.value&&!s.alwaysSet||(n[t.value]=r.value)}return{status:e.value,value:n}}}const G=Object.freeze({status:"aborted"}),K=e=>({status:"dirty",value:e}),H=e=>({status:"valid",value:e}),V=e=>"aborted"===e.status,X=e=>"dirty"===e.status,Y=e=>"valid"===e.status,Q=e=>"undefined"!=typeof Promise&&e instanceof Promise;var ee;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(ee||(ee={}));class te{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const ne=(e,t)=>{if(Y(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new B(e.common.issues);return this._error=t,this._error}}};function se(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:s,description:r}=e;if(t&&(n||s))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:r}:{errorMap:(t,r)=>{const{message:a}=e;return"invalid_enum_value"===t.code?{message:a??r.defaultError}:void 0===r.data?{message:a??s??r.defaultError}:"invalid_type"!==t.code?{message:r.defaultError}:{message:a??n??r.defaultError}},description:r}}class re{get description(){return this._def.description}_getType(e){return F(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:F(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new W,ctx:{common:e.parent.common,data:e.data,parsedType:F(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Q(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){const n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:F(e)},s=this._parseSync({data:e,path:n.path,parent:n});return ne(n,s)}"~validate"(e){const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:F(e)};if(!this["~standard"].async)try{const n=this._parseSync({data:e,path:[],parent:t});return Y(n)?{value:n.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>Y(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:F(e)},s=this._parse({data:e,path:n.path,parent:n}),r=await(Q(s)?s:Promise.resolve(s));return ne(n,r)}refine(e,t){const n=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,s)=>{const r=e(t),a=()=>s.addIssue({code:U.custom,...n(t)});return"undefined"!=typeof Promise&&r instanceof Promise?r.then(e=>!!e||(a(),!1)):!!r||(a(),!1)})}refinement(e,t){return this._refinement((n,s)=>!!e(n)||(s.addIssue("function"==typeof t?t(n,s):t),!1))}_refinement(e){return new nt({schema:this,typeName:dt.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return st.create(this,this._def)}nullable(){return rt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ue.create(this)}promise(){return tt.create(this,this._def)}or(e){return ze.create([this,e],this._def)}and(e){return We.create(this,e,this._def)}transform(e){return new nt({...se(this._def),schema:this,typeName:dt.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new at({...se(this._def),innerType:this,defaultValue:t,typeName:dt.ZodDefault})}brand(){return new ut({typeName:dt.ZodBranded,type:this,...se(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new it({...se(this._def),innerType:this,catchValue:t,typeName:dt.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return ct.create(this,e)}readonly(){return lt.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const ae=/^c[^\s-]{8,}$/i,ie=/^[0-9a-z]+$/,oe=/^[0-9A-HJKMNP-TV-Z]{26}$/i,ue=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ce=/^[a-z0-9_-]{21}$/i,le=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,de=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,pe=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let he;const fe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,me=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ge=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ye=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,_e=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,ve=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,we="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",be=new RegExp(`^${we}$`);function xe(e){let t="[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),`([01]\\d|2[0-3]):[0-5]\\d(:${t})${e.precision?"+":"?"}`}function Se(e){return new RegExp(`^${xe(e)}$`)}function ke(e){let t=`${we}T${xe(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function Te(e,t){return!("v4"!==t&&t||!fe.test(e))||!("v6"!==t&&t||!ge.test(e))}function Ae(e,t){if(!le.test(e))return!1;try{const[n]=e.split("."),s=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),r=JSON.parse(atob(s));return!("object"!=typeof r||null===r||"typ"in r&&"JWT"!==r?.typ||!r.alg||t&&r.alg!==t)}catch{return!1}}function Ie(e,t){return!("v4"!==t&&t||!me.test(e))||!("v6"!==t&&t||!ye.test(e))}class Ce extends re{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Z.string){const t=this._getOrReturnCtx(e);return J(t,{code:U.invalid_type,expected:Z.string,received:t.parsedType}),G}const t=new W;let n;for(const s of this._def.checks)if("min"===s.kind)e.data.length<s.value&&(n=this._getOrReturnCtx(e,n),J(n,{code:U.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("max"===s.kind)e.data.length>s.value&&(n=this._getOrReturnCtx(e,n),J(n,{code:U.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("length"===s.kind){const r=e.data.length>s.value,a=e.data.length<s.value;(r||a)&&(n=this._getOrReturnCtx(e,n),r?J(n,{code:U.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&J(n,{code:U.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),t.dirty())}else if("email"===s.kind)pe.test(e.data)||(n=this._getOrReturnCtx(e,n),J(n,{validation:"email",code:U.invalid_string,message:s.message}),t.dirty());else if("emoji"===s.kind)he||(he=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),he.test(e.data)||(n=this._getOrReturnCtx(e,n),J(n,{validation:"emoji",code:U.invalid_string,message:s.message}),t.dirty());else if("uuid"===s.kind)ue.test(e.data)||(n=this._getOrReturnCtx(e,n),J(n,{validation:"uuid",code:U.invalid_string,message:s.message}),t.dirty());else if("nanoid"===s.kind)ce.test(e.data)||(n=this._getOrReturnCtx(e,n),J(n,{validation:"nanoid",code:U.invalid_string,message:s.message}),t.dirty());else if("cuid"===s.kind)ae.test(e.data)||(n=this._getOrReturnCtx(e,n),J(n,{validation:"cuid",code:U.invalid_string,message:s.message}),t.dirty());else if("cuid2"===s.kind)ie.test(e.data)||(n=this._getOrReturnCtx(e,n),J(n,{validation:"cuid2",code:U.invalid_string,message:s.message}),t.dirty());else if("ulid"===s.kind)oe.test(e.data)||(n=this._getOrReturnCtx(e,n),J(n,{validation:"ulid",code:U.invalid_string,message:s.message}),t.dirty());else if("url"===s.kind)try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),J(n,{validation:"url",code:U.invalid_string,message:s.message}),t.dirty()}else"regex"===s.kind?(s.regex.lastIndex=0,s.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),J(n,{validation:"regex",code:U.invalid_string,message:s.message}),t.dirty())):"trim"===s.kind?e.data=e.data.trim():"includes"===s.kind?e.data.includes(s.value,s.position)||(n=this._getOrReturnCtx(e,n),J(n,{code:U.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),t.dirty()):"toLowerCase"===s.kind?e.data=e.data.toLowerCase():"toUpperCase"===s.kind?e.data=e.data.toUpperCase():"startsWith"===s.kind?e.data.startsWith(s.value)||(n=this._getOrReturnCtx(e,n),J(n,{code:U.invalid_string,validation:{startsWith:s.value},message:s.message}),t.dirty()):"endsWith"===s.kind?e.data.endsWith(s.value)||(n=this._getOrReturnCtx(e,n),J(n,{code:U.invalid_string,validation:{endsWith:s.value},message:s.message}),t.dirty()):"datetime"===s.kind?ke(s).test(e.data)||(n=this._getOrReturnCtx(e,n),J(n,{code:U.invalid_string,validation:"datetime",message:s.message}),t.dirty()):"date"===s.kind?be.test(e.data)||(n=this._getOrReturnCtx(e,n),J(n,{code:U.invalid_string,validation:"date",message:s.message}),t.dirty()):"time"===s.kind?Se(s).test(e.data)||(n=this._getOrReturnCtx(e,n),J(n,{code:U.invalid_string,validation:"time",message:s.message}),t.dirty()):"duration"===s.kind?de.test(e.data)||(n=this._getOrReturnCtx(e,n),J(n,{validation:"duration",code:U.invalid_string,message:s.message}),t.dirty()):"ip"===s.kind?Te(e.data,s.version)||(n=this._getOrReturnCtx(e,n),J(n,{validation:"ip",code:U.invalid_string,message:s.message}),t.dirty()):"jwt"===s.kind?Ae(e.data,s.alg)||(n=this._getOrReturnCtx(e,n),J(n,{validation:"jwt",code:U.invalid_string,message:s.message}),t.dirty()):"cidr"===s.kind?Ie(e.data,s.version)||(n=this._getOrReturnCtx(e,n),J(n,{validation:"cidr",code:U.invalid_string,message:s.message}),t.dirty()):"base64"===s.kind?_e.test(e.data)||(n=this._getOrReturnCtx(e,n),J(n,{validation:"base64",code:U.invalid_string,message:s.message}),t.dirty()):"base64url"===s.kind?ve.test(e.data)||(n=this._getOrReturnCtx(e,n),J(n,{validation:"base64url",code:U.invalid_string,message:s.message}),t.dirty()):M.assertNever(s);return{status:t.value,value:e.data}}_regex(e,t,n){return this.refinement(t=>e.test(t),{validation:t,code:U.invalid_string,...ee.errToObj(n)})}_addCheck(e){return new Ce({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...ee.errToObj(e)})}url(e){return this._addCheck({kind:"url",...ee.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...ee.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...ee.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...ee.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...ee.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...ee.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...ee.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...ee.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...ee.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...ee.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...ee.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...ee.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...ee.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...ee.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...ee.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...ee.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...ee.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...ee.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...ee.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...ee.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...ee.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...ee.errToObj(t)})}nonempty(e){return this.min(1,ee.errToObj(e))}trim(){return new Ce({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ce({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ce({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function Oe(e,t){const n=(e.toString().split(".")[1]||"").length,s=(t.toString().split(".")[1]||"").length,r=n>s?n:s;return Number.parseInt(e.toFixed(r).replace(".",""))%Number.parseInt(t.toFixed(r).replace(".",""))/10**r}Ce.create=e=>new Ce({checks:[],typeName:dt.ZodString,coerce:e?.coerce??!1,...se(e)});class Ee extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Z.number){const t=this._getOrReturnCtx(e);return J(t,{code:U.invalid_type,expected:Z.number,received:t.parsedType}),G}let t;const n=new W;for(const s of this._def.checks)"int"===s.kind?M.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),J(t,{code:U.invalid_type,expected:"integer",received:"float",message:s.message}),n.dirty()):"min"===s.kind?(s.inclusive?e.data<s.value:e.data<=s.value)&&(t=this._getOrReturnCtx(e,t),J(t,{code:U.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),n.dirty()):"max"===s.kind?(s.inclusive?e.data>s.value:e.data>=s.value)&&(t=this._getOrReturnCtx(e,t),J(t,{code:U.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),n.dirty()):"multipleOf"===s.kind?0!==Oe(e.data,s.value)&&(t=this._getOrReturnCtx(e,t),J(t,{code:U.not_multiple_of,multipleOf:s.value,message:s.message}),n.dirty()):"finite"===s.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),J(t,{code:U.not_finite,message:s.message}),n.dirty()):M.assertNever(s);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,ee.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ee.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ee.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ee.toString(t))}setLimit(e,t,n,s){return new Ee({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:ee.toString(s)}]})}_addCheck(e){return new Ee({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:ee.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ee.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ee.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ee.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ee.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ee.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:ee.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ee.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ee.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&M.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===t||n.value>t)&&(t=n.value):"max"===n.kind&&(null===e||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Ee.create=e=>new Ee({checks:[],typeName:dt.ZodNumber,coerce:e?.coerce||!1,...se(e)});class Re extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==Z.bigint)return this._getInvalidInput(e);let t;const n=new W;for(const s of this._def.checks)"min"===s.kind?(s.inclusive?e.data<s.value:e.data<=s.value)&&(t=this._getOrReturnCtx(e,t),J(t,{code:U.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),n.dirty()):"max"===s.kind?(s.inclusive?e.data>s.value:e.data>=s.value)&&(t=this._getOrReturnCtx(e,t),J(t,{code:U.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),n.dirty()):"multipleOf"===s.kind?e.data%s.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),J(t,{code:U.not_multiple_of,multipleOf:s.value,message:s.message}),n.dirty()):M.assertNever(s);return{status:n.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return J(t,{code:U.invalid_type,expected:Z.bigint,received:t.parsedType}),G}gte(e,t){return this.setLimit("min",e,!0,ee.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ee.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ee.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ee.toString(t))}setLimit(e,t,n,s){return new Re({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:ee.toString(s)}]})}_addCheck(e){return new Re({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ee.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ee.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ee.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ee.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ee.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}Re.create=e=>new Re({checks:[],typeName:dt.ZodBigInt,coerce:e?.coerce??!1,...se(e)});class Pe extends re{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==Z.boolean){const t=this._getOrReturnCtx(e);return J(t,{code:U.invalid_type,expected:Z.boolean,received:t.parsedType}),G}return H(e.data)}}Pe.create=e=>new Pe({typeName:dt.ZodBoolean,coerce:e?.coerce||!1,...se(e)});class Ne extends re{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Z.date){const t=this._getOrReturnCtx(e);return J(t,{code:U.invalid_type,expected:Z.date,received:t.parsedType}),G}if(Number.isNaN(e.data.getTime()))return J(this._getOrReturnCtx(e),{code:U.invalid_date}),G;const t=new W;let n;for(const s of this._def.checks)"min"===s.kind?e.data.getTime()<s.value&&(n=this._getOrReturnCtx(e,n),J(n,{code:U.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),t.dirty()):"max"===s.kind?e.data.getTime()>s.value&&(n=this._getOrReturnCtx(e,n),J(n,{code:U.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),t.dirty()):M.assertNever(s);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Ne({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:ee.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:ee.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}Ne.create=e=>new Ne({checks:[],coerce:e?.coerce||!1,typeName:dt.ZodDate,...se(e)});class $e extends re{_parse(e){if(this._getType(e)!==Z.symbol){const t=this._getOrReturnCtx(e);return J(t,{code:U.invalid_type,expected:Z.symbol,received:t.parsedType}),G}return H(e.data)}}$e.create=e=>new $e({typeName:dt.ZodSymbol,...se(e)});class De extends re{_parse(e){if(this._getType(e)!==Z.undefined){const t=this._getOrReturnCtx(e);return J(t,{code:U.invalid_type,expected:Z.undefined,received:t.parsedType}),G}return H(e.data)}}De.create=e=>new De({typeName:dt.ZodUndefined,...se(e)});class je extends re{_parse(e){if(this._getType(e)!==Z.null){const t=this._getOrReturnCtx(e);return J(t,{code:U.invalid_type,expected:Z.null,received:t.parsedType}),G}return H(e.data)}}je.create=e=>new je({typeName:dt.ZodNull,...se(e)});class Me extends re{constructor(){super(...arguments),this._any=!0}_parse(e){return H(e.data)}}Me.create=e=>new Me({typeName:dt.ZodAny,...se(e)});class Le extends re{constructor(){super(...arguments),this._unknown=!0}_parse(e){return H(e.data)}}Le.create=e=>new Le({typeName:dt.ZodUnknown,...se(e)});class Ze extends re{_parse(e){const t=this._getOrReturnCtx(e);return J(t,{code:U.invalid_type,expected:Z.never,received:t.parsedType}),G}}Ze.create=e=>new Ze({typeName:dt.ZodNever,...se(e)});class Fe extends re{_parse(e){if(this._getType(e)!==Z.undefined){const t=this._getOrReturnCtx(e);return J(t,{code:U.invalid_type,expected:Z.void,received:t.parsedType}),G}return H(e.data)}}Fe.create=e=>new Fe({typeName:dt.ZodVoid,...se(e)});class Ue extends re{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==Z.array)return J(t,{code:U.invalid_type,expected:Z.array,received:t.parsedType}),G;if(null!==s.exactLength){const e=t.data.length>s.exactLength.value,r=t.data.length<s.exactLength.value;(e||r)&&(J(t,{code:e?U.too_big:U.too_small,minimum:r?s.exactLength.value:void 0,maximum:e?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(null!==s.minLength&&t.data.length<s.minLength.value&&(J(t,{code:U.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),null!==s.maxLength&&t.data.length>s.maxLength.value&&(J(t,{code:U.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((e,n)=>s.type._parseAsync(new te(t,e,t.path,n)))).then(e=>W.mergeArray(n,e));const r=[...t.data].map((e,n)=>s.type._parseSync(new te(t,e,t.path,n)));return W.mergeArray(n,r)}get element(){return this._def.type}min(e,t){return new Ue({...this._def,minLength:{value:e,message:ee.toString(t)}})}max(e,t){return new Ue({...this._def,maxLength:{value:e,message:ee.toString(t)}})}length(e,t){return new Ue({...this._def,exactLength:{value:e,message:ee.toString(t)}})}nonempty(e){return this.min(1,e)}}function Be(e){if(e instanceof qe){const t={};for(const n in e.shape){const s=e.shape[n];t[n]=st.create(Be(s))}return new qe({...e._def,shape:()=>t})}return e instanceof Ue?new Ue({...e._def,type:Be(e.element)}):e instanceof st?st.create(Be(e.unwrap())):e instanceof rt?rt.create(Be(e.unwrap())):e instanceof Ge?Ge.create(e.items.map(e=>Be(e))):e}Ue.create=(e,t)=>new Ue({type:e,minLength:null,maxLength:null,exactLength:null,typeName:dt.ZodArray,...se(t)});class qe extends re{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=M.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==Z.object){const t=this._getOrReturnCtx(e);return J(t,{code:U.invalid_type,expected:Z.object,received:t.parsedType}),G}const{status:t,ctx:n}=this._processInputParams(e),{shape:s,keys:r}=this._getCached(),a=[];if(!(this._def.catchall instanceof Ze&&"strip"===this._def.unknownKeys))for(const e in n.data)r.includes(e)||a.push(e);const i=[];for(const e of r){const t=s[e],r=n.data[e];i.push({key:{status:"valid",value:e},value:t._parse(new te(n,r,n.path,e)),alwaysSet:e in n.data})}if(this._def.catchall instanceof Ze){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of a)i.push({key:{status:"valid",value:e},value:{status:"valid",value:n.data[e]}});else if("strict"===e)a.length>0&&(J(n,{code:U.unrecognized_keys,keys:a}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of a){const s=n.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new te(n,s,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const e=[];for(const t of i){const n=await t.key,s=await t.value;e.push({key:n,value:s,alwaysSet:t.alwaysSet})}return e}).then(e=>W.mergeObjectSync(t,e)):W.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return ee.errToObj,new qe({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,n)=>{const s=this._def.errorMap?.(t,n).message??n.defaultError;return"unrecognized_keys"===t.code?{message:ee.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new qe({...this._def,unknownKeys:"strip"})}passthrough(){return new qe({...this._def,unknownKeys:"passthrough"})}extend(e){return new qe({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new qe({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:dt.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new qe({...this._def,catchall:e})}pick(e){const t={};for(const n of M.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new qe({...this._def,shape:()=>t})}omit(e){const t={};for(const n of M.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new qe({...this._def,shape:()=>t})}deepPartial(){return Be(this)}partial(e){const t={};for(const n of M.objectKeys(this.shape)){const s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}return new qe({...this._def,shape:()=>t})}required(e){const t={};for(const n of M.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let e=this.shape[n];for(;e instanceof st;)e=e._def.innerType;t[n]=e}return new qe({...this._def,shape:()=>t})}keyof(){return Ye(M.objectKeys(this.shape))}}qe.create=(e,t)=>new qe({shape:()=>e,unknownKeys:"strip",catchall:Ze.create(),typeName:dt.ZodObject,...se(t)}),qe.strictCreate=(e,t)=>new qe({shape:()=>e,unknownKeys:"strict",catchall:Ze.create(),typeName:dt.ZodObject,...se(t)}),qe.lazycreate=(e,t)=>new qe({shape:e,unknownKeys:"strip",catchall:Ze.create(),typeName:dt.ZodObject,...se(t)});class ze extends re{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;if(t.common.async)return Promise.all(n.map(async e=>{const n={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}})).then(function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const n of e)if("dirty"===n.result.status)return t.common.issues.push(...n.ctx.common.issues),n.result;const n=e.map(e=>new B(e.ctx.common.issues));return J(t,{code:U.invalid_union,unionErrors:n}),G});{let e;const s=[];for(const r of n){const n={...t,common:{...t.common,issues:[]},parent:null},a=r._parseSync({data:t.data,path:t.path,parent:n});if("valid"===a.status)return a;"dirty"!==a.status||e||(e={result:a,ctx:n}),n.common.issues.length&&s.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const r=s.map(e=>new B(e));return J(t,{code:U.invalid_union,unionErrors:r}),G}}get options(){return this._def.options}}function Je(e,t){const n=F(e),s=F(t);if(e===t)return{valid:!0,data:e};if(n===Z.object&&s===Z.object){const n=M.objectKeys(t),s=M.objectKeys(e).filter(e=>-1!==n.indexOf(e)),r={...e,...t};for(const n of s){const s=Je(e[n],t[n]);if(!s.valid)return{valid:!1};r[n]=s.data}return{valid:!0,data:r}}if(n===Z.array&&s===Z.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let s=0;s<e.length;s++){const r=Je(e[s],t[s]);if(!r.valid)return{valid:!1};n.push(r.data)}return{valid:!0,data:n}}return n===Z.date&&s===Z.date&&+e===+t?{valid:!0,data:e}:{valid:!1}}ze.create=(e,t)=>new ze({options:e,typeName:dt.ZodUnion,...se(t)});class We extends re{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=(e,s)=>{if(V(e)||V(s))return G;const r=Je(e.value,s.value);return r.valid?((X(e)||X(s))&&t.dirty(),{status:t.value,value:r.data}):(J(n,{code:U.invalid_intersection_types}),G)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([e,t])=>s(e,t)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}We.create=(e,t,n)=>new We({left:e,right:t,typeName:dt.ZodIntersection,...se(n)});class Ge extends re{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Z.array)return J(n,{code:U.invalid_type,expected:Z.array,received:n.parsedType}),G;if(n.data.length<this._def.items.length)return J(n,{code:U.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),G;!this._def.rest&&n.data.length>this._def.items.length&&(J(n,{code:U.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const s=[...n.data].map((e,t)=>{const s=this._def.items[t]||this._def.rest;return s?s._parse(new te(n,e,n.path,t)):null}).filter(e=>!!e);return n.common.async?Promise.all(s).then(e=>W.mergeArray(t,e)):W.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new Ge({...this._def,rest:e})}}Ge.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Ge({items:e,typeName:dt.ZodTuple,rest:null,...se(t)})};class Ke extends re{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Z.map)return J(n,{code:U.invalid_type,expected:Z.map,received:n.parsedType}),G;const s=this._def.keyType,r=this._def.valueType,a=[...n.data.entries()].map(([e,t],a)=>({key:s._parse(new te(n,e,n.path,[a,"key"])),value:r._parse(new te(n,t,n.path,[a,"value"]))}));if(n.common.async){const e=new Map;return Promise.resolve().then(async()=>{for(const n of a){const s=await n.key,r=await n.value;if("aborted"===s.status||"aborted"===r.status)return G;"dirty"!==s.status&&"dirty"!==r.status||t.dirty(),e.set(s.value,r.value)}return{status:t.value,value:e}})}{const e=new Map;for(const n of a){const s=n.key,r=n.value;if("aborted"===s.status||"aborted"===r.status)return G;"dirty"!==s.status&&"dirty"!==r.status||t.dirty(),e.set(s.value,r.value)}return{status:t.value,value:e}}}}Ke.create=(e,t,n)=>new Ke({valueType:t,keyType:e,typeName:dt.ZodMap,...se(n)});class He extends re{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Z.set)return J(n,{code:U.invalid_type,expected:Z.set,received:n.parsedType}),G;const s=this._def;null!==s.minSize&&n.data.size<s.minSize.value&&(J(n,{code:U.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),null!==s.maxSize&&n.data.size>s.maxSize.value&&(J(n,{code:U.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const r=this._def.valueType;function a(e){const n=new Set;for(const s of e){if("aborted"===s.status)return G;"dirty"===s.status&&t.dirty(),n.add(s.value)}return{status:t.value,value:n}}const i=[...n.data.values()].map((e,t)=>r._parse(new te(n,e,n.path,t)));return n.common.async?Promise.all(i).then(e=>a(e)):a(i)}min(e,t){return new He({...this._def,minSize:{value:e,message:ee.toString(t)}})}max(e,t){return new He({...this._def,maxSize:{value:e,message:ee.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}He.create=(e,t)=>new He({valueType:e,minSize:null,maxSize:null,typeName:dt.ZodSet,...se(t)});class Ve extends re{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Ve.create=(e,t)=>new Ve({getter:e,typeName:dt.ZodLazy,...se(t)});class Xe extends re{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return J(t,{received:t.data,code:U.invalid_literal,expected:this._def.value}),G}return{status:"valid",value:e.data}}get value(){return this._def.value}}function Ye(e,t){return new Qe({values:e,typeName:dt.ZodEnum,...se(t)})}Xe.create=(e,t)=>new Xe({value:e,typeName:dt.ZodLiteral,...se(t)});class Qe extends re{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),n=this._def.values;return J(t,{expected:M.joinValues(n),received:t.parsedType,code:U.invalid_type}),G}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return J(t,{received:t.data,code:U.invalid_enum_value,options:n}),G}return H(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Qe.create(e,{...this._def,...t})}exclude(e,t=this._def){return Qe.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}Qe.create=Ye;class et extends re{_parse(e){const t=M.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==Z.string&&n.parsedType!==Z.number){const e=M.objectValues(t);return J(n,{expected:M.joinValues(e),received:n.parsedType,code:U.invalid_type}),G}if(this._cache||(this._cache=new Set(M.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const e=M.objectValues(t);return J(n,{received:n.data,code:U.invalid_enum_value,options:e}),G}return H(e.data)}get enum(){return this._def.values}}et.create=(e,t)=>new et({values:e,typeName:dt.ZodNativeEnum,...se(t)});class tt extends re{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Z.promise&&!1===t.common.async)return J(t,{code:U.invalid_type,expected:Z.promise,received:t.parsedType}),G;const n=t.parsedType===Z.promise?t.data:Promise.resolve(t.data);return H(n.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}tt.create=(e,t)=>new tt({type:e,typeName:dt.ZodPromise,...se(t)});class nt extends re{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===dt.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,r={addIssue:e=>{J(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(r.addIssue=r.addIssue.bind(r),"preprocess"===s.type){const e=s.transform(n.data,r);if(n.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return G;const s=await this._def.schema._parseAsync({data:e,path:n.path,parent:n});return"aborted"===s.status?G:"dirty"===s.status||"dirty"===t.value?K(s.value):s});{if("aborted"===t.value)return G;const s=this._def.schema._parseSync({data:e,path:n.path,parent:n});return"aborted"===s.status?G:"dirty"===s.status||"dirty"===t.value?K(s.value):s}}if("refinement"===s.type){const e=e=>{const t=s.refinement(e,r);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===n.common.async){const s=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===s.status?G:("dirty"===s.status&&t.dirty(),e(s.value),{status:t.value,value:s.value})}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(n=>"aborted"===n.status?G:("dirty"===n.status&&t.dirty(),e(n.value).then(()=>({status:t.value,value:n.value}))))}if("transform"===s.type){if(!1===n.common.async){const e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Y(e))return G;const a=s.transform(e.value,r);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(e=>Y(e)?Promise.resolve(s.transform(e.value,r)).then(e=>({status:t.value,value:e})):G)}M.assertNever(s)}}nt.create=(e,t,n)=>new nt({schema:e,typeName:dt.ZodEffects,effect:t,...se(n)}),nt.createWithPreprocess=(e,t,n)=>new nt({schema:t,effect:{type:"preprocess",transform:e},typeName:dt.ZodEffects,...se(n)});class st extends re{_parse(e){return this._getType(e)===Z.undefined?H(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}st.create=(e,t)=>new st({innerType:e,typeName:dt.ZodOptional,...se(t)});class rt extends re{_parse(e){return this._getType(e)===Z.null?H(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}rt.create=(e,t)=>new rt({innerType:e,typeName:dt.ZodNullable,...se(t)});class at extends re{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===Z.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}at.create=(e,t)=>new at({innerType:e,typeName:dt.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...se(t)});class it extends re{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Q(s)?s.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new B(n.common.issues)},input:n.data})})):{status:"valid",value:"valid"===s.status?s.value:this._def.catchValue({get error(){return new B(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}it.create=(e,t)=>new it({innerType:e,typeName:dt.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...se(t)});class ot extends re{_parse(e){if(this._getType(e)!==Z.nan){const t=this._getOrReturnCtx(e);return J(t,{code:U.invalid_type,expected:Z.nan,received:t.parsedType}),G}return{status:"valid",value:e.data}}}ot.create=e=>new ot({typeName:dt.ZodNaN,...se(e)}),Symbol("zod_brand");class ut extends re{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class ct extends re{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?G:"dirty"===e.status?(t.dirty(),K(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})();{const e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?G:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(e,t){return new ct({in:e,out:t,typeName:dt.ZodPipeline})}}class lt extends re{_parse(e){const t=this._def.innerType._parse(e),n=e=>(Y(e)&&(e.value=Object.freeze(e.value)),e);return Q(t)?t.then(e=>n(e)):n(t)}unwrap(){return this._def.innerType}}var dt;function pt(e,t,n,s){s?.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function ht(e,t,n,s,r){e[t]=n,pt(e,t,s,r)}function ft(e,t,n){const s=n??t.dateStrategy;if(Array.isArray(s))return{anyOf:s.map((n,s)=>ft(e,t,n))};switch(s){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return mt(e,t)}}lt.create=(e,t)=>new lt({innerType:e,typeName:dt.ZodReadonly,...se(t)}),qe.lazycreate,function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(dt||(dt={})),Ce.create,Ee.create,ot.create,Re.create,Pe.create,Ne.create,$e.create,De.create,je.create,Me.create,Le.create,Ze.create,Fe.create,Ue.create,qe.create,qe.strictCreate,ze.create,We.create,Ge.create,Ke.create,He.create,Ve.create,Xe.create,Qe.create,et.create,tt.create,nt.create,st.create,rt.create,nt.createWithPreprocess,ct.create;const mt=(e,t)=>{const n={type:"integer",format:"unix-time"};if("openApi3"===t.target)return n;for(const s of e.checks)switch(s.kind){case"min":ht(n,"minimum",s.value,s.message,t);break;case"max":ht(n,"maximum",s.value,s.message,t)}return n};let gt;const yt=/^[cC][^\s-]{8,}$/,_t=/^[0-9a-z]+$/,vt=/^[0-9A-HJKMNP-TV-Z]{26}$/,wt=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,bt=()=>(void 0===gt&&(gt=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),gt),xt=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,St=/^[a-zA-Z0-9_-]{21}$/;function kt(e,t){const n={type:"string"};function s(e){return"escape"===t.patternStrategy?Tt(e):e}if(e.checks)for(const r of e.checks)switch(r.kind){case"min":ht(n,"minLength","number"==typeof n.minLength?Math.max(n.minLength,r.value):r.value,r.message,t);break;case"max":ht(n,"maxLength","number"==typeof n.maxLength?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"email":switch(t.emailStrategy){case"format:email":At(n,"email",r.message,t);break;case"format:idn-email":At(n,"idn-email",r.message,t);break;case"pattern:zod":It(n,wt,r.message,t)}break;case"url":At(n,"uri",r.message,t);break;case"uuid":At(n,"uuid",r.message,t);break;case"regex":It(n,r.regex,r.message,t);break;case"cuid":It(n,yt,r.message,t);break;case"cuid2":It(n,_t,r.message,t);break;case"startsWith":It(n,RegExp(`^${s(r.value)}`),r.message,t);break;case"endsWith":It(n,RegExp(`${s(r.value)}$`),r.message,t);break;case"datetime":At(n,"date-time",r.message,t);break;case"date":At(n,"date",r.message,t);break;case"time":At(n,"time",r.message,t);break;case"duration":At(n,"duration",r.message,t);break;case"length":ht(n,"minLength","number"==typeof n.minLength?Math.max(n.minLength,r.value):r.value,r.message,t),ht(n,"maxLength","number"==typeof n.maxLength?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"includes":It(n,RegExp(s(r.value)),r.message,t);break;case"ip":"v6"!==r.version&&At(n,"ipv4",r.message,t),"v4"!==r.version&&At(n,"ipv6",r.message,t);break;case"emoji":It(n,bt,r.message,t);break;case"ulid":It(n,vt,r.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":At(n,"binary",r.message,t);break;case"contentEncoding:base64":ht(n,"contentEncoding","base64",r.message,t);break;case"pattern:zod":It(n,xt,r.message,t)}break;case"nanoid":It(n,St,r.message,t);case"toLowerCase":case"toUpperCase":case"trim":break;default:(()=>{})()}return n}const Tt=e=>Array.from(e).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),At=(e,t,n,s)=>{e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&s.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&s.errorMessages&&{errorMessage:{format:n}}})):ht(e,"format",t,n,s)},It=(e,t,n,s)=>{e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&s.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:Ct(t,s),...n&&s.errorMessages&&{errorMessage:{pattern:n}}})):ht(e,"pattern",Ct(t,s),n,s)},Ct=(e,t)=>{const n="function"==typeof e?e():e;if(!t.applyRegexFlags||!n.flags)return n.source;const s=n.flags.includes("i"),r=n.flags.includes("m"),a=n.flags.includes("s"),i=s?n.source.toLowerCase():n.source;let o="",u=!1,c=!1,l=!1;for(let e=0;e<i.length;e++)if(u)o+=i[e],u=!1;else{if(s)if(c){if(i[e].match(/[a-z]/)){l?(o+=i[e],o+=`${i[e-2]}-${i[e]}`.toUpperCase(),l=!1):"-"===i[e+1]&&i[e+2]?.match(/[a-z]/)?(o+=i[e],l=!0):o+=`${i[e]}${i[e].toUpperCase()}`;continue}}else if(i[e].match(/[a-z]/)){o+=`[${i[e]}${i[e].toUpperCase()}]`;continue}if(r){if("^"===i[e]){o+="(^|(?<=[\r\n]))";continue}if("$"===i[e]){o+="($|(?=[\r\n]))";continue}}a&&"."===i[e]?o+=c?`${i[e]}\r\n`:`[${i[e]}\r\n]`:(o+=i[e],"\\"===i[e]?u=!0:c&&"]"===i[e]?c=!1:c||"["!==i[e]||(c=!0))}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return o};function Ot(e,t){if("openApi3"===t.target&&e.keyType?._def.typeName===dt.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((n,s)=>({...n,[s]:Nt(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",s]})??{}}),{}),additionalProperties:!1};const n={type:"object",additionalProperties:Nt(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return n;if(e.keyType?._def.typeName===dt.ZodString&&e.keyType._def.checks?.length){const s=Object.entries(kt(e.keyType._def,t)).reduce((e,[t,n])=>"type"===t?e:{...e,[t]:n},{});return{...n,propertyNames:s}}return e.keyType?._def.typeName===dt.ZodEnum?{...n,propertyNames:{enum:e.keyType._def.values}}:n}const Et={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},Rt=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,n)=>Nt(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${n}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return n.length?{anyOf:n}:void 0};function Pt(e,t){return"strict"===t.removeAdditionalStrategy?"ZodNever"===e.catchall._def.typeName?"strict"!==e.unknownKeys:Nt(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:Nt(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0}function Nt(e,t,n=!1){const s=t.seen.get(e);if(t.override){const r=t.override?.(e,t,s,n);if(r!==$)return r}if(s&&!n){const e=$t(s,t);if(void 0!==e)return"$ref"in e&&t.seenRefs.add(e.$ref),e}const r={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,r);const a=jt(e,e.typeName,t,n);return a&&Mt(e,t,a),r.jsonSchema=a,a}const $t=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"extract-to-root":const n=e.path.slice(t.basePath.length+1).join("_");return n!==t.name&&"duplicate-ref"===t.nameStrategy&&(t.definitions[n]=e.def),{$ref:[...t.basePath,t.definitionPath,n].join("/")};case"relative":return{$ref:Dt(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((e,n)=>t.currentPath[n]===e)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):"seen"===t.$refStrategy?{}:void 0}},Dt=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")},jt=(e,t,n,s)=>{switch(t){case dt.ZodString:return kt(e,n);case dt.ZodNumber:return function(e,t){const n={type:"number"};if(!e.checks)return n;for(const s of e.checks)switch(s.kind){case"int":n.type="integer",pt(n,"type",s.message,t);break;case"min":"jsonSchema7"===t.target?s.inclusive?ht(n,"minimum",s.value,s.message,t):ht(n,"exclusiveMinimum",s.value,s.message,t):(s.inclusive||(n.exclusiveMinimum=!0),ht(n,"minimum",s.value,s.message,t));break;case"max":"jsonSchema7"===t.target?s.inclusive?ht(n,"maximum",s.value,s.message,t):ht(n,"exclusiveMaximum",s.value,s.message,t):(s.inclusive||(n.exclusiveMaximum=!0),ht(n,"maximum",s.value,s.message,t));break;case"multipleOf":ht(n,"multipleOf",s.value,s.message,t)}return n}(e,n);case dt.ZodObject:return function(e,t){const n={type:"object",...Object.entries(e.shape()).reduce((e,[n,s])=>{if(void 0===s||void 0===s._def)return e;const r=[...t.currentPath,"properties",n],a=Nt(s._def,{...t,currentPath:r,propertyPath:r});if(void 0===a)return e;if(t.openaiStrictMode&&s.isOptional()&&!s.isNullable()&&void 0===s._def?.defaultValue)throw new Error(`Zod field at \`${r.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);return{properties:{...e.properties,[n]:a},required:s.isOptional()&&!t.openaiStrictMode?e.required:[...e.required,n]}},{properties:{},required:[]}),additionalProperties:Pt(e,t)};return n.required.length||delete n.required,n}(e,n);case dt.ZodBigInt:return function(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const s of e.checks)switch(s.kind){case"min":"jsonSchema7"===t.target?s.inclusive?ht(n,"minimum",s.value,s.message,t):ht(n,"exclusiveMinimum",s.value,s.message,t):(s.inclusive||(n.exclusiveMinimum=!0),ht(n,"minimum",s.value,s.message,t));break;case"max":"jsonSchema7"===t.target?s.inclusive?ht(n,"maximum",s.value,s.message,t):ht(n,"exclusiveMaximum",s.value,s.message,t):(s.inclusive||(n.exclusiveMaximum=!0),ht(n,"maximum",s.value,s.message,t));break;case"multipleOf":ht(n,"multipleOf",s.value,s.message,t)}return n}(e,n);case dt.ZodBoolean:return{type:"boolean"};case dt.ZodDate:return ft(e,n);case dt.ZodUndefined:return{not:{}};case dt.ZodNull:return function(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}(n);case dt.ZodArray:return function(e,t){const n={type:"array"};return e.type?._def?.typeName!==dt.ZodAny&&(n.items=Nt(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&ht(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&ht(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(ht(n,"minItems",e.exactLength.value,e.exactLength.message,t),ht(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}(e,n);case dt.ZodUnion:case dt.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return Rt(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(e=>e._def.typeName in Et&&(!e._def.checks||!e._def.checks.length))){const e=n.reduce((e,t)=>{const n=Et[t._def.typeName];return n&&!e.includes(n)?[...e,n]:e},[]);return{type:e.length>1?e:e[0]}}if(n.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){const e=n.reduce((e,t)=>{const n=typeof t._def.value;switch(n){case"string":case"number":case"boolean":return[...e,n];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===n.length){const t=e.filter((e,t,n)=>n.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:n.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(n.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:n.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return Rt(e,t)}(e,n);case dt.ZodIntersection:return function(e,t){const n=[Nt(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),Nt(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e);let s="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0;const r=[];return n.forEach(e=>{if("type"in(t=e)&&"string"===t.type||!("allOf"in t)){let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){const{additionalProperties:n,...s}=e;t=s}else s=void 0;r.push(t)}else r.push(...e.allOf),void 0===e.unevaluatedProperties&&(s=void 0);var t}),r.length?{allOf:r,...s}:void 0}(e,n);case dt.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,n)=>Nt(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:Nt(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,n)=>Nt(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}(e,n);case dt.ZodRecord:return Ot(e,n);case dt.ZodLiteral:return function(e,t){const n=typeof e.value;return"bigint"!==n&&"number"!==n&&"boolean"!==n&&"string"!==n?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===n?"integer":n,enum:[e.value]}:{type:"bigint"===n?"integer":n,const:e.value}}(e,n);case dt.ZodEnum:return function(e){return{type:"string",enum:[...e.values]}}(e);case dt.ZodNativeEnum:return function(e){const t=e.values,n=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]).map(e=>t[e]),s=Array.from(new Set(n.map(e=>typeof e)));return{type:1===s.length?"string"===s[0]?"string":"number":["string","number"],enum:n}}(e);case dt.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target||"property"===t.nullableStrategy?{type:Et[e.innerType._def.typeName],nullable:!0}:{type:[Et[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){const n=Nt(e.innerType._def,{...t,currentPath:[...t.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const n=Nt(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}(e,n);case dt.ZodOptional:return((e,t)=>{if(t.propertyPath&&t.currentPath.slice(0,t.propertyPath.length).toString()===t.propertyPath.toString())return Nt(e.innerType._def,{...t,currentPath:t.currentPath});const n=Nt(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}})(e,n);case dt.ZodMap:return function(e,t){return"record"===t.mapStrategy?Ot(e,t):{type:"array",maxItems:125,items:{type:"array",items:[Nt(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},Nt(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,n);case dt.ZodSet:return function(e,t){const n={type:"array",uniqueItems:!0,items:Nt(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&ht(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&ht(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}(e,n);case dt.ZodLazy:return Nt(e.getter()._def,n);case dt.ZodPromise:return function(e,t){return Nt(e.type._def,t)}(e,n);case dt.ZodNaN:case dt.ZodNever:return{not:{}};case dt.ZodEffects:return function(e,t,n){return"input"===t.effectStrategy?Nt(e.schema._def,t,n):{}}(e,n,s);case dt.ZodAny:case dt.ZodUnknown:return{};case dt.ZodDefault:return function(e,t){return{...Nt(e.innerType._def,t),default:e.defaultValue()}}(e,n);case dt.ZodBranded:return function(e,t){return Nt(e.type._def,t)}(e,n);case dt.ZodReadonly:case dt.ZodCatch:return((e,t)=>Nt(e.innerType._def,t))(e,n);case dt.ZodPipeline:return((e,t)=>{if("input"===t.pipeStrategy)return Nt(e.in._def,t);if("output"===t.pipeStrategy)return Nt(e.out._def,t);const n=Nt(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]});return{allOf:[n,Nt(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]})].filter(e=>void 0!==e)}})(e,n);case dt.ZodFunction:case dt.ZodVoid:case dt.ZodSymbol:default:return}},Mt=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),Lt=(e,t)=>{const n=(e=>{const t=(e=>"string"==typeof e?{...D,basePath:["#"],definitions:{},name:e}:{...D,basePath:["#"],definitions:{},...e})(e),n=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:n,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(t.definitions).map(([e,n])=>[j(n),{def:j(n),path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}})(t),s="string"==typeof t?t:"title"===t?.nameStrategy?void 0:t?.name,r=Nt(e._def,void 0===s?n:{...n,currentPath:[...n.basePath,n.definitionPath,s]},!1)??{},a="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==a&&(r.title=a);const i=(()=>{if(function(e){if(!e)return!0;for(const t in e)return!1;return!0}(n.definitions))return;const e={},t=new Set;for(let s=0;s<500;s++){const s=Object.entries(n.definitions).filter(([e])=>!t.has(e));if(0===s.length)break;for(const[r,a]of s)e[r]=Nt(j(a),{...n,currentPath:[...n.basePath,n.definitionPath,r]},!0)??{},t.add(r)}return e})(),o=void 0===s?i?{...r,[n.definitionPath]:i}:r:"duplicate-ref"===n.nameStrategy?{...r,...i||n.seenRefs.size?{[n.definitionPath]:{...i,...n.seenRefs.size?{[s]:r}:void 0}}:void 0}:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,s].join("/"),[n.definitionPath]:{...i,[s]:r}};return"jsonSchema7"===n.target?o.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===n.target&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function Zt(e,t){const n=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:Bt(t,e)};if("message"===e.type){const n=e.content.map(e=>"output_text"===e.type?{...e,parsed:Ft(t,e.text)}:e);return{...e,content:n}}return e}),s=Object.assign({},e,{output:n});return Object.getOwnPropertyDescriptor(e,"output_text")||qt(s),Object.defineProperty(s,"output_parsed",{enumerable:!0,get(){for(const e of s.output)if("message"===e.type)for(const t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed;return null}}),s}function Ft(e,t){if("json_schema"!==e.text?.format?.type)return null;if("$parseRaw"in e.text?.format){const n=e.text?.format;return n.$parseRaw(t)}return JSON.parse(t)}function Ut(e){return"auto-parseable-tool"===e?.$brand}function Bt(e,t){const n=(s=e.tools??[],r=t.name,s.find(e=>"function"===e.type&&e.name===r));var s,r;return{...t,...t,parsed_arguments:Ut(n)?n.$parseRaw(t.arguments):n?.strict?JSON.parse(t.arguments):null}}function qt(e){const t=[];for(const n of e.output)if("message"===n.type)for(const e of n.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}function zt(e,t){return Lt(e,{openaiStrictMode:!0,name:t.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function Jt(e,t,n){return function(t){const n={...t};return Object.defineProperties(n,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:t=>e.parse(JSON.parse(t)),enumerable:!1}}),n}({type:"json_schema",...n,name:t,strict:!0,schema:zt(e,{name:t})})}class Wt extends Error{state;constructor(e,t){super(e),this.state=t}}class Gt extends Wt{}class Kt extends Wt{}class Ht extends Wt{}class Vt extends Wt{}class Xt extends Wt{error;constructor(e,t,n){super(e,n),this.error=t}}class Yt extends Wt{error;constructor(e,t,n){super(e,n),this.error=t}}class Qt extends Wt{result;constructor(e,t,n){super(e,n),this.result=t}}class en extends Wt{result;constructor(e,t,n){super(e,n),this.result=t}}function tn(e){return"object"==typeof e&&null!==e&&"_def"in e&&"object"==typeof e._def&&null!==e._def&&"typeName"in e._def&&"ZodObject"===e._def.typeName}function nn(e){if(0===(e=(e=e.replace(/\s/g,"_")).replace(/[^a-zA-Z0-9]/g,"_")).length)throw new Error("Tool name cannot be empty");return e}function sn(e,t){if(tn(e)){const s=function(e,{parser:t,callback:n}){const s={...e};return Object.defineProperties(s,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:t,enumerable:!1},$callback:{value:n,enumerable:!1}}),s}({type:"function",name:(n={name:t,parameters:e,function:()=>{},description:""}).name,parameters:zt(n.parameters,{name:n.name}),strict:!0,...n.description?{description:n.description}:void 0},{callback:n.function,parser:e=>n.parameters.parse(JSON.parse(e))});return{schema:s.parameters,parser:s.$parseRaw}}var n;if("object"==typeof e&&null!==e)return{schema:e,parser:e=>JSON.parse(e)};throw new Vt("Input type is not a ZodObject or a valid JSON schema")}function rn(e){if("text"===e)return"text";if(tn(e)){const t=Jt(e,"output");return{type:t.type,name:t.name,strict:t.strict||!1,schema:t.schema}}return e}var an=n(833);function on(e){const t={};return"true"===t[e]||"1"===t[e]}const un={get disabled(){return!0}},cn={get dontLogModelData(){return on("OPENAI_AGENTS_DONT_LOG_MODEL_DATA")},get dontLogToolData(){return on("OPENAI_AGENTS_DONT_LOG_TOOL_DATA")}},ln=cn.dontLogModelData,dn=cn.dontLogToolData;function pn(e="openai-agents"){return{namespace:e,debug:an(e),error:console.error,warn:console.warn,dontLogModelData:ln,dontLogToolData:dn}}const hn=pn("openai-agents:core"),fn=hn;function mn(e){if(null==e)return String(e);if("string"==typeof e)return e;if("object"==typeof e)try{return JSON.stringify(e)}catch(e){return"[object with circular references]"}return String(e)}function gn(e){return{type:"computer",name:e.name??"computer_use_preview",computer:e.computer}}function yn(e){return{type:"hosted_tool",name:"hosted_mcp",providerData:void 0===e.requireApproval||"never"===e.requireApproval?{type:"mcp",server_label:e.serverLabel,server_url:e.serverUrl,require_approval:"never",allowed_tools:bn(e.allowedTools),headers:e.headers}:{type:"mcp",server_label:e.serverLabel,server_url:e.serverUrl,allowed_tools:bn(e.allowedTools),headers:e.headers,require_approval:"string"==typeof e.requireApproval?"always":wn(e.requireApproval),on_approval:e.onApproval}}}function _n(e,t){return`An error occurred while running the tool. Please try again. Error: ${t instanceof Error?t.toString():String(t)}`}function vn(e){const t=e.name?nn(e.name):nn(e.execute.name),n=void 0===e.errorFunction?_n:e.errorFunction;if(!t)throw new Error("Tool name cannot be empty. Either name your function or provide a name in the options.");const s=e.strict??!0;if(!s&&tn(e.parameters))throw new Vt("Strict mode is required for Zod parameters");const{parser:r,schema:a}=sn(e.parameters,t),i="function"==typeof e.needsApproval?e.needsApproval:async()=>"boolean"==typeof e.needsApproval&&e.needsApproval;return{type:"function",name:t,description:e.description,parameters:a,strict:s,invoke:async function(s,a){return async function(n,s){const[a,i]=await o(()=>r(s));if(null!==a)throw fn.dontLogToolData?fn.debug(`Invalid JSON input for tool ${t}`):fn.debug(`Invalid JSON input for tool ${t}: ${s}`),new Ht("Invalid JSON input for tool");fn.dontLogToolData?fn.debug(`Invoking tool ${t}`):fn.debug(`Invoking tool ${t} with input ${s}`);const u=await e.execute(i,n),c=mn(u);return fn.dontLogToolData?fn.debug(`Tool ${t} completed`):fn.debug(`Tool ${t} returned: ${c}`),u}(s,a).catch(e=>{if(n){const r=jr();return r?.setError({message:"Error running tool (non-fatal)",data:{tool_name:t,error:e.toString()}}),n(s,e)}throw e})},needsApproval:i}}function wn(e){const t={};return e.always&&(t.always={tool_names:e.always.toolNames}),e.never&&(t.never={tool_names:e.never.toolNames}),t}function bn(e){if(void 0!==e)return Array.isArray(e)?{tool_names:e}:{tool_names:e?.toolNames??[]}}var xn,Sn;!function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const n of e)t[n]=n;return t},e.getValidEnumValues=t=>{const n=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),s={};for(const e of n)s[e]=t[e];return e.objectValues(s)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},e.find=(e,t)=>{for(const n of e)if(t(n))return n},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(xn||(xn={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(Sn||(Sn={}));const kn=xn.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Tn=e=>{switch(typeof e){case"undefined":return kn.undefined;case"string":return kn.string;case"number":return Number.isNaN(e)?kn.nan:kn.number;case"boolean":return kn.boolean;case"function":return kn.function;case"bigint":return kn.bigint;case"symbol":return kn.symbol;case"object":return Array.isArray(e)?kn.array:null===e?kn.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?kn.promise:"undefined"!=typeof Map&&e instanceof Map?kn.map:"undefined"!=typeof Set&&e instanceof Set?kn.set:"undefined"!=typeof Date&&e instanceof Date?kn.date:kn.object;default:return kn.unknown}},An=xn.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class In extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},n={_errors:[]},s=e=>{for(const r of e.issues)if("invalid_union"===r.code)r.unionErrors.map(s);else if("invalid_return_type"===r.code)s(r.returnTypeError);else if("invalid_arguments"===r.code)s(r.argumentsError);else if(0===r.path.length)n._errors.push(t(r));else{let e=n,s=0;for(;s<r.path.length;){const n=r.path[s];s===r.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(r))):e[n]=e[n]||{_errors:[]},e=e[n],s++}}};return s(this),n}static assert(e){if(!(e instanceof In))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,xn.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},n=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}In.create=e=>new In(e);const Cn=(e,t)=>{let n;switch(e.code){case An.invalid_type:n=e.received===kn.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case An.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,xn.jsonStringifyReplacer)}`;break;case An.unrecognized_keys:n=`Unrecognized key(s) in object: ${xn.joinValues(e.keys,", ")}`;break;case An.invalid_union:n="Invalid input";break;case An.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${xn.joinValues(e.options)}`;break;case An.invalid_enum_value:n=`Invalid enum value. Expected ${xn.joinValues(e.options)}, received '${e.received}'`;break;case An.invalid_arguments:n="Invalid function arguments";break;case An.invalid_return_type:n="Invalid function return type";break;case An.invalid_date:n="Invalid date";break;case An.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:xn.assertNever(e.validation):n="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case An.too_small:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case An.too_big:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case An.custom:n="Invalid input";break;case An.invalid_intersection_types:n="Intersection results could not be merged";break;case An.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case An.not_finite:n="Number must be finite";break;default:n=t.defaultError,xn.assertNever(e)}return{message:n}};let On=Cn;function En(e,t){const n=On,s=(e=>{const{data:t,path:n,errorMaps:s,issueData:r}=e,a=[...n,...r.path||[]],i={...r,path:a};if(void 0!==r.message)return{...r,path:a,message:r.message};let o="";const u=s.filter(e=>!!e).slice().reverse();for(const e of u)o=e(i,{data:t,defaultError:o}).message;return{...r,path:a,message:o}})({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===Cn?void 0:Cn].filter(e=>!!e)});e.common.issues.push(s)}class Rn{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const s of t){if("aborted"===s.status)return Pn;"dirty"===s.status&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const e of t){const t=await e.key,s=await e.value;n.push({key:t,value:s})}return Rn.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const s of t){const{key:t,value:r}=s;if("aborted"===t.status)return Pn;if("aborted"===r.status)return Pn;"dirty"===t.status&&e.dirty(),"dirty"===r.status&&e.dirty(),"__proto__"===t.value||void 0===r.value&&!s.alwaysSet||(n[t.value]=r.value)}return{status:e.value,value:n}}}const Pn=Object.freeze({status:"aborted"}),Nn=e=>({status:"dirty",value:e}),$n=e=>({status:"valid",value:e}),Dn=e=>"aborted"===e.status,jn=e=>"dirty"===e.status,Mn=e=>"valid"===e.status,Ln=e=>"undefined"!=typeof Promise&&e instanceof Promise;var Zn;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(Zn||(Zn={}));class Fn{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Un=(e,t)=>{if(Mn(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new In(e.common.issues);return this._error=t,this._error}}};function Bn(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:s,description:r}=e;if(t&&(n||s))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:r}:{errorMap:(t,r)=>{const{message:a}=e;return"invalid_enum_value"===t.code?{message:a??r.defaultError}:void 0===r.data?{message:a??s??r.defaultError}:"invalid_type"!==t.code?{message:r.defaultError}:{message:a??n??r.defaultError}},description:r}}class qn{get description(){return this._def.description}_getType(e){return Tn(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Tn(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Rn,ctx:{common:e.parent.common,data:e.data,parsedType:Tn(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Ln(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){const n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Tn(e)},s=this._parseSync({data:e,path:n.path,parent:n});return Un(n,s)}"~validate"(e){const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Tn(e)};if(!this["~standard"].async)try{const n=this._parseSync({data:e,path:[],parent:t});return Mn(n)?{value:n.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>Mn(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Tn(e)},s=this._parse({data:e,path:n.path,parent:n}),r=await(Ln(s)?s:Promise.resolve(s));return Un(n,r)}refine(e,t){const n=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,s)=>{const r=e(t),a=()=>s.addIssue({code:An.custom,...n(t)});return"undefined"!=typeof Promise&&r instanceof Promise?r.then(e=>!!e||(a(),!1)):!!r||(a(),!1)})}refinement(e,t){return this._refinement((n,s)=>!!e(n)||(s.addIssue("function"==typeof t?t(n,s):t),!1))}_refinement(e){return new zs({schema:this,typeName:Qs.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Js.create(this,this._def)}nullable(){return Ws.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return As.create(this)}promise(){return qs.create(this,this._def)}or(e){return Os.create([this,e],this._def)}and(e){return Ns.create(this,e,this._def)}transform(e){return new zs({...Bn(this._def),schema:this,typeName:Qs.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new Gs({...Bn(this._def),innerType:this,defaultValue:t,typeName:Qs.ZodDefault})}brand(){return new Vs({typeName:Qs.ZodBranded,type:this,...Bn(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new Ks({...Bn(this._def),innerType:this,catchValue:t,typeName:Qs.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return Xs.create(this,e)}readonly(){return Ys.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const zn=/^c[^\s-]{8,}$/i,Jn=/^[0-9a-z]+$/,Wn=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Gn=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Kn=/^[a-z0-9_-]{21}$/i,Hn=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Vn=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Xn=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let Yn;const Qn=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,es=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ts=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ns=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,ss=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,rs=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,as="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",is=new RegExp(`^${as}$`);function os(e){let t="[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),`([01]\\d|2[0-3]):[0-5]\\d(:${t})${e.precision?"+":"?"}`}function us(e){return new RegExp(`^${os(e)}$`)}function cs(e){let t=`${as}T${os(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function ls(e,t){return!("v4"!==t&&t||!Qn.test(e))||!("v6"!==t&&t||!ts.test(e))}function ds(e,t){if(!Hn.test(e))return!1;try{const[n]=e.split("."),s=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),r=JSON.parse(atob(s));return!("object"!=typeof r||null===r||"typ"in r&&"JWT"!==r?.typ||!r.alg||t&&r.alg!==t)}catch{return!1}}function ps(e,t){return!("v4"!==t&&t||!es.test(e))||!("v6"!==t&&t||!ns.test(e))}class hs extends qn{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==kn.string){const t=this._getOrReturnCtx(e);return En(t,{code:An.invalid_type,expected:kn.string,received:t.parsedType}),Pn}const t=new Rn;let n;for(const s of this._def.checks)if("min"===s.kind)e.data.length<s.value&&(n=this._getOrReturnCtx(e,n),En(n,{code:An.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("max"===s.kind)e.data.length>s.value&&(n=this._getOrReturnCtx(e,n),En(n,{code:An.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("length"===s.kind){const r=e.data.length>s.value,a=e.data.length<s.value;(r||a)&&(n=this._getOrReturnCtx(e,n),r?En(n,{code:An.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&En(n,{code:An.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),t.dirty())}else if("email"===s.kind)Xn.test(e.data)||(n=this._getOrReturnCtx(e,n),En(n,{validation:"email",code:An.invalid_string,message:s.message}),t.dirty());else if("emoji"===s.kind)Yn||(Yn=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Yn.test(e.data)||(n=this._getOrReturnCtx(e,n),En(n,{validation:"emoji",code:An.invalid_string,message:s.message}),t.dirty());else if("uuid"===s.kind)Gn.test(e.data)||(n=this._getOrReturnCtx(e,n),En(n,{validation:"uuid",code:An.invalid_string,message:s.message}),t.dirty());else if("nanoid"===s.kind)Kn.test(e.data)||(n=this._getOrReturnCtx(e,n),En(n,{validation:"nanoid",code:An.invalid_string,message:s.message}),t.dirty());else if("cuid"===s.kind)zn.test(e.data)||(n=this._getOrReturnCtx(e,n),En(n,{validation:"cuid",code:An.invalid_string,message:s.message}),t.dirty());else if("cuid2"===s.kind)Jn.test(e.data)||(n=this._getOrReturnCtx(e,n),En(n,{validation:"cuid2",code:An.invalid_string,message:s.message}),t.dirty());else if("ulid"===s.kind)Wn.test(e.data)||(n=this._getOrReturnCtx(e,n),En(n,{validation:"ulid",code:An.invalid_string,message:s.message}),t.dirty());else if("url"===s.kind)try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),En(n,{validation:"url",code:An.invalid_string,message:s.message}),t.dirty()}else"regex"===s.kind?(s.regex.lastIndex=0,s.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),En(n,{validation:"regex",code:An.invalid_string,message:s.message}),t.dirty())):"trim"===s.kind?e.data=e.data.trim():"includes"===s.kind?e.data.includes(s.value,s.position)||(n=this._getOrReturnCtx(e,n),En(n,{code:An.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),t.dirty()):"toLowerCase"===s.kind?e.data=e.data.toLowerCase():"toUpperCase"===s.kind?e.data=e.data.toUpperCase():"startsWith"===s.kind?e.data.startsWith(s.value)||(n=this._getOrReturnCtx(e,n),En(n,{code:An.invalid_string,validation:{startsWith:s.value},message:s.message}),t.dirty()):"endsWith"===s.kind?e.data.endsWith(s.value)||(n=this._getOrReturnCtx(e,n),En(n,{code:An.invalid_string,validation:{endsWith:s.value},message:s.message}),t.dirty()):"datetime"===s.kind?cs(s).test(e.data)||(n=this._getOrReturnCtx(e,n),En(n,{code:An.invalid_string,validation:"datetime",message:s.message}),t.dirty()):"date"===s.kind?is.test(e.data)||(n=this._getOrReturnCtx(e,n),En(n,{code:An.invalid_string,validation:"date",message:s.message}),t.dirty()):"time"===s.kind?us(s).test(e.data)||(n=this._getOrReturnCtx(e,n),En(n,{code:An.invalid_string,validation:"time",message:s.message}),t.dirty()):"duration"===s.kind?Vn.test(e.data)||(n=this._getOrReturnCtx(e,n),En(n,{validation:"duration",code:An.invalid_string,message:s.message}),t.dirty()):"ip"===s.kind?ls(e.data,s.version)||(n=this._getOrReturnCtx(e,n),En(n,{validation:"ip",code:An.invalid_string,message:s.message}),t.dirty()):"jwt"===s.kind?ds(e.data,s.alg)||(n=this._getOrReturnCtx(e,n),En(n,{validation:"jwt",code:An.invalid_string,message:s.message}),t.dirty()):"cidr"===s.kind?ps(e.data,s.version)||(n=this._getOrReturnCtx(e,n),En(n,{validation:"cidr",code:An.invalid_string,message:s.message}),t.dirty()):"base64"===s.kind?ss.test(e.data)||(n=this._getOrReturnCtx(e,n),En(n,{validation:"base64",code:An.invalid_string,message:s.message}),t.dirty()):"base64url"===s.kind?rs.test(e.data)||(n=this._getOrReturnCtx(e,n),En(n,{validation:"base64url",code:An.invalid_string,message:s.message}),t.dirty()):xn.assertNever(s);return{status:t.value,value:e.data}}_regex(e,t,n){return this.refinement(t=>e.test(t),{validation:t,code:An.invalid_string,...Zn.errToObj(n)})}_addCheck(e){return new hs({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Zn.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Zn.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Zn.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Zn.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Zn.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Zn.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Zn.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Zn.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Zn.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Zn.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Zn.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Zn.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Zn.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...Zn.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...Zn.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...Zn.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Zn.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...Zn.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Zn.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Zn.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Zn.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Zn.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Zn.errToObj(t)})}nonempty(e){return this.min(1,Zn.errToObj(e))}trim(){return new hs({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new hs({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new hs({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function fs(e,t){const n=(e.toString().split(".")[1]||"").length,s=(t.toString().split(".")[1]||"").length,r=n>s?n:s;return Number.parseInt(e.toFixed(r).replace(".",""))%Number.parseInt(t.toFixed(r).replace(".",""))/10**r}hs.create=e=>new hs({checks:[],typeName:Qs.ZodString,coerce:e?.coerce??!1,...Bn(e)});class ms extends qn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==kn.number){const t=this._getOrReturnCtx(e);return En(t,{code:An.invalid_type,expected:kn.number,received:t.parsedType}),Pn}let t;const n=new Rn;for(const s of this._def.checks)"int"===s.kind?xn.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),En(t,{code:An.invalid_type,expected:"integer",received:"float",message:s.message}),n.dirty()):"min"===s.kind?(s.inclusive?e.data<s.value:e.data<=s.value)&&(t=this._getOrReturnCtx(e,t),En(t,{code:An.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),n.dirty()):"max"===s.kind?(s.inclusive?e.data>s.value:e.data>=s.value)&&(t=this._getOrReturnCtx(e,t),En(t,{code:An.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),n.dirty()):"multipleOf"===s.kind?0!==fs(e.data,s.value)&&(t=this._getOrReturnCtx(e,t),En(t,{code:An.not_multiple_of,multipleOf:s.value,message:s.message}),n.dirty()):"finite"===s.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),En(t,{code:An.not_finite,message:s.message}),n.dirty()):xn.assertNever(s);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Zn.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Zn.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Zn.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Zn.toString(t))}setLimit(e,t,n,s){return new ms({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Zn.toString(s)}]})}_addCheck(e){return new ms({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Zn.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Zn.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Zn.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Zn.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Zn.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Zn.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Zn.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Zn.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Zn.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&xn.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===t||n.value>t)&&(t=n.value):"max"===n.kind&&(null===e||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ms.create=e=>new ms({checks:[],typeName:Qs.ZodNumber,coerce:e?.coerce||!1,...Bn(e)});class gs extends qn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==kn.bigint)return this._getInvalidInput(e);let t;const n=new Rn;for(const s of this._def.checks)"min"===s.kind?(s.inclusive?e.data<s.value:e.data<=s.value)&&(t=this._getOrReturnCtx(e,t),En(t,{code:An.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),n.dirty()):"max"===s.kind?(s.inclusive?e.data>s.value:e.data>=s.value)&&(t=this._getOrReturnCtx(e,t),En(t,{code:An.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),n.dirty()):"multipleOf"===s.kind?e.data%s.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),En(t,{code:An.not_multiple_of,multipleOf:s.value,message:s.message}),n.dirty()):xn.assertNever(s);return{status:n.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return En(t,{code:An.invalid_type,expected:kn.bigint,received:t.parsedType}),Pn}gte(e,t){return this.setLimit("min",e,!0,Zn.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Zn.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Zn.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Zn.toString(t))}setLimit(e,t,n,s){return new gs({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Zn.toString(s)}]})}_addCheck(e){return new gs({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Zn.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Zn.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Zn.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Zn.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Zn.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}gs.create=e=>new gs({checks:[],typeName:Qs.ZodBigInt,coerce:e?.coerce??!1,...Bn(e)});class ys extends qn{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==kn.boolean){const t=this._getOrReturnCtx(e);return En(t,{code:An.invalid_type,expected:kn.boolean,received:t.parsedType}),Pn}return $n(e.data)}}ys.create=e=>new ys({typeName:Qs.ZodBoolean,coerce:e?.coerce||!1,...Bn(e)});class _s extends qn{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==kn.date){const t=this._getOrReturnCtx(e);return En(t,{code:An.invalid_type,expected:kn.date,received:t.parsedType}),Pn}if(Number.isNaN(e.data.getTime()))return En(this._getOrReturnCtx(e),{code:An.invalid_date}),Pn;const t=new Rn;let n;for(const s of this._def.checks)"min"===s.kind?e.data.getTime()<s.value&&(n=this._getOrReturnCtx(e,n),En(n,{code:An.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),t.dirty()):"max"===s.kind?e.data.getTime()>s.value&&(n=this._getOrReturnCtx(e,n),En(n,{code:An.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),t.dirty()):xn.assertNever(s);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new _s({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Zn.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Zn.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}_s.create=e=>new _s({checks:[],coerce:e?.coerce||!1,typeName:Qs.ZodDate,...Bn(e)});class vs extends qn{_parse(e){if(this._getType(e)!==kn.symbol){const t=this._getOrReturnCtx(e);return En(t,{code:An.invalid_type,expected:kn.symbol,received:t.parsedType}),Pn}return $n(e.data)}}vs.create=e=>new vs({typeName:Qs.ZodSymbol,...Bn(e)});class ws extends qn{_parse(e){if(this._getType(e)!==kn.undefined){const t=this._getOrReturnCtx(e);return En(t,{code:An.invalid_type,expected:kn.undefined,received:t.parsedType}),Pn}return $n(e.data)}}ws.create=e=>new ws({typeName:Qs.ZodUndefined,...Bn(e)});class bs extends qn{_parse(e){if(this._getType(e)!==kn.null){const t=this._getOrReturnCtx(e);return En(t,{code:An.invalid_type,expected:kn.null,received:t.parsedType}),Pn}return $n(e.data)}}bs.create=e=>new bs({typeName:Qs.ZodNull,...Bn(e)});class xs extends qn{constructor(){super(...arguments),this._any=!0}_parse(e){return $n(e.data)}}xs.create=e=>new xs({typeName:Qs.ZodAny,...Bn(e)});class Ss extends qn{constructor(){super(...arguments),this._unknown=!0}_parse(e){return $n(e.data)}}Ss.create=e=>new Ss({typeName:Qs.ZodUnknown,...Bn(e)});class ks extends qn{_parse(e){const t=this._getOrReturnCtx(e);return En(t,{code:An.invalid_type,expected:kn.never,received:t.parsedType}),Pn}}ks.create=e=>new ks({typeName:Qs.ZodNever,...Bn(e)});class Ts extends qn{_parse(e){if(this._getType(e)!==kn.undefined){const t=this._getOrReturnCtx(e);return En(t,{code:An.invalid_type,expected:kn.void,received:t.parsedType}),Pn}return $n(e.data)}}Ts.create=e=>new Ts({typeName:Qs.ZodVoid,...Bn(e)});class As extends qn{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==kn.array)return En(t,{code:An.invalid_type,expected:kn.array,received:t.parsedType}),Pn;if(null!==s.exactLength){const e=t.data.length>s.exactLength.value,r=t.data.length<s.exactLength.value;(e||r)&&(En(t,{code:e?An.too_big:An.too_small,minimum:r?s.exactLength.value:void 0,maximum:e?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(null!==s.minLength&&t.data.length<s.minLength.value&&(En(t,{code:An.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),null!==s.maxLength&&t.data.length>s.maxLength.value&&(En(t,{code:An.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((e,n)=>s.type._parseAsync(new Fn(t,e,t.path,n)))).then(e=>Rn.mergeArray(n,e));const r=[...t.data].map((e,n)=>s.type._parseSync(new Fn(t,e,t.path,n)));return Rn.mergeArray(n,r)}get element(){return this._def.type}min(e,t){return new As({...this._def,minLength:{value:e,message:Zn.toString(t)}})}max(e,t){return new As({...this._def,maxLength:{value:e,message:Zn.toString(t)}})}length(e,t){return new As({...this._def,exactLength:{value:e,message:Zn.toString(t)}})}nonempty(e){return this.min(1,e)}}function Is(e){if(e instanceof Cs){const t={};for(const n in e.shape){const s=e.shape[n];t[n]=Js.create(Is(s))}return new Cs({...e._def,shape:()=>t})}return e instanceof As?new As({...e._def,type:Is(e.element)}):e instanceof Js?Js.create(Is(e.unwrap())):e instanceof Ws?Ws.create(Is(e.unwrap())):e instanceof $s?$s.create(e.items.map(e=>Is(e))):e}As.create=(e,t)=>new As({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Qs.ZodArray,...Bn(t)});class Cs extends qn{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=xn.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==kn.object){const t=this._getOrReturnCtx(e);return En(t,{code:An.invalid_type,expected:kn.object,received:t.parsedType}),Pn}const{status:t,ctx:n}=this._processInputParams(e),{shape:s,keys:r}=this._getCached(),a=[];if(!(this._def.catchall instanceof ks&&"strip"===this._def.unknownKeys))for(const e in n.data)r.includes(e)||a.push(e);const i=[];for(const e of r){const t=s[e],r=n.data[e];i.push({key:{status:"valid",value:e},value:t._parse(new Fn(n,r,n.path,e)),alwaysSet:e in n.data})}if(this._def.catchall instanceof ks){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of a)i.push({key:{status:"valid",value:e},value:{status:"valid",value:n.data[e]}});else if("strict"===e)a.length>0&&(En(n,{code:An.unrecognized_keys,keys:a}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of a){const s=n.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new Fn(n,s,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const e=[];for(const t of i){const n=await t.key,s=await t.value;e.push({key:n,value:s,alwaysSet:t.alwaysSet})}return e}).then(e=>Rn.mergeObjectSync(t,e)):Rn.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return Zn.errToObj,new Cs({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,n)=>{const s=this._def.errorMap?.(t,n).message??n.defaultError;return"unrecognized_keys"===t.code?{message:Zn.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new Cs({...this._def,unknownKeys:"strip"})}passthrough(){return new Cs({...this._def,unknownKeys:"passthrough"})}extend(e){return new Cs({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Cs({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Qs.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Cs({...this._def,catchall:e})}pick(e){const t={};for(const n of xn.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new Cs({...this._def,shape:()=>t})}omit(e){const t={};for(const n of xn.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new Cs({...this._def,shape:()=>t})}deepPartial(){return Is(this)}partial(e){const t={};for(const n of xn.objectKeys(this.shape)){const s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}return new Cs({...this._def,shape:()=>t})}required(e){const t={};for(const n of xn.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let e=this.shape[n];for(;e instanceof Js;)e=e._def.innerType;t[n]=e}return new Cs({...this._def,shape:()=>t})}keyof(){return Fs(xn.objectKeys(this.shape))}}Cs.create=(e,t)=>new Cs({shape:()=>e,unknownKeys:"strip",catchall:ks.create(),typeName:Qs.ZodObject,...Bn(t)}),Cs.strictCreate=(e,t)=>new Cs({shape:()=>e,unknownKeys:"strict",catchall:ks.create(),typeName:Qs.ZodObject,...Bn(t)}),Cs.lazycreate=(e,t)=>new Cs({shape:e,unknownKeys:"strip",catchall:ks.create(),typeName:Qs.ZodObject,...Bn(t)});class Os extends qn{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;if(t.common.async)return Promise.all(n.map(async e=>{const n={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}})).then(function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const n of e)if("dirty"===n.result.status)return t.common.issues.push(...n.ctx.common.issues),n.result;const n=e.map(e=>new In(e.ctx.common.issues));return En(t,{code:An.invalid_union,unionErrors:n}),Pn});{let e;const s=[];for(const r of n){const n={...t,common:{...t.common,issues:[]},parent:null},a=r._parseSync({data:t.data,path:t.path,parent:n});if("valid"===a.status)return a;"dirty"!==a.status||e||(e={result:a,ctx:n}),n.common.issues.length&&s.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const r=s.map(e=>new In(e));return En(t,{code:An.invalid_union,unionErrors:r}),Pn}}get options(){return this._def.options}}Os.create=(e,t)=>new Os({options:e,typeName:Qs.ZodUnion,...Bn(t)});const Es=e=>e instanceof Ls?Es(e.schema):e instanceof zs?Es(e.innerType()):e instanceof Zs?[e.value]:e instanceof Us?e.options:e instanceof Bs?xn.objectValues(e.enum):e instanceof Gs?Es(e._def.innerType):e instanceof ws?[void 0]:e instanceof bs?[null]:e instanceof Js?[void 0,...Es(e.unwrap())]:e instanceof Ws?[null,...Es(e.unwrap())]:e instanceof Vs||e instanceof Ys?Es(e.unwrap()):e instanceof Ks?Es(e._def.innerType):[];class Rs extends qn{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==kn.object)return En(t,{code:An.invalid_type,expected:kn.object,received:t.parsedType}),Pn;const n=this.discriminator,s=t.data[n],r=this.optionsMap.get(s);return r?t.common.async?r._parseAsync({data:t.data,path:t.path,parent:t}):r._parseSync({data:t.data,path:t.path,parent:t}):(En(t,{code:An.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),Pn)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const s=new Map;for(const n of t){const t=Es(n.shape[e]);if(!t.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const r of t){if(s.has(r))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(r)}`);s.set(r,n)}}return new Rs({typeName:Qs.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...Bn(n)})}}function Ps(e,t){const n=Tn(e),s=Tn(t);if(e===t)return{valid:!0,data:e};if(n===kn.object&&s===kn.object){const n=xn.objectKeys(t),s=xn.objectKeys(e).filter(e=>-1!==n.indexOf(e)),r={...e,...t};for(const n of s){const s=Ps(e[n],t[n]);if(!s.valid)return{valid:!1};r[n]=s.data}return{valid:!0,data:r}}if(n===kn.array&&s===kn.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let s=0;s<e.length;s++){const r=Ps(e[s],t[s]);if(!r.valid)return{valid:!1};n.push(r.data)}return{valid:!0,data:n}}return n===kn.date&&s===kn.date&&+e===+t?{valid:!0,data:e}:{valid:!1}}class Ns extends qn{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=(e,s)=>{if(Dn(e)||Dn(s))return Pn;const r=Ps(e.value,s.value);return r.valid?((jn(e)||jn(s))&&t.dirty(),{status:t.value,value:r.data}):(En(n,{code:An.invalid_intersection_types}),Pn)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([e,t])=>s(e,t)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Ns.create=(e,t,n)=>new Ns({left:e,right:t,typeName:Qs.ZodIntersection,...Bn(n)});class $s extends qn{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==kn.array)return En(n,{code:An.invalid_type,expected:kn.array,received:n.parsedType}),Pn;if(n.data.length<this._def.items.length)return En(n,{code:An.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Pn;!this._def.rest&&n.data.length>this._def.items.length&&(En(n,{code:An.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const s=[...n.data].map((e,t)=>{const s=this._def.items[t]||this._def.rest;return s?s._parse(new Fn(n,e,n.path,t)):null}).filter(e=>!!e);return n.common.async?Promise.all(s).then(e=>Rn.mergeArray(t,e)):Rn.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new $s({...this._def,rest:e})}}$s.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new $s({items:e,typeName:Qs.ZodTuple,rest:null,...Bn(t)})};class Ds extends qn{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==kn.object)return En(n,{code:An.invalid_type,expected:kn.object,received:n.parsedType}),Pn;const s=[],r=this._def.keyType,a=this._def.valueType;for(const e in n.data)s.push({key:r._parse(new Fn(n,e,n.path,e)),value:a._parse(new Fn(n,n.data[e],n.path,e)),alwaysSet:e in n.data});return n.common.async?Rn.mergeObjectAsync(t,s):Rn.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return new Ds(t instanceof qn?{keyType:e,valueType:t,typeName:Qs.ZodRecord,...Bn(n)}:{keyType:hs.create(),valueType:e,typeName:Qs.ZodRecord,...Bn(t)})}}class js extends qn{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==kn.map)return En(n,{code:An.invalid_type,expected:kn.map,received:n.parsedType}),Pn;const s=this._def.keyType,r=this._def.valueType,a=[...n.data.entries()].map(([e,t],a)=>({key:s._parse(new Fn(n,e,n.path,[a,"key"])),value:r._parse(new Fn(n,t,n.path,[a,"value"]))}));if(n.common.async){const e=new Map;return Promise.resolve().then(async()=>{for(const n of a){const s=await n.key,r=await n.value;if("aborted"===s.status||"aborted"===r.status)return Pn;"dirty"!==s.status&&"dirty"!==r.status||t.dirty(),e.set(s.value,r.value)}return{status:t.value,value:e}})}{const e=new Map;for(const n of a){const s=n.key,r=n.value;if("aborted"===s.status||"aborted"===r.status)return Pn;"dirty"!==s.status&&"dirty"!==r.status||t.dirty(),e.set(s.value,r.value)}return{status:t.value,value:e}}}}js.create=(e,t,n)=>new js({valueType:t,keyType:e,typeName:Qs.ZodMap,...Bn(n)});class Ms extends qn{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==kn.set)return En(n,{code:An.invalid_type,expected:kn.set,received:n.parsedType}),Pn;const s=this._def;null!==s.minSize&&n.data.size<s.minSize.value&&(En(n,{code:An.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),null!==s.maxSize&&n.data.size>s.maxSize.value&&(En(n,{code:An.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const r=this._def.valueType;function a(e){const n=new Set;for(const s of e){if("aborted"===s.status)return Pn;"dirty"===s.status&&t.dirty(),n.add(s.value)}return{status:t.value,value:n}}const i=[...n.data.values()].map((e,t)=>r._parse(new Fn(n,e,n.path,t)));return n.common.async?Promise.all(i).then(e=>a(e)):a(i)}min(e,t){return new Ms({...this._def,minSize:{value:e,message:Zn.toString(t)}})}max(e,t){return new Ms({...this._def,maxSize:{value:e,message:Zn.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Ms.create=(e,t)=>new Ms({valueType:e,minSize:null,maxSize:null,typeName:Qs.ZodSet,...Bn(t)});class Ls extends qn{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Ls.create=(e,t)=>new Ls({getter:e,typeName:Qs.ZodLazy,...Bn(t)});class Zs extends qn{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return En(t,{received:t.data,code:An.invalid_literal,expected:this._def.value}),Pn}return{status:"valid",value:e.data}}get value(){return this._def.value}}function Fs(e,t){return new Us({values:e,typeName:Qs.ZodEnum,...Bn(t)})}Zs.create=(e,t)=>new Zs({value:e,typeName:Qs.ZodLiteral,...Bn(t)});class Us extends qn{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),n=this._def.values;return En(t,{expected:xn.joinValues(n),received:t.parsedType,code:An.invalid_type}),Pn}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return En(t,{received:t.data,code:An.invalid_enum_value,options:n}),Pn}return $n(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Us.create(e,{...this._def,...t})}exclude(e,t=this._def){return Us.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}Us.create=Fs;class Bs extends qn{_parse(e){const t=xn.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==kn.string&&n.parsedType!==kn.number){const e=xn.objectValues(t);return En(n,{expected:xn.joinValues(e),received:n.parsedType,code:An.invalid_type}),Pn}if(this._cache||(this._cache=new Set(xn.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const e=xn.objectValues(t);return En(n,{received:n.data,code:An.invalid_enum_value,options:e}),Pn}return $n(e.data)}get enum(){return this._def.values}}Bs.create=(e,t)=>new Bs({values:e,typeName:Qs.ZodNativeEnum,...Bn(t)});class qs extends qn{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==kn.promise&&!1===t.common.async)return En(t,{code:An.invalid_type,expected:kn.promise,received:t.parsedType}),Pn;const n=t.parsedType===kn.promise?t.data:Promise.resolve(t.data);return $n(n.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}qs.create=(e,t)=>new qs({type:e,typeName:Qs.ZodPromise,...Bn(t)});class zs extends qn{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Qs.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,r={addIssue:e=>{En(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(r.addIssue=r.addIssue.bind(r),"preprocess"===s.type){const e=s.transform(n.data,r);if(n.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return Pn;const s=await this._def.schema._parseAsync({data:e,path:n.path,parent:n});return"aborted"===s.status?Pn:"dirty"===s.status||"dirty"===t.value?Nn(s.value):s});{if("aborted"===t.value)return Pn;const s=this._def.schema._parseSync({data:e,path:n.path,parent:n});return"aborted"===s.status?Pn:"dirty"===s.status||"dirty"===t.value?Nn(s.value):s}}if("refinement"===s.type){const e=e=>{const t=s.refinement(e,r);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===n.common.async){const s=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===s.status?Pn:("dirty"===s.status&&t.dirty(),e(s.value),{status:t.value,value:s.value})}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(n=>"aborted"===n.status?Pn:("dirty"===n.status&&t.dirty(),e(n.value).then(()=>({status:t.value,value:n.value}))))}if("transform"===s.type){if(!1===n.common.async){const e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Mn(e))return Pn;const a=s.transform(e.value,r);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(e=>Mn(e)?Promise.resolve(s.transform(e.value,r)).then(e=>({status:t.value,value:e})):Pn)}xn.assertNever(s)}}zs.create=(e,t,n)=>new zs({schema:e,typeName:Qs.ZodEffects,effect:t,...Bn(n)}),zs.createWithPreprocess=(e,t,n)=>new zs({schema:t,effect:{type:"preprocess",transform:e},typeName:Qs.ZodEffects,...Bn(n)});class Js extends qn{_parse(e){return this._getType(e)===kn.undefined?$n(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Js.create=(e,t)=>new Js({innerType:e,typeName:Qs.ZodOptional,...Bn(t)});class Ws extends qn{_parse(e){return this._getType(e)===kn.null?$n(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ws.create=(e,t)=>new Ws({innerType:e,typeName:Qs.ZodNullable,...Bn(t)});class Gs extends qn{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===kn.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Gs.create=(e,t)=>new Gs({innerType:e,typeName:Qs.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...Bn(t)});class Ks extends qn{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Ln(s)?s.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new In(n.common.issues)},input:n.data})})):{status:"valid",value:"valid"===s.status?s.value:this._def.catchValue({get error(){return new In(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Ks.create=(e,t)=>new Ks({innerType:e,typeName:Qs.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...Bn(t)});class Hs extends qn{_parse(e){if(this._getType(e)!==kn.nan){const t=this._getOrReturnCtx(e);return En(t,{code:An.invalid_type,expected:kn.nan,received:t.parsedType}),Pn}return{status:"valid",value:e.data}}}Hs.create=e=>new Hs({typeName:Qs.ZodNaN,...Bn(e)}),Symbol("zod_brand");class Vs extends qn{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class Xs extends qn{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Pn:"dirty"===e.status?(t.dirty(),Nn(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})();{const e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Pn:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(e,t){return new Xs({in:e,out:t,typeName:Qs.ZodPipeline})}}class Ys extends qn{_parse(e){const t=this._def.innerType._parse(e),n=e=>(Mn(e)&&(e.value=Object.freeze(e.value)),e);return Ln(t)?t.then(e=>n(e)):n(t)}unwrap(){return this._def.innerType}}var Qs;Ys.create=(e,t)=>new Ys({innerType:e,typeName:Qs.ZodReadonly,...Bn(t)}),Cs.lazycreate,function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(Qs||(Qs={}));const er=hs.create,tr=ms.create,nr=(Hs.create,gs.create,ys.create),sr=(_s.create,vs.create,ws.create,bs.create,xs.create),rr=(Ss.create,ks.create,Ts.create,As.create),ar=Cs.create,ir=(Cs.strictCreate,Os.create),or=Rs.create,ur=(Ns.create,$s.create,Ds.create),cr=(js.create,Ms.create,Ls.create),lr=Zs.create,dr=Us.create;Bs.create,qs.create,zs.create,Js.create,Ws.create,zs.createWithPreprocess,Xs.create;class pr{cacheToolsList;_cachedTools=void 0;toolFilter;logger;constructor(e){this.logger=e.logger??pn("openai-agents:stdio-mcp-client"),this.cacheToolsList=e.cacheToolsList??!1,this.toolFilter=e.toolFilter}debugLog(e){an.enabled(this.logger.namespace)&&this.logger.debug(e())}}class hr{cacheToolsList;_cachedTools=void 0;toolFilter;logger;constructor(e){this.logger=e.logger??pn("openai-agents:streamable-http-mcp-client"),this.cacheToolsList=e.cacheToolsList??!1,this.toolFilter=e.toolFilter}debugLog(e){an.enabled(this.logger.namespace)&&this.logger.debug(e())}}class fr{cacheToolsList;_cachedTools=void 0;toolFilter;logger;constructor(e){this.logger=e.logger??pn("openai-agents:sse-mcp-client"),this.cacheToolsList=e.cacheToolsList??!1,this.toolFilter=e.toolFilter}debugLog(e){an.enabled(this.logger.namespace)&&this.logger.debug(e())}}ar({name:er(),description:er().optional(),inputSchema:ar({type:lr("object"),properties:ur(er(),sr()),required:rr(er()),additionalProperties:nr()})});class mr extends pr{underlying;constructor(e){super(e),this.underlying=new Sr(e)}get name(){return this.underlying.name}connect(){return this.underlying.connect()}close(){return this.underlying.close()}async listTools(){if(this.cacheToolsList&&this._cachedTools)return this._cachedTools;const e=await this.underlying.listTools();return this.cacheToolsList&&(this._cachedTools=e),e}callTool(e,t){return this.underlying.callTool(e,t)}invalidateToolsCache(){return this.underlying.invalidateToolsCache()}}class gr extends hr{underlying;constructor(e){super(e),this.underlying=new kr(e)}get name(){return this.underlying.name}connect(){return this.underlying.connect()}close(){return this.underlying.close()}async listTools(){if(this.cacheToolsList&&this._cachedTools)return this._cachedTools;const e=await this.underlying.listTools();return this.cacheToolsList&&(this._cachedTools=e),e}callTool(e,t){return this.underlying.callTool(e,t)}invalidateToolsCache(){return this.underlying.invalidateToolsCache()}}class yr extends fr{underlying;constructor(e){super(e),this.underlying=new Tr(e)}get name(){return this.underlying.name}connect(){return this.underlying.connect()}close(){return this.underlying.close()}async listTools(){if(this.cacheToolsList&&this._cachedTools)return this._cachedTools;const e=await this.underlying.listTools();return this.cacheToolsList&&(this._cachedTools=e),e}callTool(e,t){return this.underlying.callTool(e,t)}invalidateToolsCache(){return this.underlying.invalidateToolsCache()}}const _r={};async function vr(e){delete _r[e]}async function wr({server:e,convertSchemasToStrict:t,runContext:n,agent:s}){return e.cacheToolsList&&_r[e.name]?_r[e.name].map(n=>xr(n,e,t)):Ea(async r=>{const a=await e.listTools();let i=a;if(n&&s){const t={runContext:n,agent:s,serverName:e.name},r=[];for(const n of a){const s=e.toolFilter;if(s)if("function"==typeof s){if(!await s(t,n)){hn.debug(`MCP Tool (server: ${e.name}, tool: ${n.name}) is blocked by the callable filter.`);continue}}else{const t=s.allowedToolNames??[],r=s.blockedToolNames??[];if(t.length>0||r.length>0){const s=!(t.length>0)||t.includes(n.name),a=r.length>0&&r.includes(n.name);if(!s||a){a?hn.debug(`MCP Tool (server: ${e.name}, tool: ${n.name}) is blocked by the static filter.`):s||hn.debug(`MCP Tool (server: ${e.name}, tool: ${n.name}) is not allowed by the static filter.`);continue}}}r.push(n)}i=r}r.spanData.result=i.map(e=>e.name);const o=i.map(n=>xr(n,e,t));return e.cacheToolsList&&(_r[e.name]=i),o},{data:{server:e.name}})}async function br(e,t,n,s=!1){const r=Array.isArray(e)?{mcpServers:e,runContext:t,agent:n,convertSchemasToStrict:s}:e,{mcpServers:a,convertSchemasToStrict:i=!1,runContext:o,agent:u}=r,c=[],l=new Set;for(const e of a){const t=await wr({server:e,convertSchemasToStrict:i,runContext:o,agent:u}),n=[...new Set(t.map(e=>e.name))].filter(e=>l.has(e));if(n.length>0)throw new Vt(`Duplicate tool names found across MCP servers: ${n.join(", ")}`);for(const e of t)l.add(e.name),c.push(e)}return c}function xr(e,t,n){async function s(n,s){let r={};"string"==typeof n&&n?r=JSON.parse(n):"object"==typeof n&&null!=n&&(r=n);const a=jr();a&&(a.spanData.mcp_data={server:t.name});const i=await t.callTool(e.name,r);return 1===i.length?i[0]:i}const r={...e.inputSchema,type:e.inputSchema?.type??"object",properties:e.inputSchema?.properties??{},required:e.inputSchema?.required??[],additionalProperties:e.inputSchema?.additionalProperties??!1};if(n||!0===r.additionalProperties)try{const t=function(e){const t={...e,additionalProperties:!1};return t.required||(t.required=[]),t}(r);return vn({name:e.name,description:e.description||"",parameters:t,strict:!0,execute:s})}catch(e){hn.warn(`Error converting MCP schema to strict mode: ${e}`)}const a={...r,additionalProperties:!0};return vn({name:e.name,description:e.description||"",parameters:a,strict:!1,execute:s})}class Sr extends pr{constructor(e){super(e)}get name(){return"MCPServerStdio"}connect(){throw new Error("Method not implemented.")}close(){throw new Error("Method not implemented.")}listTools(){throw new Error("Method not implemented.")}callTool(e,t){throw new Error("Method not implemented.")}invalidateToolsCache(){throw new Error("Method not implemented.")}}class kr extends hr{constructor(e){super(e)}get name(){return"MCPServerStdio"}connect(){throw new Error("Method not implemented.")}close(){throw new Error("Method not implemented.")}listTools(){throw new Error("Method not implemented.")}callTool(e,t){throw new Error("Method not implemented.")}invalidateToolsCache(){throw new Error("Method not implemented.")}}class Tr extends fr{constructor(e){super(e)}get name(){return"MCPServerSSE"}connect(){throw new Error("Method not implemented.")}close(){throw new Error("Method not implemented.")}listTools(){throw new Error("Method not implemented.")}callTool(e,t){throw new Error("Method not implemented.")}invalidateToolsCache(){throw new Error("Method not implemented.")}}class Ar{#e=new EventTarget;on(e,t){return this.#e.addEventListener(e,e=>t(...e.detail??[])),this}off(e,t){return this.#e.removeEventListener(e,e=>t(...e.detail??[])),this}emit(e,...t){const n=new CustomEvent(e,{detail:t});return this.#e.dispatchEvent(n)}once(e,t){const n=(...s)=>{this.off(e,n),t(...s)};return this.on(e,n),this}}const Ir=crypto.randomUUID.bind(crypto),Cr=class{constructor(){}pipeTo(e,t){}pipeThrough(e,t){}},Or=globalThis.ReadableStream,Er=(globalThis.ReadableStreamDefaultController,globalThis.TransformStream);class Rr{context=null;constructor(){}run(e,t){return this.context=e,t()}getStore(){return this.context}enterWith(e){this.context=e}}const Pr=new class{constructor(){}setTimeout(e,t){const n=setTimeout(e,t);return n.ref="function"==typeof n.ref?n.ref:()=>n,n.unref="function"==typeof n.unref?n.unref:()=>n,n.hasRef="function"==typeof n.hasRef?n.hasRef:()=>!0,n.refresh="function"==typeof n.refresh?n.refresh:()=>n,n}clearTimeout(e){window.clearTimeout(e)}};let Nr;function $r(){return Nr??=new Rr,Nr}function Dr(){const e=$r().getStore();return e?.trace?e.trace:null}function jr(){const e=$r().getStore();return e?.span?e.span:null}function Mr(e){return async()=>{const t=Dr();if(!t)throw new Error("No trace found");await t.start();const n=await e(t);return await t.end(),n}}async function Lr(e,t,n={}){const s="string"==typeof e?oa().createTrace({...n,name:e}):e;return $r().run({trace:s},Mr(t))}async function Zr(e,t={}){if(Dr())return await e();const n=oa().createTrace(t);return $r().run({trace:n},Mr(e))}function Fr(e){const t=$r().getStore();if(!t)throw new Error("No existing trace found");t.span&&(t.span.previousSpan=t.previousSpan,t.previousSpan=t.span),t.span=e,$r().enterWith(t)}function Ur(){const e=$r().getStore();e&&(e.span=e.previousSpan,e.previousSpan=e.previousSpan?.previousSpan,$r().enterWith(e))}function Br(e){const t=jr();t&&t.setError(e)}function qr(e){const t=$r().getStore();if(!t)throw new Error("No existing trace found");const n=(s=t,{trace:s.trace?.clone(),span:s.span?.clone(),previousSpan:s.previousSpan?.clone()});var s;return $r().run(n,e)}class zr{async export(e){if(un.disabled)fn.debug("Tracing is disabled. Skipping export");else for(const t of e)"trace"===t.type?console.log(`[Exporter] Export trace traceId=${t.traceId} name=${t.name}`):console.log(`[Exporter] Export span: ${JSON.stringify(t)}`)}}class Jr{#t;#n;#s;#r;#a;#i=[];#o;#u=null;#c=!1;#l=null;constructor(e,{maxQueueSize:t=1e3,maxBatchSize:n=100,scheduleDelay:s=5e3,exportTriggerRatio:r=.8}={}){this.#t=t,this.#n=n,this.#s=s,this.#r=t*r,this.#a=e,this.#o=Pr,fn.debug("Automatic trace export loop is not supported in this environment. You need to manually call `getGlobalTraceProvider().forceFlush()` to export traces.")}start(){this.#l=new AbortController,this.#d()}async#p(e){this.#i.length+1>this.#t?fn.error("Dropping trace because buffer is full"):(this.#i.push(e),this.#i.length>this.#r&&await this.#h())}#d(){this.#u=this.#o.setTimeout(async()=>{await this.#h(),this.#d()},this.#s),"function"==typeof this.#u.unref&&this.#u.unref()}async#h(e=!1){if(0!==this.#i.length)if(fn.debug(`Exporting batches. Force: ${e}. Buffer size: ${this.#i.length}`),e||this.#i.length<this.#n){const e=[...this.#i];this.#i=[],this.#c=!0,await this.#a.export(e),this.#c=!1}else if(this.#i.length>0){const e=this.#i.splice(0,this.#n);this.#c=!0,await this.#a.export(e),this.#c=!1}}async onTraceStart(e){await this.#p(e)}async onTraceEnd(e){}async onSpanStart(e){}async onSpanEnd(e){await this.#p(e)}async shutdown(e){for(e&&this.#o.setTimeout(()=>{this.#l?.abort()},e),fn.debug("Shutting down gracefully");this.#i.length>0;){if(fn.debug(`Waiting for buffer to empty. Items left: ${this.#i.length}`),this.#c||await this.#h(!0),this.#l?.signal.aborted){fn.debug("Timeout reached, force flushing"),await this.#h(!0);break}await new Promise(e=>this.#o.setTimeout(e,500))}fn.debug("Buffer empty. Exiting"),this.#o&&this.#u&&this.#o.clearTimeout(this.#u)}async forceFlush(){this.#i.length>0&&await this.#h(!0)}}class Wr{#f=[];start(){for(const e of this.#f)e.start&&e.start()}addTraceProcessor(e){this.#f.push(e)}setProcessors(e){fn.debug("Shutting down old processors");for(const e of this.#f)e.shutdown();this.#f=e}async onTraceStart(e){for(const t of this.#f)await t.onTraceStart(e)}async onTraceEnd(e){for(const t of this.#f)await t.onTraceEnd(e)}async onSpanStart(e){for(const t of this.#f)await t.onSpanStart(e)}async onSpanEnd(e){for(const t of this.#f)await t.onSpanEnd(e)}async shutdown(e){for(const t of this.#f)await t.shutdown(e)}async forceFlush(){for(const e of this.#f)await e.forceFlush()}}let Gr,Kr=null,Hr=null;function Vr(){return Hr||(Hr=new Jr((Kr||(Kr=new zr),Kr))),Hr}function Xr(){return(new Date).toISOString()}function Yr(){return`trace_${Ir().replace(/-/g,"")}`}function Qr(){return`span_${Ir().replace(/-/g,"").slice(0,24)}`}function ea(){return`group_${Ir().replace(/-/g,"").slice(0,24)}`}class ta{type="trace.span";#m;#g;#y;#_;#v;#w;#b;#x;#S;constructor(e,t){this.#g=e.traceId,this.#y=e.spanId??Qr(),this.#m=e.data,this.#v=t,this.#_=e.parentId??null,this.#x=e.error??null,this.#w=e.startedAt??null,this.#b=e.endedAt??null}get traceId(){return this.#g}get spanData(){return this.#m}get spanId(){return this.#y}get parentId(){return this.#_}get previousSpan(){return this.#S}set previousSpan(e){this.#S=e}start(){this.#w?fn.warn("Span already started"):(this.#w=Xr(),this.#v.onSpanStart(this))}end(){this.#b?fn.debug("Span already finished",this.spanData):(this.#b=Xr(),this.#v.onSpanEnd(this))}setError(e){this.#x=e}get error(){return this.#x}get startedAt(){return this.#w}get endedAt(){return this.#b}clone(){const e=new ta({traceId:this.traceId,spanId:this.spanId,parentId:this.parentId??void 0,data:this.spanData,startedAt:this.#w??void 0,endedAt:this.#b??void 0,error:this.#x??void 0},this.#v);return e.previousSpan=this.previousSpan?.clone(),e}toJSON(){return{object:this.type,id:this.spanId,trace_id:this.traceId,parent_id:this.parentId,started_at:this.startedAt,ended_at:this.endedAt,span_data:(e=this.spanData,Object.fromEntries(Object.entries(e).filter(([e])=>!e.startsWith("_")))),error:this.error};var e}}class na extends ta{constructor(e,t){super({traceId:"no-op",spanId:"no-op",data:e},t)}start(){}end(){}setError(){}toJSON(){return null}}class sa{type="trace";traceId;name;groupId=null;metadata;#v;#k;constructor(e,t){this.traceId=e.traceId??Yr(),this.name=e.name??"Agent workflow",this.groupId=e.groupId??null,this.metadata=e.metadata??{},this.#v=t??Vr(),this.#k=e.started??!1}async start(){this.#k||(this.#k=!0,await this.#v.onTraceStart(this))}async end(){this.#k&&(this.#k=!1,await this.#v.onTraceEnd(this))}clone(){return new sa({traceId:this.traceId,name:this.name,groupId:this.groupId??void 0,metadata:this.metadata,started:this.#k})}toJSON(){return{object:this.type,id:this.traceId,workflow_name:this.name,group_id:this.groupId,metadata:this.metadata}}}class ra extends sa{constructor(){super({})}async start(){}async end(){}toJSON(){return null}}class aa{#T;#A;constructor(){this.#T=new Wr,this.#A=un.disabled,this.#I()}registerProcessor(e){this.#T.addTraceProcessor(e)}setProcessors(e){this.#T.setProcessors(e)}getCurrentTrace(){return Dr()}getCurrentSpan(){return jr()}setDisabled(e){this.#A=e}startExportLoop(){this.#T.start()}createTrace(e){if(this.#A)return fn.debug("Tracing is disabled, Not creating trace %o",e),new ra;const t=e.traceId??Yr(),n=e.name??"Agent workflow";return fn.debug("Creating trace %s with name %s",t,n),new sa({...e,name:n,traceId:t},this.#T)}createSpan(e,t){if(this.#A||e.disabled)return fn.debug("Tracing is disabled, Not creating span %o",e),new na(e.data,this.#T);let n,s;if(t){if(t instanceof sa){if(t instanceof ra)return fn.debug("Parent trace is no-op, returning NoopSpan"),new na(e.data,this.#T);s=t.traceId}else if(t instanceof ta){if(t instanceof na)return fn.debug("Parent span is no-op, returning NoopSpan"),new na(e.data,this.#T);n=t.spanId,s=t.traceId}}else{const t=Dr(),r=jr();if(!t)return fn.error("No active trace. Make sure to start a trace with `withTrace()` first. Returning NoopSpan."),new na(e.data,this.#T);if(r instanceof na||t instanceof ra)return fn.debug(`Parent ${r} or ${t} is no-op, returning NoopSpan`),new na(e.data,this.#T);s=t.traceId,r?(fn.debug("Using parent span %s",r.spanId),n=r.spanId):fn.debug("No parent span, using current trace %s",t.traceId)}return s?(fn.debug(`Creating span ${JSON.stringify(e.data)} with id ${e.spanId??s}`),new ta({...e,traceId:s,parentId:n},this.#T)):(fn.error("No traceId found. Make sure to start a trace with `withTrace()` first. Returning NoopSpan."),new na(e.data,this.#T))}async shutdown(e){try{fn.debug("Shutting down tracing provider"),await this.#T.shutdown(e)}catch(e){fn.error("Error shutting down tracing provider %o",e)}}#I(){if("undefined"!=typeof process&&"function"==typeof process.on){const e=async()=>{const e=setTimeout(()=>{console.warn("Cleanup timeout, forcing exit"),process.exit(1)},5e3);try{await this.shutdown()}finally{clearTimeout(e)}};process.on("beforeExit",e),process.on("SIGINT",async()=>{await e(),ia("SIGINT")||process.exit(130)}),process.on("SIGTERM",async()=>{await e(),ia("SIGTERM")||process.exit(0)}),process.on("unhandledRejection",async(t,n)=>{fn.error("Unhandled rejection",t,n),await e(),process.listeners("unhandledRejection").length>1||process.exit(1)})}}async forceFlush(){await this.#T.forceFlush()}}function ia(e){return process.listeners(e).length>1}function oa(){return Gr||(Gr=new aa),Gr}function ua(e){return async(t,...n)=>qr(async()=>{const s=e(...n);Fr(s);try{return s.start(),await t(s)}catch(e){throw s.setError({message:e.message,data:e.data}),e}finally{s.end(),Ur()}})}function ca(e,t){return e={},oa().createSpan({...e,data:{type:"response",...e.data}},t)}const la=ua(ca);function da(e,t){return oa().createSpan({...e,data:{type:"agent",name:e?.data?.name??"Agent",...e?.data}},t)}const pa=ua(da);function ha(e,t){return oa().createSpan({...e,data:{type:"function",input:e?.data?.input??"",output:e?.data?.output??"",...e?.data}},t)}const fa=ua(ha);function ma(e,t){return oa().createSpan({...e,data:{type:"handoff",...e?.data}},t)}const ga=ua(ma);function ya(e,t){return oa().createSpan({...e,data:{type:"generation",...e?.data}},t)}const _a=ua(ya);function va(e,t){return oa().createSpan({...e,data:{type:"custom",data:{},...e?.data}},t)}const wa=ua(va);function ba(e,t){return oa().createSpan({...e,data:{type:"guardrail",triggered:!1,...e?.data}},t)}const xa=ua(ba);function Sa(e,t){return oa().createSpan({...e,data:{type:"transcription",...e.data}},t)}const ka=ua(Sa);function Ta(e,t){return oa().createSpan({...e,data:{type:"speech",...e.data}},t)}const Aa=ua(Ta);function Ia(e,t){return oa().createSpan({...e,data:{type:"speech_group",...e?.data}},t)}const Ca=ua(Ia);function Oa(e,t){return oa().createSpan({...e,data:{type:"mcp_tools",...e?.data}},t)}const Ea=ua(Oa);function Ra(e){oa().registerProcessor(e)}function Pa(e){oa().setProcessors(e)}function Na(e){oa().setDisabled(e)}function $a(){oa().startExportLoop()}class Da{on(e,t){return this.eventEmitter.on(e,t),this.eventEmitter}off(e,t){return this.eventEmitter.off(e,t),this.eventEmitter}emit(e,...t){return this.eventEmitter.emit(e,...t)}once(e,t){return this.eventEmitter.once(e,t),this.eventEmitter}}class ja extends Da{eventEmitter=new Ar}class Ma extends Da{eventEmitter=new Ar}function La({name:e,execute:t}){return{type:"input",name:e,guardrailFunction:t,run:async n=>({guardrail:{type:"input",name:e},output:await t(n)})}}function Za({name:e,execute:t}){return{type:"output",name:e,guardrailFunction:t,run:async n=>({guardrail:{type:"output",name:e},agent:n.agent,agentOutput:n.agentOutput,output:await t(n)})}}function Fa(e){return JSON.stringify({assistant:e.name})}class Ua{toolName;toolDescription;inputJsonSchema={type:"object",properties:{},required:[],additionalProperties:!1};strictJsonSchema=!0;onInvokeHandoff;agentName;inputFilter;agent;getHandoffAsFunctionTool(){return{type:"function",name:this.toolName,description:this.toolDescription,parameters:this.inputJsonSchema,strict:this.strictJsonSchema}}constructor(e,t){this.agentName=e.name,this.onInvokeHandoff=t,this.toolName=function(e){return`transfer_to_${nn(e.name)}`}(e),this.toolDescription=function(e){return`Handoff to the ${e.name} agent to handle the request. ${e.handoffDescription??""}`}(e),this.agent=e}}function Ba(e,t={}){let n;if(!!t.onHandoff!=!!t.inputType)throw new Vt("You must provide either both `onHandoff` and `inputType` or neither.");const s=new Ua(e,async function(s,r){if(n){if(!r)throw Br({message:`Handoff function expected non empty input but got: ${r}`,data:{details:"input is empty"}}),new Ht("Handoff function expected non empty input");try{const e=await n(r);t.onHandoff&&await t.onHandoff(s,e)}catch(e){throw Br({message:"Invalid JSON provided",data:{}}),fn.dontLogToolData||fn.error(`Invalid JSON when parsing: ${r}. Error: ${e}`),new Ht("Invalid JSON provided")}}else await(t.onHandoff?.(s));return e});if(t.inputType){const e=sn(t.inputType,s.toolName);s.inputJsonSchema=e.schema,s.strictJsonSchema=!0,n=e.parser}return t.toolNameOverride&&(s.toolName=t.toolNameOverride),t.toolDescriptionOverride&&(s.toolDescription=t.toolDescriptionOverride),t.inputFilter&&(s.inputFilter=t.inputFilter),s}function qa(e){return e instanceof Ua?e:Ba(e)}let za;function Ja(e){za=e}function Wa(){if(void 0===za)throw new Error("No default model provider set. Make sure to set a provider using setDefaultModelProvider before calling getDefaultModelProvider or pass an explicit provider.");return za}const Ga=ar({providerData:ur(er(),sr()).optional()}),Ka=Ga.extend({id:er().optional()}),Ha=Ga.extend({type:lr("refusal"),refusal:er()}),Va=Ga.extend({type:lr("output_text"),text:er()}),Xa=Ga.extend({type:lr("input_text"),text:er()}),Ya=Ga.extend({type:lr("reasoning_text"),text:er()}),Qa=Ga.extend({type:lr("input_image"),image:er().or(ar({id:er()})).describe("Could be a URL, base64 or an object with a file ID.")}),ei=Ga.extend({type:lr("input_file"),file:er().describe("Either base64 encoded file data or a publicly accessible file URL").or(ar({id:er().describe("OpenAI file ID")})).or(ar({url:er().describe("Publicly accessible PDF file URL")})).describe("Contents of the file or an object with a file ID.")}),ti=Ga.extend({type:lr("audio"),audio:er().or(ar({id:er()})).describe("Base64 encoded audio data or file id"),format:er().nullable().optional(),transcript:er().nullable().optional()}),ni=Ga.extend({type:lr("image"),image:er().describe("Base64 encoded image data")}),si=Ga.extend({type:lr("text"),text:er()}),ri=Ga.extend({type:lr("image"),data:er().describe("Base64 encoded image data"),mediaType:er().describe("IANA media type of the image")}),ai=Ga.extend({type:lr("computer_screenshot"),data:er().describe("Base64 encoded image data or URL")}),ii=or("type",[ar({type:lr("screenshot")}),ar({type:lr("click"),x:tr(),y:tr(),button:dr(["left","right","wheel","back","forward"])}),ar({type:lr("double_click"),x:tr(),y:tr()}),ar({type:lr("scroll"),x:tr(),y:tr(),scroll_x:tr(),scroll_y:tr()}),ar({type:lr("type"),text:er()}),ar({type:lr("wait")}),ar({type:lr("move"),x:tr(),y:tr()}),ar({type:lr("keypress"),keys:rr(er())}),ar({type:lr("drag"),path:rr(ar({x:tr(),y:tr()}))})]),oi=or("type",[Va,Ha,ti,ni]),ui=Ka.extend({type:lr("message").optional()}),ci=ui.extend({role:lr("assistant"),status:dr(["in_progress","completed","incomplete"]),content:rr(oi)}),li=or("type",[Xa,Qa,ei,ti]),di=ui.extend({role:lr("user"),content:rr(li).or(er())}),pi=ui.extend({role:lr("system"),content:er()}),hi=or("role",[pi,ci,di]),fi=Ka.extend({type:lr("hosted_tool_call"),name:er().describe("The name of the hosted tool"),arguments:er().describe("The arguments of the hosted tool call").optional(),status:er().optional(),output:er().optional()}),mi=Ka.extend({type:lr("function_call"),callId:er().describe("The ID of the tool call"),name:er().describe("The name of the function"),status:dr(["in_progress","completed","incomplete"]).optional(),arguments:er()}),gi=Ka.extend({type:lr("function_call_result"),name:er().describe("The name of the tool"),callId:er().describe("The ID of the tool call"),status:dr(["in_progress","completed","incomplete"]),output:or("type",[si,ri])}),yi=Ka.extend({type:lr("computer_call"),callId:er().describe("The ID of the computer call"),status:dr(["in_progress","completed","incomplete"]),action:ii}),_i=Ka.extend({type:lr("computer_call_result"),callId:er().describe("The ID of the computer call"),output:ai}),vi=or("type",[yi,mi,fi]),wi=Ga.extend({id:er().optional(),type:lr("reasoning"),content:rr(Xa),rawContent:rr(Ya).optional()}),bi=Ka.extend({type:lr("unknown")}),xi=or("type",[ci,fi,mi,yi,wi,bi]),Si=ir([di,ci,pi,fi,mi,yi,gi,_i,wi,bi]),ki=ar({requests:tr().optional(),inputTokens:tr(),outputTokens:tr(),totalTokens:tr(),inputTokensDetails:ur(er(),tr()).optional(),outputTokensDetails:ur(er(),tr()).optional()}),Ti=Ga.extend({type:lr("output_text_delta"),delta:er()}),Ai=Ga.extend({type:lr("response_started")}),Ii=Ga.extend({type:lr("response_done"),response:Ga.extend({id:er(),usage:ki,output:rr(xi)})}),Ci=Ga.extend({type:lr("model"),event:sr().describe("The event from the model")}),Oi=or("type",[Ti,Ii,Ai,Ci]);class Ei{requests;inputTokens;outputTokens;totalTokens;inputTokensDetails=[];outputTokensDetails=[];constructor(e){if(void 0===e)this.requests=0,this.inputTokens=0,this.outputTokens=0,this.totalTokens=0,this.inputTokensDetails=[],this.outputTokensDetails=[];else{this.requests=e?.requests??1,this.inputTokens=e?.inputTokens??e?.input_tokens??0,this.outputTokens=e?.outputTokens??e?.output_tokens??0,this.totalTokens=e?.totalTokens??e?.total_tokens??0;const t=e?.inputTokensDetails??e?.input_tokens_details;this.inputTokensDetails=t?[t]:[];const n=e?.outputTokensDetails??e?.output_tokens_details;this.outputTokensDetails=n?[n]:[]}}add(e){this.requests+=e.requests,this.inputTokens+=e.inputTokens,this.outputTokens+=e.outputTokens,this.totalTokens+=e.totalTokens,e.inputTokensDetails&&this.inputTokensDetails.push(...e.inputTokensDetails),e.outputTokensDetails&&this.outputTokensDetails.push(...e.outputTokensDetails)}}class Ri{context;usage;#C;constructor(e={}){this.context=e,this.usage=new Ei,this.#C=new Map}_rebuildApprovals(e){this.#C=new Map(Object.entries(e))}isToolApproved({toolName:e,callId:t}){const n=this.#C.get(e);if(!0===n?.approved&&!0===n.rejected)return fn.warn("Tool is permanently approved and rejected at the same time. Approval takes precedence"),!0;if(!0===n?.approved)return!0;if(!0===n?.rejected)return!1;const s=!!Array.isArray(n?.approved)&&n.approved.includes(t),r=!!Array.isArray(n?.rejected)&&n.rejected.includes(t);return s&&r?(fn.warn(`Tool call ${t} is both approved and rejected at the same time. Approval takes precedence`),!0):!!s||!r&&void 0}approveTool(e,{alwaysApprove:t=!1}={}){const n=e.rawItem.name;if(t)return void this.#C.set(n,{approved:!0,rejected:[]});const s=this.#C.get(n)??{approved:[],rejected:[]};if(Array.isArray(s.approved)){const t="callId"in e.rawItem?e.rawItem.callId:e.rawItem.id;s.approved.push(t)}this.#C.set(n,s)}rejectTool(e,{alwaysReject:t=!1}={}){const n=e.rawItem.name;if(t)return void this.#C.set(n,{approved:!1,rejected:!0});const s=this.#C.get(n)??{approved:[],rejected:[]};if(Array.isArray(s.rejected)){const t="callId"in e.rawItem?e.rawItem.callId:e.rawItem.id;s.rejected.push(t)}this.#C.set(n,s)}toJSON(){return{context:this.context,usage:this.usage,approvals:Object.fromEntries(this.#C.entries())}}}class Pi{state;constructor(e){this.state=e}get history(){return Oo(this.input,this.newItems)}get output(){return Oo([],this.newItems)}get input(){return this.state._originalInput}get newItems(){return this.state._generatedItems}get rawResponses(){return this.state._modelResponses}get lastResponseId(){const e=this.rawResponses;return e&&e.length>0?e[e.length-1].responseId:void 0}get lastAgent(){return this.state._currentAgent}get inputGuardrailResults(){return this.state._inputGuardrailResults}get outputGuardrailResults(){return this.state._outputGuardrailResults}get interruptions(){return"next_step_interruption"===this.state._currentStep?.type?this.state._currentStep.data.interruptions:[]}get finalOutput(){if("next_step_final_output"===this.state._currentStep?.type)return this.state._currentAgent.processFinalOutput(this.state._currentStep.output);fn.warn("Accessed finalOutput before agent run is completed.")}}class Ni extends Pi{constructor(e){super(e)}}class $i extends Pi{get currentAgent(){return this.lastAgent}currentTurn=0;maxTurns;#x=null;#O;#E;#R;#P;#N;#$;#D=!1;constructor(e={}){super(e.state),this.#O=e.signal,this.#O&&this.#O.addEventListener("abort",async()=>{await this.#R.cancel()}),this.#R=new Or({start:e=>{this.#E=e},cancel:()=>{this.#D=!0}}),this.#P=new Promise((e,t)=>{this.#N=e,this.#$=t})}_addItem(e){this.cancelled||this.#E?.enqueue(e)}_done(){!this.cancelled&&this.#E&&(this.#E.close(),this.#E=void 0,this.#N?.())}_raiseError(e){!this.cancelled&&this.#E&&(this.#E.error(e),this.#E=void 0),this.#x=e,this.#$?.(e),this.#P.catch(e=>{fn.debug(`Resulted in an error: ${e}`)})}get cancelled(){return this.#D}toStream(){return this.#R}get completed(){return this.#P}get error(){return this.#x}toTextStream(e={}){const t=this.#R.pipeThrough(new Er({transform(e,t){if("raw_model_stream_event"===e.type&&"output_text_delta"===e.data.type){const n=Ti.parse(e.data);t.enqueue(n.delta)}}}));return e.compatibleWithNodeStreams?Cr.fromWeb(t):t}[Symbol.asyncIterator](){return this.#R[Symbol.asyncIterator]()}}function Di(e){return"function"===e.type?{type:"function",name:e.name,description:e.description,parameters:e.parameters,strict:e.strict}:"computer"===e.type?{type:"computer",name:e.name,environment:e.computer.environment,dimensions:e.computer.dimensions}:{type:"hosted_tool",name:e.name,providerData:e.providerData}}function ji(e){return{toolName:e.toolName,toolDescription:e.toolDescription,inputJsonSchema:e.inputJsonSchema,strictJsonSchema:e.strictJsonSchema}}class Mi{type="base_item";rawItem;toJSON(){return{type:this.type,rawItem:this.rawItem}}}class Li extends Mi{rawItem;agent;type="message_output_item";constructor(e,t){super(),this.rawItem=e,this.agent=t}toJSON(){return{...super.toJSON(),agent:this.agent.toJSON()}}get content(){let e="";for(const t of this.rawItem.content)"output_text"===t.type&&(e+=t.text);return e}}class Zi extends Mi{rawItem;agent;type="tool_call_item";constructor(e,t){super(),this.rawItem=e,this.agent=t}toJSON(){return{...super.toJSON(),agent:this.agent.toJSON()}}}class Fi extends Mi{rawItem;agent;output;type="tool_call_output_item";constructor(e,t,n){super(),this.rawItem=e,this.agent=t,this.output=n}toJSON(){return{...super.toJSON(),agent:this.agent.toJSON(),output:mn(this.output)}}}class Ui extends Mi{rawItem;agent;type="reasoning_item";constructor(e,t){super(),this.rawItem=e,this.agent=t}toJSON(){return{...super.toJSON(),agent:this.agent.toJSON()}}}class Bi extends Mi{rawItem;agent;type="handoff_call_item";constructor(e,t){super(),this.rawItem=e,this.agent=t}toJSON(){return{...super.toJSON(),agent:this.agent.toJSON()}}}class qi extends Mi{rawItem;sourceAgent;targetAgent;type="handoff_output_item";constructor(e,t,n){super(),this.rawItem=e,this.sourceAgent=t,this.targetAgent=n}toJSON(){return{...super.toJSON(),sourceAgent:this.sourceAgent.toJSON(),targetAgent:this.targetAgent.toJSON()}}}class zi extends Mi{rawItem;agent;type="tool_approval_item";constructor(e,t){super(),this.rawItem=e,this.agent=t}toJSON(){return{...super.toJSON(),agent:this.agent.toJSON()}}}function Ji(e){return e.filter(e=>"message_output_item"===e.type).map(e=>e.content).join("")}function Wi(e){if("message"!==e.type)return;if("assistant"!==e.role)return;const t=e.content[e.content.length-1];return"output_text"===t.type?t.text:void 0}class Gi{data;type="raw_model_stream_event";constructor(e){this.data=e}}class Ki{name;item;type="run_item_stream_event";constructor(e,t){this.name=e,this.item=t}}class Hi{agent;type="agent_updated_stream_event";constructor(e){this.agent=e}}function Vi(e,t,n,s){const r=[],a=[],i=[],o=[],u=[],c=[],l=new Map(s.map(e=>[e.toolName,e])),d=new Map(n.filter(e=>"function"===e.type).map(e=>[e.name,e])),p=n.find(e=>"computer"===e.type),h=new Map(n.filter(e=>"hosted_tool"===e.type&&"mcp"===e.providerData?.type).map(e=>e).map(e=>[e.providerData.server_label,e]));for(const n of e.output){if("message"===n.type)"assistant"===n.role&&r.push(new Li(n,t));else if("hosted_tool_call"===n.type){r.push(new Zi(n,t));const e=n.name;if(c.push(e),"mcp_approval_request"===n.providerData?.type||"mcp_approval_request"===n.name){const e=n.providerData,s=e.server_label,a=h.get(s);if(void 0===a){const e=`MCP server (${s}) not found in Agent (${t.name})`;throw Br({message:e,data:{mcp_server_label:s}}),new Ht(e)}const i=new zi({type:"hosted_tool_call",name:e.name,id:e.id,status:"in_progress",providerData:e},t);u.push({requestItem:i,mcpTool:a}),a.providerData.on_approval||r.push(i)}}else if("reasoning"===n.type)r.push(new Ui(n,t));else if("computer_call"===n.type){if(r.push(new Zi(n,t)),c.push("computer_use"),!p)throw Br({message:"Model produced computer action without a computer tool.",data:{agent_name:t.name}}),new Ht("Model produced computer action without a computer tool.");o.push({toolCall:n,computer:p})}if("function_call"!==n.type)continue;c.push(n.name);const e=l.get(n.name);if(e)r.push(new Bi(n,t)),a.push({toolCall:n,handoff:e});else{const e=d.get(n.name);if(!e)throw Br({message:`Tool ${n.name} not found in agent ${t.name}.`,data:{tool_name:n.name,agent_name:t.name}}),new Ht(`Tool ${n.name} not found in agent ${t.name}.`);r.push(new Zi(n,t)),i.push({toolCall:n,tool:e})}}return{newItems:r,handoffs:a,functions:i,computerActions:o,mcpApprovalRequests:u,toolsUsed:c,hasToolsOrApprovalsToRun:()=>a.length>0||i.length>0||u.length>0||o.length>0}}const Xi=or("type",[ar({type:lr("next_step_handoff"),newAgent:sr()}),ar({type:lr("next_step_final_output"),output:er()}),ar({type:lr("next_step_run_again")}),ar({type:lr("next_step_interruption"),data:ur(er(),sr())})]);class Yi{originalInput;modelResponse;preStepItems;newStepItems;nextStep;constructor(e,t,n,s,r){this.originalInput=e,this.modelResponse=t,this.preStepItems=n,this.newStepItems=s,this.nextStep=r}get generatedItems(){return this.preStepItems.concat(this.newStepItems)}}function Qi(e,t,n){return e.resetToolChoice&&t.hasUsedTools(e)?{...n,toolChoice:void 0}:n}async function eo(e,t,n,s,r,a,i){const o=n.filter(e=>e instanceof zi&&"callId"in e.rawItem&&"function_call"===e.rawItem.type).map(e=>e.rawItem.callId),u=r.functions.filter(e=>o.includes(e.toolCall.callId)),c=await so(e,u,a,i),l=c.map(e=>e.runItem),d=r.mcpApprovalRequests.filter(e=>"tool_approval_item"===e.requestItem.type&&"hosted_tool_call"===e.requestItem.rawItem.type&&"mcp_approval_request"===e.requestItem.rawItem.providerData?.type);for(const t of d){const n=t.requestItem.rawItem.id,s=i._context.isToolApproved({toolName:t.requestItem.rawItem.name,callId:n});if(void 0!==s){const t={approve:s,approval_request_id:n,reason:void 0};l.push(new Zi({type:"hosted_tool_call",name:"mcp_approval_response",providerData:t},e))}}const p=await oo(e,c,i),h=n.filter(e=>!(e instanceof zi));return p.isFinalOutput?(a.emit("agent_end",i._context,e,p.finalOutput),e.emit("agent_end",i._context,p.finalOutput),new Yi(t,s,h,l,{type:"next_step_final_output",output:p.finalOutput})):p.isInterrupted?new Yi(t,s,h,l,{type:"next_step_interruption",data:{interruptions:p.interruptions}}):new Yi(t,s,h,l,{type:"next_step_run_again"})}async function to(e,t,n,s,r,a,i){const u=n;let c=r.newItems;const[l,d]=await Promise.all([so(e,r.functions,a,i),ao(e,r.computerActions,a,i._context)]);if(c=c.concat(l.map(e=>e.runItem)),c=c.concat(d),r.mcpApprovalRequests.length>0)for(const t of r.mcpApprovalRequests){const n=t.mcpTool.providerData,s=t.requestItem.rawItem.providerData;if(n.on_approval){const r=await n.on_approval(i._context,t.requestItem),a={approve:r.approve,approval_request_id:s.id,reason:r.reason};c.push(new Zi({type:"hosted_tool_call",name:"mcp_approval_response",providerData:a},e))}else{c.push(t.requestItem);const n={type:"hosted_mcp_tool_approval",tool:t.mcpTool,runItem:new zi({type:"hosted_tool_call",name:s.name,id:s.id,arguments:s.arguments,status:"in_progress",providerData:s},e)};l.push(n)}}if(r.handoffs.length>0)return await async function(e,t,n,s,r,a,i,o){if(s=[...s],0===a.length)return fn.warn("Incorrectly called executeHandoffCalls with no handoffs. This should not happen. Moving on."),new Yi(t,r,n,s,{type:"next_step_run_again"});if(a.length>1){const t="Multiple handoffs detected, ignoring this one.";for(let n=1;n<a.length;n++)s.push(new Fi(no(a[n].toolCall,t),e,t))}const u=a[0];return ga(async c=>{const l=u.handoff,d=await l.onInvokeHandoff(o,u.toolCall.arguments);if(c.spanData.to_agent=d.name,a.length>1){const e=a.map(e=>e.handoff.agentName);c.setError({message:"Multiple handoffs requested",data:{requested_agents:e}})}s.push(new qi(no(u.toolCall,Fa(d)),e,d)),i.emit("agent_handoff",o,e,d),e.emit("agent_handoff",o,d);const p=l.inputFilter??i.config.handoffInputFilter;if(p){fn.debug("Filtering inputs for handoff"),"function"!=typeof p&&c.setError({message:"Invalid input filter",data:{details:"not callable"}});const e=p({inputHistory:Array.isArray(t)?[...t]:t,preHandoffItems:[...n],newItems:[...s],runContext:o});t=e.inputHistory,n=e.preHandoffItems,s=e.newItems}return new Yi(t,r,n,s,{type:"next_step_handoff",newAgent:d})},{data:{from_agent:e.name}})}(e,t,u,c,s,r.handoffs,a,i._context);const p=await oo(e,l,i);if(p.isFinalOutput)return a.emit("agent_end",i._context,e,p.finalOutput),e.emit("agent_end",i._context,p.finalOutput),new Yi(t,s,u,c,{type:"next_step_final_output",output:p.finalOutput});if(p.isInterrupted)return new Yi(t,s,u,c,{type:"next_step_interruption",data:{interruptions:p.interruptions}});const h=c.filter(e=>e instanceof Li),f=h.length>0?Wi(h[h.length-1].rawItem):void 0;if(!f)return new Yi(t,s,u,c,{type:"next_step_run_again"});if("text"===e.outputType&&!r.hasToolsOrApprovalsToRun())return new Yi(t,s,u,c,{type:"next_step_final_output",output:f});if("text"!==e.outputType&&f){const{parser:n}=sn(e.outputType,"final_output"),[r]=await o(()=>n(f));if(r)throw Br({message:"Invalid output type",data:{error:String(r)}}),new Ht("Invalid output type");return new Yi(t,s,u,c,{type:"next_step_final_output",output:f})}return new Yi(t,s,u,c,{type:"next_step_run_again"})}function no(e,t){return{type:"function_call_result",name:e.name,callId:e.callId,status:"completed",output:{type:"text",text:mn(t)}}}async function so(e,t,n,s){try{return await Promise.all(t.map(async function(t){let r=t.toolCall.arguments;if(t.tool.parameters&&(r=tn(t.tool.parameters)?t.tool.parameters.parse(r):JSON.parse(r)),await t.tool.needsApproval(s._context,r,t.toolCall.callId)){const n=s._context.isToolApproved({toolName:t.tool.name,callId:t.toolCall.callId});if(!1===n)return fa(async n=>{const s="Tool execution was not approved.";return n.setError({message:s,data:{tool_name:t.tool.name,error:`Tool execution for ${t.toolCall.callId} was manually rejected by user.`}}),n.spanData.output=s,{type:"function_output",tool:t.tool,output:s,runItem:new Fi(no(t.toolCall,s),e,s)}},{data:{name:t.tool.name}});if(!0!==n)return{type:"function_approval",tool:t.tool,runItem:new zi(t.toolCall,e)}}return fa(async r=>{n.config.traceIncludeSensitiveData&&(r.spanData.input=t.toolCall.arguments);try{n.emit("agent_tool_start",s._context,e,t.tool,{toolCall:t.toolCall}),e.emit("agent_tool_start",s._context,t.tool,{toolCall:t.toolCall});const a=await t.tool.invoke(s._context,t.toolCall.arguments),i=mn(a);return n.emit("agent_tool_end",s._context,e,t.tool,i,{toolCall:t.toolCall}),e.emit("agent_tool_end",s._context,t.tool,i,{toolCall:t.toolCall}),n.config.traceIncludeSensitiveData&&(r.spanData.output=i),{type:"function_output",tool:t.tool,output:a,runItem:new Fi(no(t.toolCall,a),e,a)}}catch(e){throw r.setError({message:"Error running tool",data:{tool_name:t.tool.name,error:String(e)}}),e}},{data:{name:t.tool.name}})}))}catch(e){throw new Yt(`Failed to run function tools: ${e}`,e,s)}}async function ro(e,t){const n=t.action;let s;switch(n.type){case"click":await e.click(n.x,n.y,n.button);break;case"double_click":await e.doubleClick(n.x,n.y);break;case"drag":await e.drag(n.path.map(e=>[e.x,e.y]));break;case"keypress":await e.keypress(n.keys);break;case"move":await e.move(n.x,n.y);break;case"screenshot":s=await e.screenshot();break;case"scroll":await e.scroll(n.x,n.y,n.scroll_x,n.scroll_y);break;case"type":await e.type(n.text);break;case"wait":await e.wait()}if(void 0!==s)return s;if("function"==typeof e.screenshot&&(s=await e.screenshot(),void 0!==s))return s;throw new Error("Computer does not implement screenshot()")}async function ao(e,t,n,s,r=void 0){const a=r??fn,i=[];for(const r of t){const t=r.computer.computer,o=r.toolCall;let u;n.emit("agent_tool_start",s,e,r.computer,{toolCall:o}),"function"==typeof e.emit&&e.emit("agent_tool_start",s,r.computer,{toolCall:o});try{u=await ro(t,o)}catch(e){a.error("Failed to execute computer action:",e),u=""}n.emit("agent_tool_end",s,e,r.computer,u,{toolCall:o}),"function"==typeof e.emit&&e.emit("agent_tool_end",s,r.computer,u,{toolCall:o});const c=u?`data:image/png;base64,${u}`:"",l={type:"computer_call_result",callId:o.callId,output:{type:"computer_screenshot",data:c}};i.push(new Fi(l,e,c))}return i}const io={isFinalOutput:!1,isInterrupted:void 0};async function oo(e,t,n){if(0===t.length)return io;const s=t.filter(e=>e.runItem instanceof zi).map(e=>e.runItem);if(s.length>0)return{isFinalOutput:!1,isInterrupted:!0,interruptions:s};if("run_llm_again"===e.toolUseBehavior)return io;const r=t[0];if("stop_on_first_tool"===e.toolUseBehavior)return"function_output"===r?.type?{isFinalOutput:!0,isInterrupted:void 0,finalOutput:mn(r.output)}:io;const a=e.toolUseBehavior;if("object"==typeof a){const e=t.find(e=>a.stopAtToolNames.includes(e.tool.name));return"function_output"===e?.type?{isFinalOutput:!0,isInterrupted:void 0,finalOutput:mn(e.output)}:io}if("function"==typeof a)return a(n._context,t);throw new Vt(`Invalid toolUseBehavior: ${a}`,n)}function uo(e,t){for(const n of t.newStepItems){let t;if(n instanceof Li)t="message_output_created";else if(n instanceof Bi)t="handoff_requested";else if(n instanceof qi)t="handoff_occurred";else if(n instanceof Zi)t="tool_called";else if(n instanceof Fi)t="tool_output";else if(n instanceof Ui)t="reasoning_item_created";else{if(!(n instanceof zi)){fn.warn("Unknown item type: ",n);continue}t="tool_approval_requested"}e._addItem(new Ki(t,n))}}class co{#j=new Map;addToolUse(e,t){this.#j.set(e,t)}hasUsedTools(e){return this.#j.has(e)}toJSON(){return Object.fromEntries(Array.from(this.#j.entries()).map(([e,t])=>[e.name,t]))}}const lo="1.0",po=lr(lo),ho=ar({name:er()}),fo=ar({object:lr("trace.span"),id:er(),trace_id:er(),parent_id:er().nullable(),started_at:er().nullable(),ended_at:er().nullable(),error:ar({message:er(),data:ur(er(),sr()).optional()}).nullable(),span_data:ur(er(),sr())}).extend({previous_span:cr(()=>fo).optional()}),mo=ar({requests:tr(),inputTokens:tr(),outputTokens:tr(),totalTokens:tr()}),go=ar({usage:mo,output:rr(xi),responseId:er().optional(),providerData:ur(er(),sr()).optional()}),yo=or("type",[ar({type:lr("message_output_item"),rawItem:ci,agent:ho}),ar({type:lr("tool_call_item"),rawItem:vi.or(fi),agent:ho}),ar({type:lr("tool_call_output_item"),rawItem:gi,agent:ho,output:er()}),ar({type:lr("reasoning_item"),rawItem:wi,agent:ho}),ar({type:lr("handoff_call_item"),rawItem:mi,agent:ho}),ar({type:lr("handoff_output_item"),rawItem:gi,sourceAgent:ho,targetAgent:ho}),ar({type:lr("tool_approval_item"),rawItem:mi.or(fi),agent:ho})]),_o=ar({object:lr("trace"),id:er(),workflow_name:er(),group_id:er().nullable(),metadata:ur(er(),sr())}),vo=ar({newItems:rr(yo),toolsUsed:rr(er()),handoffs:rr(ar({toolCall:sr(),handoff:sr()})),functions:rr(ar({toolCall:sr(),tool:sr()})),computerActions:rr(ar({toolCall:sr(),computer:sr()})),mcpApprovalRequests:rr(ar({requestItem:ar({rawItem:ar({type:lr("hosted_tool_call"),name:er(),arguments:er().optional(),status:er().optional(),output:er().optional(),providerData:ur(er(),sr()).nullable().optional()})}),mcpTool:ar({type:lr("hosted_tool"),name:lr("hosted_mcp"),providerData:ur(er(),sr())})})).optional()}),wo=ar({tripwireTriggered:nr(),outputInfo:sr()}),bo=ar({guardrail:ar({type:lr("input"),name:er()}),output:wo}),xo=ar({guardrail:ar({type:lr("output"),name:er()}),agentOutput:sr(),agent:ho,output:wo}),So=ar({$schemaVersion:po,currentTurn:tr(),currentAgent:ho,originalInput:er().or(rr(Si)),modelResponses:rr(go),context:ar({usage:mo,approvals:ur(er(),ar({approved:rr(er()).or(nr()),rejected:rr(er()).or(nr())})),context:ur(er(),sr())}),toolUseTracker:ur(er(),rr(er())),maxTurns:tr(),currentAgentSpan:fo.nullable().optional(),noActiveAgentRun:nr(),inputGuardrailResults:rr(bo),outputGuardrailResults:rr(xo),currentStep:Xi.optional(),lastModelResponse:go.optional(),generatedItems:rr(yo),lastProcessedResponse:vo.optional(),trace:_o.nullable()});class ko{_currentTurn=0;_currentAgent;_originalInput;_modelResponses;_currentAgentSpan;_context;_toolUseTracker;_generatedItems;_maxTurns;_noActiveAgentRun=!0;_lastTurnResponse;_inputGuardrailResults;_outputGuardrailResults;_currentStep=void 0;_lastProcessedResponse=void 0;_trace=null;constructor(e,t,n,s){this._context=e,this._originalInput=structuredClone(t),this._modelResponses=[],this._currentAgentSpan=void 0,this._currentAgent=n,this._toolUseTracker=new co,this._generatedItems=[],this._maxTurns=s,this._inputGuardrailResults=[],this._outputGuardrailResults=[],this._trace=Dr()}getInterruptions(){return"next_step_interruption"!==this._currentStep?.type?[]:this._currentStep.data.interruptions}approve(e,t={alwaysApprove:!1}){this._context.approveTool(e,t)}reject(e,t={alwaysReject:!1}){this._context.rejectTool(e,t)}toJSON(){const e={$schemaVersion:lo,currentTurn:this._currentTurn,currentAgent:{name:this._currentAgent.name},originalInput:this._originalInput,modelResponses:this._modelResponses.map(e=>({usage:{requests:e.usage.requests,inputTokens:e.usage.inputTokens,outputTokens:e.usage.outputTokens,totalTokens:e.usage.totalTokens},output:e.output,responseId:e.responseId,providerData:e.providerData})),context:this._context.toJSON(),toolUseTracker:this._toolUseTracker.toJSON(),maxTurns:this._maxTurns,currentAgentSpan:this._currentAgentSpan?.toJSON(),noActiveAgentRun:this._noActiveAgentRun,inputGuardrailResults:this._inputGuardrailResults,outputGuardrailResults:this._outputGuardrailResults.map(e=>({...e,agent:e.agent.toJSON()})),currentStep:this._currentStep,lastModelResponse:this._lastTurnResponse,generatedItems:this._generatedItems.map(e=>e.toJSON()),lastProcessedResponse:this._lastProcessedResponse,trace:this._trace?this._trace.toJSON():null},t=So.safeParse(e);if(!t.success)throw new Gt(`Failed to serialize run state. ${t.error.message}`);return t.data}toString(){return JSON.stringify(this.toJSON())}static async fromString(e,t){const[n,s]=await o(()=>JSON.parse(t));if(n)throw new Vt(`Failed to parse run state. ${n instanceof Error?n.message:String(n)}`);const r=s.$schemaVersion;if(!r)throw new Vt("Run state is missing schema version");if(r!==lo)throw new Vt(`Run state schema version ${r} is not supported. Please use version ${lo}`);const a=So.parse(JSON.parse(t)),i=function(e){const t=new Map,n=[e];for(;n.length>0;){const e=n.shift();if(!t.has(e.name)){t.set(e.name,e);for(const s of e.handoffs)s instanceof $o?t.has(s.name)||n.push(s):s.agent&&(t.has(s.agent.name)||n.push(s.agent))}}return t}(e),u=new Ri(a.context.context);u._rebuildApprovals(a.context.approvals);const c=i.get(a.currentAgent.name);if(!c)throw new Vt(`Agent ${a.currentAgent.name} not found`);const l=new ko(u,"",c,a.maxTurns);l._currentTurn=a.currentTurn,l._toolUseTracker=new co;for(const[e,t]of Object.entries(a.toolUseTracker))l._toolUseTracker.addToolUse(i.get(e),t);if(a.currentAgentSpan){a.trace||fn.warn("Trace is not set, skipping tracing setup");const e=oa().createTrace({traceId:a.trace?.id,name:a.trace?.workflow_name,groupId:a.trace?.group_id??void 0,metadata:a.trace?.metadata});l._currentAgentSpan=To(e,a.currentAgentSpan),l._trace=e}return l._noActiveAgentRun=a.noActiveAgentRun,l._inputGuardrailResults=a.inputGuardrailResults,l._outputGuardrailResults=a.outputGuardrailResults.map(e=>({...e,agent:i.get(e.agent.name)})),l._currentStep=a.currentStep,l._originalInput=a.originalInput,l._modelResponses=a.modelResponses.map(Ao),l._lastTurnResponse=a.lastModelResponse?Ao(a.lastModelResponse):void 0,l._generatedItems=a.generatedItems.map(e=>Io(e,i)),l._lastProcessedResponse=a.lastProcessedResponse?await async function(e,t,n,s){const r=await t.getAllTools(n),a=new Map(r.filter(e=>"function"===e.type).map(e=>[e.name,e])),i=new Map(r.filter(e=>"computer"===e.type).map(e=>[e.name,e])),o=new Map(t.handoffs.map(e=>e instanceof $o?[e.name,Ba(e)]:[e.toolName,e])),u={newItems:s.newItems.map(t=>Io(t,e)),toolsUsed:s.toolsUsed,handoffs:s.handoffs.map(e=>{if(!o.has(e.handoff.toolName))throw new Vt(`Handoff ${e.handoff.toolName} not found`);return{toolCall:e.toolCall,handoff:o.get(e.handoff.toolName)}}),functions:await Promise.all(s.functions.map(async e=>{if(!a.has(e.tool.name))throw new Vt(`Tool ${e.tool.name} not found`);return{toolCall:e.toolCall,tool:a.get(e.tool.name)}})),computerActions:s.computerActions.map(e=>{const t=e.computer.name;if(!i.has(t))throw new Vt(`Computer tool ${t} not found`);return{toolCall:e.toolCall,computer:i.get(t)}}),mcpApprovalRequests:(s.mcpApprovalRequests??[]).map(e=>({requestItem:new zi(e.requestItem.rawItem,t),mcpTool:e.mcpTool}))};return{...u,hasToolsOrApprovalsToRun:()=>u.handoffs.length>0||u.functions.length>0||u.mcpApprovalRequests.length>0||u.computerActions.length>0}}(i,l._currentAgent,l._context,a.lastProcessedResponse):void 0,"next_step_handoff"===a.currentStep?.type&&(l._currentStep={type:"next_step_handoff",newAgent:i.get(a.currentStep.newAgent.name)}),l}}function To(e,t){const n=t.span_data,s=t.previous_span?To(e,t.previous_span):void 0,r=oa().createSpan({spanId:t.id,traceId:t.trace_id,parentId:t.parent_id??void 0,startedAt:t.started_at??void 0,endedAt:t.ended_at??void 0,data:n},e);return r.previousSpan=s,r}function Ao(e){const t=new Ei;return t.requests=e.usage.requests,t.inputTokens=e.usage.inputTokens,t.outputTokens=e.usage.outputTokens,t.totalTokens=e.usage.totalTokens,{usage:t,output:e.output.map(e=>xi.parse(e)),responseId:e.responseId,providerData:e.providerData}}function Io(e,t){switch(e.type){case"message_output_item":return new Li(e.rawItem,t.get(e.agent.name));case"tool_call_item":return new Zi(e.rawItem,t.get(e.agent.name));case"tool_call_output_item":return new Fi(e.rawItem,t.get(e.agent.name),e.output);case"reasoning_item":return new Ui(e.rawItem,t.get(e.agent.name));case"handoff_call_item":return new Bi(e.rawItem,t.get(e.agent.name));case"handoff_output_item":return new qi(e.rawItem,t.get(e.sourceAgent.name),t.get(e.targetAgent.name));case"tool_approval_item":return new zi(e.rawItem,t.get(e.agent.name))}}function Co(e,t){return!e&&(!!t||"enabled_without_data")}function Oo(e,t){const n=t.filter(e=>"tool_approval_item"!==e.type).map(e=>e.rawItem);return"string"==typeof e&&(e=[{type:"message",role:"user",content:e}]),[...e,...n]}class Eo extends Ma{config;inputGuardrailDefs;outputGuardrailDefs;constructor(e={}){super(),this.config={modelProvider:e.modelProvider??Wa(),model:e.model,modelSettings:e.modelSettings,handoffInputFilter:e.handoffInputFilter,inputGuardrails:e.inputGuardrails,outputGuardrails:e.outputGuardrails,tracingDisabled:e.tracingDisabled??!1,traceIncludeSensitiveData:e.traceIncludeSensitiveData??!0,workflowName:e.workflowName??"Agent workflow",traceId:e.traceId,groupId:e.groupId,traceMetadata:e.traceMetadata},this.inputGuardrailDefs=(e.inputGuardrails??[]).map(La),this.outputGuardrailDefs=(e.outputGuardrails??[]).map(Za)}async#M(e,t,n){return qr(async()=>{const s=t instanceof ko?t:new ko(n.context instanceof Ri?n.context:new Ri(n.context),t,e,n.maxTurns??10);try{for(;;){let e=Po(s._currentAgent.model,this.config.model);if("string"==typeof e&&(e=await this.config.modelProvider.getModel(e)),s._currentStep=s._currentStep??{type:"next_step_run_again"},"next_step_interruption"===s._currentStep.type){if(fn.debug("Continuing from interruption"),!s._lastTurnResponse||!s._lastProcessedResponse)throw new Vt("No model response found in previous state",s);const e=await eo(s._currentAgent,s._originalInput,s._generatedItems,s._lastTurnResponse,s._lastProcessedResponse,this,s);if(s._toolUseTracker.addToolUse(s._currentAgent,s._lastProcessedResponse.toolsUsed),s._originalInput=e.originalInput,s._generatedItems=e.generatedItems,s._currentStep=e.nextStep,"next_step_interruption"===e.nextStep.type)return new Ni(s);continue}if("next_step_run_again"===s._currentStep.type){const t=[];if(s._currentAgent.handoffs&&t.push(...s._currentAgent.handoffs.map(qa)),!s._currentAgentSpan){const e=t.map(e=>e.agentName);s._currentAgentSpan=da({data:{name:s._currentAgent.name,handoffs:e,output_type:s._currentAgent.outputSchemaName}}),s._currentAgentSpan.start(),Fr(s._currentAgentSpan)}const r=await s._currentAgent.getAllTools(s._context),a=r.map(e=>Di(e)),i=t.map(e=>ji(e));if(s._currentAgentSpan&&(s._currentAgentSpan.spanData.tools=r.map(e=>e.name)),s._currentTurn++,s._currentTurn>s._maxTurns)throw s._currentAgentSpan?.setError({message:"Max turns exceeded",data:{max_turns:s._maxTurns}}),new Kt(`Max turns (${s._maxTurns}) exceeded`,s);fn.debug(`Running agent ${s._currentAgent.name} (turn ${s._currentTurn})`),1===s._currentTurn&&await this.#L(s);const o=Oo(s._originalInput,s._generatedItems);s._noActiveAgentRun&&(s._currentAgent.emit("agent_start",s._context,s._currentAgent),this.emit("agent_start",s._context,s._currentAgent));let u={...this.config.modelSettings,...s._currentAgent.modelSettings};u=Qi(s._currentAgent,s._toolUseTracker,u),s._lastTurnResponse=await e.getResponse({systemInstructions:await s._currentAgent.getSystemPrompt(s._context),prompt:await s._currentAgent.getPrompt(s._context),input:o,previousResponseId:n.previousResponseId,modelSettings:u,tools:a,outputType:rn(s._currentAgent.outputType),handoffs:i,tracing:Co(this.config.tracingDisabled,this.config.traceIncludeSensitiveData),signal:n.signal}),s._modelResponses.push(s._lastTurnResponse),s._context.usage.add(s._lastTurnResponse.usage),s._noActiveAgentRun=!1;const c=Vi(s._lastTurnResponse,s._currentAgent,r,t);s._lastProcessedResponse=c;const l=await to(s._currentAgent,s._originalInput,s._generatedItems,s._lastTurnResponse,s._lastProcessedResponse,this,s);s._toolUseTracker.addToolUse(s._currentAgent,s._lastProcessedResponse.toolsUsed),s._originalInput=l.originalInput,s._generatedItems=l.generatedItems,s._currentStep=l.nextStep}if(s._currentStep&&"next_step_final_output"===s._currentStep.type)return await this.#Z(s,s._currentStep.output),this.emit("agent_end",s._context,s._currentAgent,s._currentStep.output),s._currentAgent.emit("agent_end",s._context,s._currentStep.output),new Ni(s);if(s._currentStep&&"next_step_handoff"===s._currentStep.type)s._currentAgent=s._currentStep.newAgent,s._currentAgentSpan&&(s._currentAgentSpan.end(),Ur(),s._currentAgentSpan=void 0),s._noActiveAgentRun=!0,s._currentStep={type:"next_step_run_again"};else{if(s._currentStep&&"next_step_interruption"===s._currentStep.type)return new Ni(s);fn.debug("Running next loop")}}}catch(e){throw s._currentAgentSpan&&s._currentAgentSpan.setError({message:"Error in agent run",data:{error:String(e)}}),e}finally{s._currentAgentSpan&&("next_step_interruption"!==s._currentStep?.type&&s._currentAgentSpan.end(),Ur())}})}async#L(e){const t=this.inputGuardrailDefs.concat(e._currentAgent.inputGuardrails.map(La));if(t.length>0){const n={agent:e._currentAgent,input:e._originalInput,context:e._context};try{const s=await Promise.all(t.map(async t=>xa(async e=>{const s=await t.run(n);return e.spanData.triggered=s.output.tripwireTriggered,s},{data:{name:t.name}},e._currentAgentSpan)));for(const t of s)if(t.output.tripwireTriggered)throw e._currentAgentSpan&&e._currentAgentSpan.setError({message:"Guardrail tripwire triggered",data:{guardrail:t.guardrail.name}}),new Qt(`Input guardrail triggered: ${JSON.stringify(t.output.outputInfo)}`,t,e)}catch(t){if(t instanceof Qt)throw t;throw e._currentTurn--,new Xt(`Input guardrail failed to complete: ${t}`,t,e)}}}async#Z(e,t){const n=this.outputGuardrailDefs.concat(e._currentAgent.outputGuardrails.map(Za));if(n.length>0){const s=e._currentAgent.processFinalOutput(t),r={agent:e._currentAgent,agentOutput:s,context:e._context,details:{modelResponse:e._lastTurnResponse}};try{const t=await Promise.all(n.map(async t=>xa(async e=>{const n=await t.run(r);return e.spanData.triggered=n.output.tripwireTriggered,n},{data:{name:t.name}},e._currentAgentSpan)));for(const n of t)if(n.output.tripwireTriggered)throw e._currentAgentSpan&&e._currentAgentSpan.setError({message:"Guardrail tripwire triggered",data:{guardrail:n.guardrail.name}}),new en(`Output guardrail triggered: ${JSON.stringify(n.output.outputInfo)}`,n,e)}catch(t){if(t instanceof en)throw t;throw new Xt(`Output guardrail failed to complete: ${t}`,t,e)}}}async#F(e,t){try{for(;;){const n=e.state._currentAgent,s=n.handoffs.map(qa),r=await n.getAllTools(e.state._context),a=r.map(e=>Di(e)),i=s.map(e=>ji(e));if(e.state._currentStep=e.state._currentStep??{type:"next_step_run_again"},"next_step_interruption"===e.state._currentStep.type){if(fn.debug("Continuing from interruption"),!e.state._lastTurnResponse||!e.state._lastProcessedResponse)throw new Vt("No model response found in previous state",e.state);const t=await eo(e.state._currentAgent,e.state._originalInput,e.state._generatedItems,e.state._lastTurnResponse,e.state._lastProcessedResponse,this,e.state);if(uo(e,t),e.state._toolUseTracker.addToolUse(e.state._currentAgent,e.state._lastProcessedResponse.toolsUsed),e.state._originalInput=t.originalInput,e.state._generatedItems=t.generatedItems,e.state._currentStep=t.nextStep,"next_step_interruption"===t.nextStep.type)return;continue}if("next_step_run_again"===e.state._currentStep.type){if(!e.state._currentAgentSpan){const t=s.map(e=>e.agentName);e.state._currentAgentSpan=da({data:{name:n.name,handoffs:t,tools:r.map(e=>e.name),output_type:n.outputSchemaName}}),e.state._currentAgentSpan.start(),Fr(e.state._currentAgentSpan)}if(e.state._currentTurn++,e.state._currentTurn>e.state._maxTurns)throw e.state._currentAgentSpan?.setError({message:"Max turns exceeded",data:{max_turns:e.state._maxTurns}}),new Kt(`Max turns (${e.state._maxTurns}) exceeded`,e.state);fn.debug(`Running agent ${n.name} (turn ${e.state._currentTurn})`);let o=Po(n.model,this.config.model);"string"==typeof o&&(o=await this.config.modelProvider.getModel(o)),1===e.state._currentTurn&&await this.#L(e.state);let u={...this.config.modelSettings,...n.modelSettings};u=Qi(n,e.state._toolUseTracker,u);const c=Oo(e.input,e.newItems);let l;e.state._noActiveAgentRun&&(n.emit("agent_start",e.state._context,n),this.emit("agent_start",e.state._context,n));for await(const s of o.getStreamedResponse({systemInstructions:await n.getSystemPrompt(e.state._context),prompt:await n.getPrompt(e.state._context),input:c,previousResponseId:t.previousResponseId,modelSettings:u,tools:a,handoffs:i,outputType:rn(n.outputType),tracing:Co(this.config.tracingDisabled,this.config.traceIncludeSensitiveData),signal:t.signal})){if("response_done"===s.type){const e=Ii.parse(s);l={usage:new Ei(e.response.usage),output:e.response.output,responseId:e.response.id}}if(e.cancelled)return;e._addItem(new Gi(s))}if(e.state._noActiveAgentRun=!1,!l)throw new Ht("Model did not produce a final response!",e.state);e.state._lastTurnResponse=l,e.state._modelResponses.push(e.state._lastTurnResponse);const d=Vi(e.state._lastTurnResponse,n,r,s);e.state._lastProcessedResponse=d;const p=await to(n,e.state._originalInput,e.state._generatedItems,e.state._lastTurnResponse,e.state._lastProcessedResponse,this,e.state);uo(e,p),e.state._toolUseTracker.addToolUse(n,d.toolsUsed),e.state._originalInput=p.originalInput,e.state._generatedItems=p.generatedItems,e.state._currentStep=p.nextStep}if("next_step_final_output"===e.state._currentStep.type)return void await this.#Z(e.state,e.state._currentStep.output);if("next_step_interruption"===e.state._currentStep.type)return;"next_step_handoff"===e.state._currentStep.type?(e.state._currentAgent=e.state._currentStep?.newAgent,e.state._currentAgentSpan&&(e.state._currentAgentSpan.end(),Ur()),e.state._currentAgentSpan=void 0,e._addItem(new Hi(e.state._currentAgent)),e.state._noActiveAgentRun=!0,e.state._currentStep={type:"next_step_run_again"}):fn.debug("Running next loop")}}catch(t){throw e.state._currentAgentSpan&&e.state._currentAgentSpan.setError({message:"Error in agent run",data:{error:String(t)}}),t}finally{e.state._currentAgentSpan&&("next_step_interruption"!==e.state._currentStep?.type&&e.state._currentAgentSpan.end(),Ur())}}async#U(e,t,n){return n=n??{},qr(async()=>{const s=t instanceof ko?t:new ko(n.context instanceof Ri?n.context:new Ri(n.context),t,e,n.maxTurns??10),r=new $i({signal:n.signal,state:s});return r.maxTurns=n.maxTurns??s._maxTurns,this.#F(r,n).then(()=>{r._done()},e=>{r._raiseError(e)}),r})}run(e,t,n={stream:!1,context:void 0}){return t instanceof ko&&t._trace?Lr(t._trace,async()=>(t._currentAgentSpan&&Fr(t._currentAgentSpan),n?.stream?this.#U(e,t,n):this.#M(e,t,n))):Zr(async()=>n?.stream?this.#U(e,t,n):this.#M(e,t,n),{traceId:this.config.traceId,name:this.config.workflowName,groupId:this.config.groupId,metadata:this.config.traceMetadata})}}let Ro;function Po(e,t){return"string"==typeof e&&e!==$o.DEFAULT_MODEL_PLACEHOLDER||e?e:t??e??$o.DEFAULT_MODEL_PLACEHOLDER}async function No(e,t,n){const s=Ro||(Ro=new Eo,Ro);return await s.run(e,t,n)}class $o extends ja{static create(e){return new $o({...e,handoffs:e.handoffs,outputType:e.outputType,handoffOutputTypeWarningEnabled:!1})}static DEFAULT_MODEL_PLACEHOLDER="";name;instructions;prompt;handoffDescription;handoffs;model;modelSettings;tools;mcpServers;inputGuardrails;outputGuardrails;outputType="text";toolUseBehavior;resetToolChoice;constructor(e){if(super(),"string"!=typeof e.name||""===e.name.trim())throw new Vt("Agent must have a name.");if(this.name=e.name,this.instructions=e.instructions??$o.DEFAULT_MODEL_PLACEHOLDER,this.prompt=e.prompt,this.handoffDescription=e.handoffDescription??"",this.handoffs=e.handoffs??[],this.model=e.model??"",this.modelSettings=e.modelSettings??{},this.tools=e.tools??[],this.mcpServers=e.mcpServers??[],this.inputGuardrails=e.inputGuardrails??[],this.outputGuardrails=e.outputGuardrails??[],e.outputType&&(this.outputType=e.outputType),this.toolUseBehavior=e.toolUseBehavior??"run_llm_again",this.resetToolChoice=e.resetToolChoice??!0,(void 0===e.handoffOutputTypeWarningEnabled||e.handoffOutputTypeWarningEnabled)&&this.handoffs&&this.outputType){const e=new Set([JSON.stringify(this.outputType)]);for(const t of this.handoffs)"outputType"in t&&t.outputType?e.add(JSON.stringify(t.outputType)):"agent"in t&&t.agent.outputType&&e.add(JSON.stringify(t.agent.outputType));e.size>1&&fn.warn(`[Agent] Warning: Handoff agents have different output types: ${Array.from(e).join(", ")}. You can make it type-safe by using Agent.create({ ... }) method instead.`)}}get outputSchemaName(){if("text"===this.outputType)return"text";if(tn(this.outputType))return"ZodOutput";if("object"==typeof this.outputType)return this.outputType.name;throw new Error(`Unknown output type: ${this.outputType}`)}clone(e){return new $o({...this,...e})}asTool(e){const{toolName:t,toolDescription:n,customOutputExtractor:s}=e;return vn({name:t??nn(this.name),description:n??"",parameters:{type:"object",properties:{input:{type:"string"}},required:["input"],additionalProperties:!1},strict:!0,execute:async(e,t)=>{if("object"!=typeof(n=e)||null===n||!("input"in n)||"string"!=typeof n.input)throw new Ht("Agent tool called with invalid input");var n;const r=new Eo,a=await r.run(this,e.input,{context:t?.context});return"function"==typeof s?s(a):0===(i=a.rawResponses[a.rawResponses.length-1]).output.length?"":Wi(i.output[i.output.length-1])||"";var i}})}async getSystemPrompt(e){return"function"==typeof this.instructions?await this.instructions(e,this):this.instructions}async getPrompt(e){return"function"==typeof this.prompt?await this.prompt(e,this):this.prompt}async getMcpTools(e){return this.mcpServers.length>0?br({mcpServers:this.mcpServers,runContext:e,agent:this,convertSchemasToStrict:!1}):[]}async getAllTools(e){return[...await this.getMcpTools(e),...this.tools]}processFinalOutput(e){if("text"===this.outputType)return e;if("object"==typeof this.outputType){const t=JSON.parse(e);return tn(this.outputType)?this.outputType.parse(t):t}throw new Error(`Unknown output type: ${this.outputType}`)}toJSON(){return{name:this.name}}}function Do(e,t){return{type:"message",role:"user",content:"string"==typeof e?[{type:"input_text",text:e}]:e,providerData:t}}function jo(e,t){return{type:"message",role:"system",content:e,providerData:t}}function Mo(e,t){return{type:"message",role:"assistant",content:"string"==typeof e?[{type:"output_text",text:e}]:e,status:"completed",providerData:t}}function Lo(e){if(!e?.allowed&&!e?.blocked)return;const t={};return e?.allowed&&(t.allowedToolNames=e.allowed),e?.blocked&&(t.blockedToolNames=e.blocked),t}function Zo(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n}function Fo(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)}Ra(Vr());let Uo=function(){const{crypto:e}=globalThis;if(e?.randomUUID)return Uo=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^n()&15>>+e/4).toString(16))};const Bo=/^[a-z][a-z0-9+.-]*:/i;let qo=e=>(qo=Array.isArray,qo(e)),zo=qo;function Jo(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}const Wo=e=>new Promise(t=>setTimeout(t,e)),Go="5.12.2",Ko=()=>{const e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Go,"X-Stainless-OS":Vo(Deno.build.os),"X-Stainless-Arch":Ho(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Go,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Go,"X-Stainless-OS":Vo(globalThis.process.platform??"unknown"),"X-Stainless-Arch":Ho(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const t=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e)return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Go,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Go,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},Ho=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",Vo=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let Xo;function Yo(...e){const t=globalThis.ReadableStream;if(void 0===t)throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function Qo(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return Yo({start(){},async pull(e){const{done:n,value:s}=await t.next();n?e.close():e.enqueue(s)},async cancel(){await(t.return?.())}})}function eu(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const tu=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),nu="RFC3986",su=e=>String(e),ru={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:su};let au=(e,t)=>(au=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),au(e,t));const iu=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})(),ou=1024;function uu(e,t){if(qo(e)){const n=[];for(let s=0;s<e.length;s+=1)n.push(t(e[s]));return n}return t(e)}const cu={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},lu=function(e,t){Array.prototype.push.apply(e,qo(t)?t:[t])};let du;const pu={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,n,s,r)=>{if(0===e.length)return e;let a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===n)return escape(a).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let i="";for(let e=0;e<a.length;e+=ou){const t=a.length>=ou?a.slice(e,e+ou):a,n=[];for(let e=0;e<t.length;++e){let s=t.charCodeAt(e);45===s||46===s||95===s||126===s||s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122||"RFC1738"===r&&(40===s||41===s)?n[n.length]=t.charAt(e):s<128?n[n.length]=iu[s]:s<2048?n[n.length]=iu[192|s>>6]+iu[128|63&s]:s<55296||s>=57344?n[n.length]=iu[224|s>>12]+iu[128|s>>6&63]+iu[128|63&s]:(e+=1,s=65536+((1023&s)<<10|1023&t.charCodeAt(e)),n[n.length]=iu[240|s>>18]+iu[128|s>>12&63]+iu[128|s>>6&63]+iu[128|63&s])}i+=n.join("")}return i},encodeValuesOnly:!1,format:nu,formatter:su,indices:!1,serializeDate:e=>(du??(du=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},hu={};function fu(e,t,n,s,r,a,i,o,u,c,l,d,p,h,f,m,g,y){let _=e,v=y,w=0,b=!1;for(;void 0!==(v=v.get(hu))&&!b;){const t=v.get(e);if(w+=1,void 0!==t){if(t===w)throw new RangeError("Cyclic object value");b=!0}void 0===v.get(hu)&&(w=0)}if("function"==typeof c?_=c(t,_):_ instanceof Date?_=p?.(_):"comma"===n&&qo(_)&&(_=uu(_,function(e){return e instanceof Date?p?.(e):e})),null===_){if(a)return u&&!m?u(t,pu.encoder,g,"key",h):t;_=""}if("string"==typeof(x=_)||"number"==typeof x||"boolean"==typeof x||"symbol"==typeof x||"bigint"==typeof x||function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))}(_)){if(u){const e=m?t:u(t,pu.encoder,g,"key",h);return[f?.(e)+"="+f?.(u(_,pu.encoder,g,"value",h))]}return[f?.(t)+"="+f?.(String(_))]}var x;const S=[];if(void 0===_)return S;let k;if("comma"===n&&qo(_))m&&u&&(_=uu(_,u)),k=[{value:_.length>0?_.join(",")||null:void 0}];else if(qo(c))k=c;else{const e=Object.keys(_);k=l?e.sort(l):e}const T=o?String(t).replace(/\./g,"%2E"):String(t),A=s&&qo(_)&&1===_.length?T+"[]":T;if(r&&qo(_)&&0===_.length)return A+"[]";for(let t=0;t<k.length;++t){const v=k[t],b="object"==typeof v&&void 0!==v.value?v.value:_[v];if(i&&null===b)continue;const x=d&&o?v.replace(/\./g,"%2E"):v,T=qo(_)?"function"==typeof n?n(A,x):A:A+(d?"."+x:"["+x+"]");y.set(e,w);const I=new WeakMap;I.set(hu,y),lu(S,fu(b,T,n,s,r,a,i,o,"comma"===n&&m&&qo(_)?null:u,c,l,d,p,h,f,m,g,I))}return S}let mu,gu;function yu(e){let t;return(mu??(t=new globalThis.TextEncoder,mu=t.encode.bind(t)))(e)}function _u(e){let t;return(gu??(t=new globalThis.TextDecoder,gu=t.decode.bind(t)))(e)}var vu,wu;class bu{constructor(){vu.set(this,void 0),wu.set(this,void 0),Zo(this,vu,new Uint8Array,"f"),Zo(this,wu,null,"f")}decode(e){if(null==e)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?yu(e):e;Zo(this,vu,function(e){let t=0;for(const n of e)t+=n.length;const n=new Uint8Array(t);let s=0;for(const t of e)n.set(t,s),s+=t.length;return n}([Fo(this,vu,"f"),t]),"f");const n=[];let s;for(;null!=(s=xu(Fo(this,vu,"f"),Fo(this,wu,"f")));){if(s.carriage&&null==Fo(this,wu,"f")){Zo(this,wu,s.index,"f");continue}if(null!=Fo(this,wu,"f")&&(s.index!==Fo(this,wu,"f")+1||s.carriage)){n.push(_u(Fo(this,vu,"f").subarray(0,Fo(this,wu,"f")-1))),Zo(this,vu,Fo(this,vu,"f").subarray(Fo(this,wu,"f")),"f"),Zo(this,wu,null,"f");continue}const e=null!==Fo(this,wu,"f")?s.preceding-1:s.preceding,t=_u(Fo(this,vu,"f").subarray(0,e));n.push(t),Zo(this,vu,Fo(this,vu,"f").subarray(s.index),"f"),Zo(this,wu,null,"f")}return n}flush(){return Fo(this,vu,"f").length?this.decode("\n"):[]}}function xu(e,t){for(let n=t??0;n<e.length;n++){if(10===e[n])return{preceding:n,index:n+1,carriage:!1};if(13===e[n])return{preceding:n,index:n+1,carriage:!0}}return null}function Su(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}vu=new WeakMap,wu=new WeakMap,bu.NEWLINE_CHARS=new Set(["\n","\r"]),bu.NEWLINE_REGEXP=/\r\n|[\n\r]/g;const ku={off:0,error:200,warn:300,info:400,debug:500},Tu=(e,t,n)=>{var s,r;if(e)return s=ku,r=e,Object.prototype.hasOwnProperty.call(s,r)?e:void Eu(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(ku))}`)};function Au(){}function Iu(e,t,n){return!t||ku[e]>ku[n]?Au:t[e].bind(t)}const Cu={error:Au,warn:Au,info:Au,debug:Au};let Ou=new WeakMap;function Eu(e){const t=e.logger,n=e.logLevel??"off";if(!t)return Cu;const s=Ou.get(t);if(s&&s[0]===n)return s[1];const r={error:Iu("error",t,n),warn:Iu("warn",t,n),info:Iu("info",t,n),debug:Iu("debug",t,n)};return Ou.set(t,[n,r]),r}const Ru=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);var Pu,Nu,$u;class Du{constructor(e,t,n){this.iterator=e,Pu.set(this,void 0),this.controller=t,Zo(this,Pu,n,"f")}static fromSSEResponse(e,t,n){let s=!1;const r=n?Eu(n):console;return new Du(async function*(){if(s)throw new l("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{for await(const s of async function*(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new l("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new l("Attempted to iterate over a response with no body")}const n=new ju,s=new bu,r=eu(e.body);for await(const e of async function*(e){let t=new Uint8Array;for await(const n of e){if(null==n)continue;const e=n instanceof ArrayBuffer?new Uint8Array(n):"string"==typeof n?yu(n):n;let s,r=new Uint8Array(t.length+e.length);for(r.set(t),r.set(e,t.length),t=r;-1!==(s=Su(t));)yield t.slice(0,s),t=t.slice(s)}t.length>0&&(yield t)}(r))for(const t of s.decode(e)){const e=n.decode(t);e&&(yield e)}for(const e of s.flush()){const t=n.decode(e);t&&(yield t)}}(e,t))if(!n)if(s.data.startsWith("[DONE]"))n=!0;else if(null!==s.event&&s.event.startsWith("thread.")){let e;try{e=JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if("error"==s.event)throw new d(void 0,e.error,e.message,void 0);yield{event:s.event,data:e}}else{let t;try{t=JSON.parse(s.data)}catch(e){throw r.error("Could not parse message into JSON:",s.data),r.error("From chunk:",s.raw),e}if(t&&t.error)throw new d(void 0,t.error,void 0,e.headers);yield t}n=!0}catch(e){if(u(e))return;throw e}finally{n||t.abort()}},t,n)}static fromReadableStream(e,t,n){let s=!1;return new Du(async function*(){if(s)throw new l("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{for await(const t of async function*(){const t=new bu,n=eu(e);for await(const e of n)for(const n of t.decode(e))yield n;for(const e of t.flush())yield e}())n||t&&(yield JSON.parse(t));n=!0}catch(e){if(u(e))return;throw e}finally{n||t.abort()}},t,n)}[(Pu=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=s=>({next:()=>{if(0===s.length){const s=n.next();e.push(s),t.push(s)}return s.shift()}});return[new Du(()=>s(e),this.controller,Fo(this,Pu,"f")),new Du(()=>s(t),this.controller,Fo(this,Pu,"f"))]}toReadableStream(){const e=this;let t;return Yo({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:n,done:s}=await t.next();if(s)return e.close();const r=yu(JSON.stringify(n)+"\n");e.enqueue(r)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}class ju{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=function(e){const t=e.indexOf(":");return-1!==t?[e.substring(0,t),":",e.substring(t+1)]:[e,"",""]}(e);return s.startsWith(" ")&&(s=s.substring(1)),"event"===t?this.event=s:"data"===t&&this.data.push(s),null}}async function Mu(e,t){const{response:n,requestLogID:s,retryOfRequestLogID:r,startTime:a}=t,i=await(async()=>{if(t.options.stream)return Eu(e).debug("response",n.status,n.url,n.headers,n.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(n,t.controller,e):Du.fromSSEResponse(n,t.controller,e);if(204===n.status)return null;if(t.options.__binaryResponse)return n;const s=n.headers.get("content-type"),r=s?.split(";")[0]?.trim();return r?.includes("application/json")||r?.endsWith("+json")?Lu(await n.json(),n):await n.text()})();return Eu(e).debug(`[${s}] response parsed`,Ru({retryOfRequestLogID:r,url:n.url,status:n.status,body:i,durationMs:Date.now()-a})),i}function Lu(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class Zu extends Promise{constructor(e,t,n=Mu){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=n,Nu.set(this,void 0),Zo(this,Nu,e,"f")}_thenUnwrap(e){return new Zu(Fo(this,Nu,"f"),this.responsePromise,async(t,n)=>Lu(e(await this.parseResponse(t,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(Fo(this,Nu,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}Nu=new WeakMap;class Fu{constructor(e,t,n,s){$u.set(this,void 0),Zo(this,$u,e,"f"),this.options=s,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new l("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await Fo(this,$u,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[($u=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Uu extends Zu{constructor(e,t,n){super(e,t,async(e,t)=>new n(e,t.response,await Mu(e,t),t.options))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}class Bu extends Fu{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class qu extends Fu{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){const e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...(n=this.options.query,"object"!=typeof n?{}:n??{}),after:t}}:null;var n}}const zu=()=>{if("undefined"==typeof File){const{process:e}=globalThis,t="string"==typeof e?.versions?.node&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Ju(e,t,n){return zu(),new File(e,t??"unknown_file",n)}function Wu(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const Gu=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],Ku=async(e,t)=>({...e,body:await Vu(e.body,t)}),Hu=new WeakMap,Vu=async(e,t)=>{if(!await function(e){const t="function"==typeof e?e:e.fetch,n=Hu.get(t);if(n)return n;const s=(async()=>{try{const e="Response"in t?t.Response:(await t("data:,")).constructor,n=new FormData;return n.toString()!==await new e(n).text()}catch{return!0}})();return Hu.set(t,s),s}(t))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const n=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>Xu(n,e,t))),n},Xu=async(e,t,n)=>{if(void 0!==n){if(null==n)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)e.append(t,String(n));else if(n instanceof Response)e.append(t,Ju([await n.blob()],Wu(n)));else if(Gu(n))e.append(t,Ju([await new Response(Qo(n)).blob()],Wu(n)));else if((e=>e instanceof Blob&&"name"in e)(n))e.append(t,n,Wu(n));else if(Array.isArray(n))await Promise.all(n.map(n=>Xu(e,t+"[]",n)));else{if("object"!=typeof n)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`);await Promise.all(Object.entries(n).map(([n,s])=>Xu(e,`${t}[${n}]`,s)))}}},Yu=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function Qu(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(Yu(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else{if(!Gu(e)){const t=e?.constructor?.name;throw new Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";return`; props: [${Object.getOwnPropertyNames(e).map(e=>`"${e}"`).join(", ")}]`}(e)}`)}for await(const n of e)t.push(...await Qu(n))}return t}class ec{constructor(e){this._client=e}}function tc(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const nc=Object.freeze(Object.create(null)),sc=(e=tc)=>function(t,...n){if(1===t.length)return t[0];let s=!1;const r=[],a=t.reduce((t,a,i)=>{/[?#]/.test(a)&&(s=!0);const o=n[i];let u=(s?encodeURIComponent:e)(""+o);return i!==n.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??nc)??nc)?.toString)&&(u=o+"",r.push({start:t.length+a.length,length:u.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+a+(i===n.length?"":u)},""),i=a.split(/[?#]/,1)[0],o=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;let u;for(;null!==(u=o.exec(i));)r.push({start:u.index,length:u[0].length,error:`Value "${u[0]}" can't be safely passed as a path parameter`});if(r.sort((e,t)=>e.start-t.start),r.length>0){let e=0;const t=r.reduce((t,n)=>{const s=" ".repeat(n.start-e),r="^".repeat(n.length);return e=n.start+n.length,t+s+r},"");throw new l(`Path parameters result in path with invalid segments:\n${r.map(e=>e.error).join("\n")}\n${a}\n${t}`)}return a},rc=sc(tc);class ac extends ec{list(e,t={},n){return this._client.getAPIList(rc`/chat/completions/${e}/messages`,qu,{query:t,...n})}}const ic=e=>"assistant"===e?.role,oc=e=>"tool"===e?.role;var uc,cc,lc,dc,pc,hc,fc,mc,gc,yc,_c,vc,wc,bc,xc,Sc,kc,Tc,Ac,Ic,Cc;class Oc{constructor(){uc.add(this),this.controller=new AbortController,cc.set(this,void 0),lc.set(this,()=>{}),dc.set(this,()=>{}),pc.set(this,void 0),hc.set(this,()=>{}),fc.set(this,()=>{}),mc.set(this,{}),gc.set(this,!1),yc.set(this,!1),_c.set(this,!1),vc.set(this,!1),Zo(this,cc,new Promise((e,t)=>{Zo(this,lc,e,"f"),Zo(this,dc,t,"f")}),"f"),Zo(this,pc,new Promise((e,t)=>{Zo(this,hc,e,"f"),Zo(this,fc,t,"f")}),"f"),Fo(this,cc,"f").catch(()=>{}),Fo(this,pc,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},Fo(this,uc,"m",wc).bind(this))},0)}_connected(){this.ended||(Fo(this,lc,"f").call(this),this._emit("connect"))}get ended(){return Fo(this,gc,"f")}get errored(){return Fo(this,yc,"f")}get aborted(){return Fo(this,_c,"f")}abort(){this.controller.abort()}on(e,t){return(Fo(this,mc,"f")[e]||(Fo(this,mc,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=Fo(this,mc,"f")[e];if(!n)return this;const s=n.findIndex(e=>e.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(Fo(this,mc,"f")[e]||(Fo(this,mc,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{Zo(this,vc,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)})}async done(){Zo(this,vc,!0,"f"),await Fo(this,pc,"f")}_emit(e,...t){if(Fo(this,gc,"f"))return;"end"===e&&(Zo(this,gc,!0,"f"),Fo(this,hc,"f").call(this));const n=Fo(this,mc,"f")[e];if(n&&(Fo(this,mc,"f")[e]=n.filter(e=>!e.once),n.forEach(({listener:e})=>e(...t))),"abort"===e){const e=t[0];return Fo(this,vc,"f")||n?.length||Promise.reject(e),Fo(this,dc,"f").call(this,e),Fo(this,fc,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];Fo(this,vc,"f")||n?.length||Promise.reject(e),Fo(this,dc,"f").call(this,e),Fo(this,fc,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function Ec(e){return"function"==typeof e.parse}cc=new WeakMap,lc=new WeakMap,dc=new WeakMap,pc=new WeakMap,hc=new WeakMap,fc=new WeakMap,mc=new WeakMap,gc=new WeakMap,yc=new WeakMap,_c=new WeakMap,vc=new WeakMap,uc=new WeakSet,wc=function(e){if(Zo(this,yc,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new p),e instanceof p)return Zo(this,_c,!0,"f"),this._emit("abort",e);if(e instanceof l)return this._emit("error",e);if(e instanceof Error){const t=new l(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new l(String(e)))};const Rc=10;class Pc extends Oc{constructor(){super(...arguments),bc.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),oc(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(ic(e)&&e.tool_calls)for(const t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new l("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Fo(this,bc,"m",xc).call(this)}async finalMessage(){return await this.done(),Fo(this,bc,"m",Sc).call(this)}async finalFunctionToolCall(){return await this.done(),Fo(this,bc,"m",kc).call(this)}async finalFunctionToolCallResult(){return await this.done(),Fo(this,bc,"m",Tc).call(this)}async totalUsage(){return await this.done(),Fo(this,bc,"m",Ac).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=Fo(this,bc,"m",Sc).call(this);t&&this._emit("finalMessage",t);const n=Fo(this,bc,"m",xc).call(this);n&&this._emit("finalContent",n);const s=Fo(this,bc,"m",kc).call(this);s&&this._emit("finalFunctionToolCall",s);const r=Fo(this,bc,"m",Tc).call(this);null!=r&&this._emit("finalFunctionToolCallResult",r),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",Fo(this,bc,"m",Ac).call(this))}async _createChatCompletion(e,t,n){const s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Fo(this,bc,"m",Ic).call(this,t);const r=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(O(r,t))}async _runChatCompletion(e,t,n){for(const e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,n)}async _runTools(e,t,n){const s="tool",{tool_choice:r="auto",stream:a,...i}=t,o="string"!=typeof r&&"function"===r.type&&r?.function?.name,{maxChatCompletions:u=Rc}=n||{},c=t.tools.map(e=>{if(C(e)){if(!e.$callback)throw new l("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),d={};for(const e of c)"function"===e.type&&(d[e.function.name||e.function.function.name]=e.function);const p="tools"in t?c.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<u;++t){const t=await this._createChatCompletion(e,{...i,tool_choice:r,tools:p,messages:[...this.messages]},n),a=t.choices[0]?.message;if(!a)throw new l("missing message in ChatCompletion response");if(!a.tool_calls?.length)return;for(const e of a.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:n,arguments:r}=e.function,a=d[n];if(!a){const e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(d).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:t,content:e});continue}if(o&&o!==n){const e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:s,tool_call_id:t,content:e});continue}let i;try{i=Ec(a)?await a.parse(r):r}catch(e){const n=e instanceof Error?e.message:String(e);this._addMessage({role:s,tool_call_id:t,content:n});continue}const u=await a.function(i,this),c=Fo(this,bc,"m",Cc).call(this,u);if(this._addMessage({role:s,tool_call_id:t,content:c}),o)return}}}}bc=new WeakSet,xc=function(){return Fo(this,bc,"m",Sc).call(this).content??null},Sc=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(ic(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new l("stream ended without producing a ChatCompletionMessage with role=assistant")},kc=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(ic(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>"function"===e.type).at(-1)?.function}},Tc=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(oc(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},Ac=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Ic=function(e){if(null!=e.n&&e.n>1)throw new l("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Cc=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class Nc extends Pc{static runTools(e,t,n){const s=new Nc,r={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,r)),s}_addMessage(e,t=!0){super._addMessage(e,t),ic(e)&&e.content&&this._emit("content",e.content)}}class $c extends Error{}class Dc extends Error{}const jc=e=>function(e,t=511){if("string"!=typeof e)throw new TypeError("expecting str, got "+typeof e);if(!e.trim())throw new Error(`${e} is empty`);return((e,t)=>{const n=e.length;let s=0;const r=e=>{throw new $c(`${e} at position ${s}`)},a=e=>{throw new Dc(`${e} at position ${s}`)},i=()=>(d(),s>=n&&r("Unexpected end of input"),'"'===e[s]?o():"{"===e[s]?u():"["===e[s]?c():"null"===e.substring(s,s+4)||16&t&&n-s<4&&"null".startsWith(e.substring(s))?(s+=4,null):"true"===e.substring(s,s+4)||32&t&&n-s<4&&"true".startsWith(e.substring(s))?(s+=4,!0):"false"===e.substring(s,s+5)||32&t&&n-s<5&&"false".startsWith(e.substring(s))?(s+=5,!1):"Infinity"===e.substring(s,s+8)||128&t&&n-s<8&&"Infinity".startsWith(e.substring(s))?(s+=8,1/0):"-Infinity"===e.substring(s,s+9)||256&t&&1<n-s&&n-s<9&&"-Infinity".startsWith(e.substring(s))?(s+=9,-1/0):"NaN"===e.substring(s,s+3)||64&t&&n-s<3&&"NaN".startsWith(e.substring(s))?(s+=3,NaN):l()),o=()=>{const i=s;let o=!1;for(s++;s<n&&('"'!==e[s]||o&&"\\"===e[s-1]);)o="\\"===e[s]&&!o,s++;if('"'==e.charAt(s))try{return JSON.parse(e.substring(i,++s-Number(o)))}catch(e){a(String(e))}else if(1&t)try{return JSON.parse(e.substring(i,s-Number(o))+'"')}catch(t){return JSON.parse(e.substring(i,e.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},u=()=>{s++,d();const a={};try{for(;"}"!==e[s];){if(d(),s>=n&&8&t)return a;const r=o();d(),s++;try{const e=i();Object.defineProperty(a,r,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(8&t)return a;throw e}d(),","===e[s]&&s++}}catch(e){if(8&t)return a;r("Expected '}' at end of object")}return s++,a},c=()=>{s++;const n=[];try{for(;"]"!==e[s];)n.push(i()),d(),","===e[s]&&s++}catch(e){if(4&t)return n;r("Expected ']' at end of array")}return s++,n},l=()=>{if(0===s){"-"===e&&2&t&&r("Not sure what '-' is");try{return JSON.parse(e)}catch(n){if(2&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}a(String(n))}}const i=s;for("-"===e[s]&&s++;e[s]&&!",]}".includes(e[s]);)s++;s!=n||2&t||r("Unterminated number literal");try{return JSON.parse(e.substring(i,s))}catch(n){"-"===e.substring(i,s)&&2&t&&r("Not sure what '-' is");try{return JSON.parse(e.substring(i,e.lastIndexOf("e")))}catch(e){a(String(e))}}},d=()=>{for(;s<n&&" \n\r\t".includes(e[s]);)s++};return i()})(e.trim(),t)}(e,509);var Mc,Lc,Zc,Fc,Uc,Bc,qc,zc,Jc,Wc,Gc,Kc;class Hc extends Pc{constructor(e){super(),Mc.add(this),Lc.set(this,void 0),Zc.set(this,void 0),Fc.set(this,void 0),Zo(this,Lc,e,"f"),Zo(this,Zc,[],"f")}get currentChatCompletionSnapshot(){return Fo(this,Fc,"f")}static fromReadableStream(e){const t=new Hc(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const s=new Hc(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,n){super._createChatCompletion;const s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Fo(this,Mc,"m",Uc).call(this);const r=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const e of r)Fo(this,Mc,"m",qc).call(this,e);if(r.controller.signal?.aborted)throw new p;return this._addChatCompletion(Fo(this,Mc,"m",Wc).call(this))}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),Fo(this,Mc,"m",Uc).call(this),this._connected();const s=Du.fromReadableStream(e,this.controller);let r;for await(const e of s)r&&r!==e.id&&this._addChatCompletion(Fo(this,Mc,"m",Wc).call(this)),Fo(this,Mc,"m",qc).call(this,e),r=e.id;if(s.controller.signal?.aborted)throw new p;return this._addChatCompletion(Fo(this,Mc,"m",Wc).call(this))}[(Lc=new WeakMap,Zc=new WeakMap,Fc=new WeakMap,Mc=new WeakSet,Uc=function(){this.ended||Zo(this,Fc,void 0,"f")},Bc=function(e){let t=Fo(this,Zc,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Fo(this,Zc,"f")[e.index]=t,t)},qc=function(e){if(this.ended)return;const t=Fo(this,Mc,"m",Kc).call(this,e);this._emit("chunk",e,t);for(const n of e.choices){const e=t.choices[n.index];null!=n.delta.content&&"assistant"===e.message?.role&&e.message?.content&&(this._emit("content",n.delta.content,e.message.content),this._emit("content.delta",{delta:n.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=n.delta.refusal&&"assistant"===e.message?.role&&e.message?.refusal&&this._emit("refusal.delta",{delta:n.delta.refusal,snapshot:e.message.refusal}),null!=n.logprobs?.content&&"assistant"===e.message?.role&&this._emit("logprobs.content.delta",{content:n.logprobs?.content,snapshot:e.logprobs?.content??[]}),null!=n.logprobs?.refusal&&"assistant"===e.message?.role&&this._emit("logprobs.refusal.delta",{refusal:n.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});const s=Fo(this,Mc,"m",Bc).call(this,e);e.finish_reason&&(Fo(this,Mc,"m",Jc).call(this,e),null!=s.current_tool_call_index&&Fo(this,Mc,"m",zc).call(this,e,s.current_tool_call_index));for(const t of n.delta.tool_calls??[])s.current_tool_call_index!==t.index&&(Fo(this,Mc,"m",Jc).call(this,e),null!=s.current_tool_call_index&&Fo(this,Mc,"m",zc).call(this,e,s.current_tool_call_index)),s.current_tool_call_index=t.index;for(const t of n.delta.tool_calls??[]){const n=e.message.tool_calls?.[t.index];n?.type&&("function"===n?.type?this._emit("tool_calls.function.arguments.delta",{name:n.function?.name,index:t.index,arguments:n.function.arguments,parsed_arguments:n.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):Yc())}}},zc=function(e,t){if(Fo(this,Mc,"m",Bc).call(this,e).done_tool_calls.has(t))return;const n=e.message.tool_calls?.[t];if(!n)throw new Error("no tool call snapshot");if(!n.type)throw new Error("tool call snapshot missing `type`");if("function"===n.type){const e=Fo(this,Lc,"f")?.tools?.find(e=>A(e)&&e.function.name===n.function.name);this._emit("tool_calls.function.arguments.done",{name:n.function.name,index:t,arguments:n.function.arguments,parsed_arguments:C(e)?e.$parseRaw(n.function.arguments):e?.function.strict?JSON.parse(n.function.arguments):null})}else n.type},Jc=function(e){const t=Fo(this,Mc,"m",Bc).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;const n=Fo(this,Mc,"m",Gc).call(this);this._emit("content.done",{content:e.message.content,parsed:n?n.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},Wc=function(){if(this.ended)throw new l("stream has ended, this shouldn't happen");const e=Fo(this,Fc,"f");if(!e)throw new l("request ended without sending any chunks");return Zo(this,Fc,void 0,"f"),Zo(this,Zc,[],"f"),function(e,t){const{id:n,choices:s,created:r,model:a,system_fingerprint:i,...o}=e,u={...o,id:n,choices:s.map(({message:t,finish_reason:n,index:s,logprobs:r,...a})=>{if(!n)throw new l(`missing finish_reason for choice ${s}`);const{content:i=null,function_call:o,tool_calls:u,...c}=t,d=t.role;if(!d)throw new l(`missing role for choice ${s}`);if(o){const{arguments:e,name:u}=o;if(null==e)throw new l(`missing function_call.arguments for choice ${s}`);if(!u)throw new l(`missing function_call.name for choice ${s}`);return{...a,message:{content:i,function_call:{arguments:e,name:u},role:d,refusal:t.refusal??null},finish_reason:n,index:s,logprobs:r}}return u?{...a,index:s,finish_reason:n,logprobs:r,message:{...c,role:d,content:i,refusal:t.refusal??null,tool_calls:u.map((t,n)=>{const{function:r,type:a,id:i,...o}=t,{arguments:u,name:c,...d}=r||{};if(null==i)throw new l(`missing choices[${s}].tool_calls[${n}].id\n${Vc(e)}`);if(null==a)throw new l(`missing choices[${s}].tool_calls[${n}].type\n${Vc(e)}`);if(null==c)throw new l(`missing choices[${s}].tool_calls[${n}].function.name\n${Vc(e)}`);if(null==u)throw new l(`missing choices[${s}].tool_calls[${n}].function.arguments\n${Vc(e)}`);return{...o,id:i,type:a,function:{...d,name:c,arguments:u}}})}}:{...a,message:{...c,content:i,role:d,refusal:t.refusal??null},finish_reason:n,index:s,logprobs:r}}),created:r,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return function(e,t){return t&&P(t)?O(e,t):{...e,choices:e.choices.map(e=>(N(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(u,t)}(e,Fo(this,Lc,"f"))},Gc=function(){const e=Fo(this,Lc,"f")?.response_format;return I(e)?e:null},Kc=function(e){var t,n,s,r;let a=Fo(this,Fc,"f");const{choices:i,...o}=e;a?Object.assign(a,o):a=Zo(this,Fc,{...o,choices:[]},"f");for(const{delta:i,finish_reason:o,index:u,logprobs:c=null,...l}of e.choices){let e=a.choices[u];if(e||(e=a.choices[u]={finish_reason:o,index:u,message:{},logprobs:c,...l}),c)if(e.logprobs){const{content:s,refusal:r,...a}=c;Xc(),Object.assign(e.logprobs,a),s&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...s)),r&&((n=e.logprobs).refusal??(n.refusal=[]),e.logprobs.refusal.push(...r))}else e.logprobs=Object.assign({},c);if(o&&(e.finish_reason=o,Fo(this,Lc,"f")&&P(Fo(this,Lc,"f")))){if("length"===o)throw new S;if("content_filter"===o)throw new k}if(Object.assign(e,l),!i)continue;const{content:d,refusal:p,function_call:h,role:f,tool_calls:m,...g}=i;if(Xc(),Object.assign(e.message,g),p&&(e.message.refusal=(e.message.refusal||"")+p),f&&(e.message.role=f),h&&(e.message.function_call?(h.name&&(e.message.function_call.name=h.name),h.arguments&&((s=e.message.function_call).arguments??(s.arguments=""),e.message.function_call.arguments+=h.arguments)):e.message.function_call=h),d&&(e.message.content=(e.message.content||"")+d,!e.message.refusal&&Fo(this,Mc,"m",Gc).call(this)&&(e.message.parsed=jc(e.message.content))),m){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:n,type:s,function:a,...i}of m){const o=(r=e.message.tool_calls)[t]??(r[t]={});Object.assign(o,i),n&&(o.id=n),s&&(o.type=s),a&&(o.function??(o.function={name:a.name??"",arguments:""})),a?.name&&(o.function.name=a.name),a?.arguments&&(o.function.arguments+=a.arguments,R(Fo(this,Lc,"f"),o)&&(o.function.parsed_arguments=jc(o.function.arguments)))}}}return a},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",n=>{const s=t.shift();s?s.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Du(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Vc(e){return JSON.stringify(e)}function Xc(e){}function Yc(e){}class Qc extends Hc{static fromReadableStream(e){const t=new Qc(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,n){const s=new Qc(t),r={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,r)),s}}class el extends ec{constructor(){super(...arguments),this.messages=new ac(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(rc`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(rc`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/chat/completions",qu,{query:e,...t})}delete(e,t){return this._client.delete(rc`/chat/completions/${e}`,t)}parse(e,t){return function(e){for(const t of e??[]){if("function"!==t.type)throw new l(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new l(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>O(t,e))}runTools(e,t){return e.stream?Qc.runTools(this._client,e,t):Nc.runTools(this._client,e,t)}stream(e,t){return Hc.createChatCompletion(this._client,e,t)}}el.Messages=ac;class tl extends ec{constructor(){super(...arguments),this.completions=new el(this._client)}}tl.Completions=el;const nl=Symbol("brand.privateNullableHeaders");function*sl(e){if(!e)return;if(nl in e){const{values:t,nulls:n}=e;yield*t.entries();for(const e of n)yield[e,null];return}let t,n=!1;e instanceof Headers?t=e.entries():zo(e)?t=e:(n=!0,t=Object.entries(e??{}));for(let e of t){const t=e[0];if("string"!=typeof t)throw new TypeError("expected header name to be a string");const s=zo(e[1])?e[1]:[e[1]];let r=!1;for(const e of s)void 0!==e&&(n&&!r&&(r=!0,yield[t,null]),yield[t,e])}}const rl=e=>{const t=new Headers,n=new Set;for(const s of e){const e=new Set;for(const[r,a]of sl(s)){const s=r.toLowerCase();e.has(s)||(t.delete(r),e.add(s)),null===a?(t.delete(r),n.add(s)):(t.append(r,a),n.delete(s))}}return{[nl]:!0,values:t,nulls:n}};class al extends ec{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:rl([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class il extends ec{create(e,t){return this._client.post("/audio/transcriptions",Ku({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class ol extends ec{create(e,t){return this._client.post("/audio/translations",Ku({body:e,...t,__metadata:{model:e.model}},this._client))}}class ul extends ec{constructor(){super(...arguments),this.transcriptions=new il(this._client),this.translations=new ol(this._client),this.speech=new al(this._client)}}ul.Transcriptions=il,ul.Translations=ol,ul.Speech=al;class cl extends ec{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(rc`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",qu,{query:e,...t})}cancel(e,t){return this._client.post(rc`/batches/${e}/cancel`,t)}}class ll extends ec{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:rl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(rc`/assistants/${e}`,{...t,headers:rl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(rc`/assistants/${e}`,{body:t,...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",qu,{query:e,...t,headers:rl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(rc`/assistants/${e}`,{...t,headers:rl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class dl extends ec{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:rl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class pl extends ec{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:rl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class hl extends ec{constructor(){super(...arguments),this.sessions=new dl(this._client),this.transcriptionSessions=new pl(this._client)}}hl.Sessions=dl,hl.TranscriptionSessions=pl;class fl extends ec{create(e,t,n){return this._client.post(rc`/threads/${e}/messages`,{body:t,...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){const{thread_id:s}=t;return this._client.get(rc`/threads/${s}/messages/${e}`,{...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){const{thread_id:s,...r}=t;return this._client.post(rc`/threads/${s}/messages/${e}`,{body:r,...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(rc`/threads/${e}/messages`,qu,{query:t,...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){const{thread_id:s}=t;return this._client.delete(rc`/threads/${s}/messages/${e}`,{...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}class ml extends ec{retrieve(e,t,n){const{thread_id:s,run_id:r,...a}=t;return this._client.get(rc`/threads/${s}/runs/${r}/steps/${e}`,{query:a,...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t,n){const{thread_id:s,...r}=t;return this._client.getAPIList(rc`/threads/${s}/runs/${e}/steps`,qu,{query:r,...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}var gl=n(271).hp;const yl=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;var _l,vl,wl,bl,xl,Sl,kl,Tl,Al,Il,Cl,Ol,El,Rl,Pl,Nl,$l,Dl,jl,Ml,Ll,Zl,Fl,Ul,Bl,ql,zl,Jl,Wl,Gl,Kl;class Hl extends Oc{constructor(){super(...arguments),_l.add(this),wl.set(this,[]),bl.set(this,{}),xl.set(this,{}),Sl.set(this,void 0),kl.set(this,void 0),Tl.set(this,void 0),Al.set(this,void 0),Il.set(this,void 0),Cl.set(this,void 0),Ol.set(this,void 0),El.set(this,void 0),Rl.set(this,void 0)}[(wl=new WeakMap,bl=new WeakMap,xl=new WeakMap,Sl=new WeakMap,kl=new WeakMap,Tl=new WeakMap,Al=new WeakMap,Il=new WeakMap,Cl=new WeakMap,Ol=new WeakMap,El=new WeakMap,Rl=new WeakMap,_l=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",n=>{const s=t.shift();s?s.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new vl;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=Du.fromReadableStream(e,this.controller);for await(const e of s)Fo(this,_l,"m",Pl).call(this,e);if(s.controller.signal?.aborted)throw new p;return this._addRun(Fo(this,_l,"m",Nl).call(this))}toReadableStream(){return new Du(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,s){const r=new vl;return r._run(()=>r._runToolAssistantStream(e,t,n,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createToolAssistantStream(e,t,n,s){const r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const a={...n,stream:!0},i=await e.submitToolOutputs(t,a,{...s,signal:this.controller.signal});this._connected();for await(const e of i)Fo(this,_l,"m",Pl).call(this,e);if(i.controller.signal?.aborted)throw new p;return this._addRun(Fo(this,_l,"m",Nl).call(this))}static createThreadAssistantStream(e,t,n){const s=new vl;return s._run(()=>s._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,n,s){const r=new vl;return r._run(()=>r._runAssistantStream(e,t,n,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}currentEvent(){return Fo(this,Ol,"f")}currentRun(){return Fo(this,El,"f")}currentMessageSnapshot(){return Fo(this,Sl,"f")}currentRunStepSnapshot(){return Fo(this,Rl,"f")}async finalRunSteps(){return await this.done(),Object.values(Fo(this,bl,"f"))}async finalMessages(){return await this.done(),Object.values(Fo(this,xl,"f"))}async finalRun(){if(await this.done(),!Fo(this,kl,"f"))throw Error("Final run was not received.");return Fo(this,kl,"f")}async _createThreadAssistantStream(e,t,n){const s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const r={...t,stream:!0},a=await e.createAndRun(r,{...n,signal:this.controller.signal});this._connected();for await(const e of a)Fo(this,_l,"m",Pl).call(this,e);if(a.controller.signal?.aborted)throw new p;return this._addRun(Fo(this,_l,"m",Nl).call(this))}async _createAssistantStream(e,t,n,s){const r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const a={...n,stream:!0},i=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(const e of i)Fo(this,_l,"m",Pl).call(this,e);if(i.controller.signal?.aborted)throw new p;return this._addRun(Fo(this,_l,"m",Nl).call(this))}static accumulateDelta(e,t){for(const[n,s]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let t=e[n];if(null!=t)if("index"!==n&&"type"!==n){if("string"==typeof t&&"string"==typeof s)t+=s;else if("number"==typeof t&&"number"==typeof s)t+=s;else{if(!Jo(t)||!Jo(s)){if(Array.isArray(t)&&Array.isArray(s)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...s);continue}for(const e of s){if(!Jo(e))throw new Error(`Expected array delta entry to be an object but got: ${e}`);const n=e.index;if(null==n)throw console.error(e),new Error("Expected array delta entry to have an `index` property");if("number"!=typeof n)throw new Error(`Expected array delta entry \`index\` property to be a number but got ${n}`);const s=t[n];null==s?t.push(e):t[n]=this.accumulateDelta(s,e)}continue}throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${t}`)}t=this.accumulateDelta(t,s)}e[n]=t}else e[n]=s;else e[n]=s}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,s){return await this._createAssistantStream(t,e,n,s)}async _runToolAssistantStream(e,t,n,s){return await this._createToolAssistantStream(t,e,n,s)}}vl=Hl,Pl=function(e){if(!this.ended)switch(Zo(this,Ol,e,"f"),Fo(this,_l,"m",jl).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":Fo(this,_l,"m",Fl).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Fo(this,_l,"m",Dl).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":Fo(this,_l,"m",$l).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Nl=function(){if(this.ended)throw new l("stream has ended, this shouldn't happen");if(!Fo(this,kl,"f"))throw Error("Final run has not been received");return Fo(this,kl,"f")},$l=function(e){const[t,n]=Fo(this,_l,"m",Ll).call(this,e,Fo(this,Sl,"f"));Zo(this,Sl,t,"f"),Fo(this,xl,"f")[t.id]=t;for(const e of n){const n=t.content[e.index];"text"==n?.type&&this._emit("textCreated",n.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const n of e.data.delta.content){if("text"==n.type&&n.text){let e=n.text,s=t.content[n.index];if(!s||"text"!=s.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,s.text)}if(n.index!=Fo(this,Tl,"f")){if(Fo(this,Al,"f"))switch(Fo(this,Al,"f").type){case"text":this._emit("textDone",Fo(this,Al,"f").text,Fo(this,Sl,"f"));break;case"image_file":this._emit("imageFileDone",Fo(this,Al,"f").image_file,Fo(this,Sl,"f"))}Zo(this,Tl,n.index,"f")}Zo(this,Al,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==Fo(this,Tl,"f")){const t=e.data.content[Fo(this,Tl,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,Fo(this,Sl,"f"));break;case"text":this._emit("textDone",t.text,Fo(this,Sl,"f"))}}Fo(this,Sl,"f")&&this._emit("messageDone",e.data),Zo(this,Sl,void 0,"f")}},Dl=function(e){const t=Fo(this,_l,"m",Ml).call(this,e);switch(Zo(this,Rl,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&"tool_calls"==n.step_details.type&&n.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of n.step_details.tool_calls)e.index==Fo(this,Il,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(Fo(this,Cl,"f")&&this._emit("toolCallDone",Fo(this,Cl,"f")),Zo(this,Il,e.index,"f"),Zo(this,Cl,t.step_details.tool_calls[e.index],"f"),Fo(this,Cl,"f")&&this._emit("toolCallCreated",Fo(this,Cl,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Zo(this,Rl,void 0,"f"),"tool_calls"==e.data.step_details.type&&Fo(this,Cl,"f")&&(this._emit("toolCallDone",Fo(this,Cl,"f")),Zo(this,Cl,void 0,"f")),this._emit("runStepDone",e.data,t)}},jl=function(e){Fo(this,wl,"f").push(e),this._emit("event",e)},Ml=function(e){switch(e.event){case"thread.run.step.created":return Fo(this,bl,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=Fo(this,bl,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const s=vl.accumulateDelta(t,n.delta);Fo(this,bl,"f")[e.data.id]=s}return Fo(this,bl,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":Fo(this,bl,"f")[e.data.id]=e.data}if(Fo(this,bl,"f")[e.data.id])return Fo(this,bl,"f")[e.data.id];throw new Error("No snapshot available")},Ll=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const e of s.delta.content)if(e.index in t.content){let n=t.content[e.index];t.content[e.index]=Fo(this,_l,"m",Zl).call(this,e,n)}else t.content[e.index]=e,n.push(e);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Zl=function(e,t){return vl.accumulateDelta(t,e)},Fl=function(e){switch(Zo(this,El,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.cancelling":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":Zo(this,kl,e.data,"f"),Fo(this,Cl,"f")&&(this._emit("toolCallDone",Fo(this,Cl,"f")),Zo(this,Cl,void 0,"f"))}};class Vl extends ec{constructor(){super(...arguments),this.steps=new ml(this._client)}create(e,t,n){const{include:s,...r}=t;return this._client.post(rc`/threads/${e}/runs`,{query:{include:s},body:r,...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}retrieve(e,t,n){const{thread_id:s}=t;return this._client.get(rc`/threads/${s}/runs/${e}`,{...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){const{thread_id:s,...r}=t;return this._client.post(rc`/threads/${s}/runs/${e}`,{body:r,...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(rc`/threads/${e}/runs`,qu,{query:t,...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){const{thread_id:s}=t;return this._client.post(rc`/threads/${s}/runs/${e}/cancel`,{...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(s.id,{thread_id:e},n)}createAndStream(e,t,n){return Hl.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const s=rl([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:r,response:a}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...s}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=a.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Wo(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,t,n){return Hl.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n){const{thread_id:s,...r}=t;return this._client.post(rc`/threads/${s}/runs/${e}/submit_tool_outputs`,{body:r,...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,n){const s=await this.submitToolOutputs(e,t,n);return await this.poll(s.id,t,n)}submitToolOutputsStream(e,t,n){return Hl.createToolAssistantStream(e,this._client.beta.threads.runs,t,n)}}Vl.Steps=ml;class Xl extends ec{constructor(){super(...arguments),this.runs=new Vl(this._client),this.messages=new fl(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:rl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(rc`/threads/${e}`,{...t,headers:rl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(rc`/threads/${e}`,{body:t,...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t){return this._client.delete(rc`/threads/${e}`,{...t,headers:rl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:rl([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.id,{thread_id:n.thread_id},t)}createAndRunStream(e,t){return Hl.createThreadAssistantStream(e,this._client.beta.threads,t)}}Xl.Runs=Vl,Xl.Messages=fl;class Yl extends ec{constructor(){super(...arguments),this.realtime=new hl(this._client),this.assistants=new ll(this._client),this.threads=new Xl(this._client)}}Yl.Realtime=hl,Yl.Assistants=ll,Yl.Threads=Xl;class Ql extends ec{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class ed extends ec{retrieve(e,t,n){const{container_id:s}=t;return this._client.get(rc`/containers/${s}/files/${e}/content`,{...n,headers:rl([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}}class td extends ec{constructor(){super(...arguments),this.content=new ed(this._client)}create(e,t,n){return this._client.post(rc`/containers/${e}/files`,Ku({body:t,...n},this._client))}retrieve(e,t,n){const{container_id:s}=t;return this._client.get(rc`/containers/${s}/files/${e}`,n)}list(e,t={},n){return this._client.getAPIList(rc`/containers/${e}/files`,qu,{query:t,...n})}delete(e,t,n){const{container_id:s}=t;return this._client.delete(rc`/containers/${s}/files/${e}`,{...n,headers:rl([{Accept:"*/*"},n?.headers])})}}td.Content=ed;class nd extends ec{constructor(){super(...arguments),this.files=new td(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(rc`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",qu,{query:e,...t})}delete(e,t){return this._client.delete(rc`/containers/${e}`,{...t,headers:rl([{Accept:"*/*"},t?.headers])})}}nd.Files=td;class sd extends ec{create(e,t){const n=!!e.encoding_format;let s=n?e.encoding_format:"base64";n&&Eu(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const r=this._client.post("/embeddings",{body:{...e,encoding_format:s},...t});return n?r:(Eu(this._client).debug("embeddings/decoding base64 embeddings from base64"),r._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{const t=e.embedding;e.embedding=(e=>{if(void 0!==gl){const t=gl.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{const t=atob(e),n=t.length,s=new Uint8Array(n);for(let e=0;e<n;e++)s[e]=t.charCodeAt(e);return Array.from(new Float32Array(s.buffer))}})(t)}),e)))}}class rd extends ec{retrieve(e,t,n){const{eval_id:s,run_id:r}=t;return this._client.get(rc`/evals/${s}/runs/${r}/output_items/${e}`,n)}list(e,t,n){const{eval_id:s,...r}=t;return this._client.getAPIList(rc`/evals/${s}/runs/${e}/output_items`,qu,{query:r,...n})}}class ad extends ec{constructor(){super(...arguments),this.outputItems=new rd(this._client)}create(e,t,n){return this._client.post(rc`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){const{eval_id:s}=t;return this._client.get(rc`/evals/${s}/runs/${e}`,n)}list(e,t={},n){return this._client.getAPIList(rc`/evals/${e}/runs`,qu,{query:t,...n})}delete(e,t,n){const{eval_id:s}=t;return this._client.delete(rc`/evals/${s}/runs/${e}`,n)}cancel(e,t,n){const{eval_id:s}=t;return this._client.post(rc`/evals/${s}/runs/${e}`,n)}}ad.OutputItems=rd;class id extends ec{constructor(){super(...arguments),this.runs=new ad(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(rc`/evals/${e}`,t)}update(e,t,n){return this._client.post(rc`/evals/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/evals",qu,{query:e,...t})}delete(e,t){return this._client.delete(rc`/evals/${e}`,t)}}id.Runs=ad;class od extends ec{create(e,t){return this._client.post("/files",Ku({body:e,...t},this._client))}retrieve(e,t){return this._client.get(rc`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",qu,{query:e,...t})}delete(e,t){return this._client.delete(rc`/files/${e}`,t)}content(e,t){return this._client.get(rc`/files/${e}/content`,{...t,headers:rl([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=18e5}={}){const s=new Set(["processed","error","deleted"]),r=Date.now();let a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await Wo(t),a=await this.retrieve(e),Date.now()-r>n)throw new f({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}}class ud extends ec{}class cd extends ec{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class ld extends ec{constructor(){super(...arguments),this.graders=new cd(this._client)}}ld.Graders=cd;class dd extends ec{create(e,t,n){return this._client.getAPIList(rc`/fine_tuning/checkpoints/${e}/permissions`,Bu,{body:t,method:"post",...n})}retrieve(e,t={},n){return this._client.get(rc`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}delete(e,t,n){const{fine_tuned_model_checkpoint:s}=t;return this._client.delete(rc`/fine_tuning/checkpoints/${s}/permissions/${e}`,n)}}class pd extends ec{constructor(){super(...arguments),this.permissions=new dd(this._client)}}pd.Permissions=dd;class hd extends ec{list(e,t={},n){return this._client.getAPIList(rc`/fine_tuning/jobs/${e}/checkpoints`,qu,{query:t,...n})}}class fd extends ec{constructor(){super(...arguments),this.checkpoints=new hd(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(rc`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",qu,{query:e,...t})}cancel(e,t){return this._client.post(rc`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return this._client.getAPIList(rc`/fine_tuning/jobs/${e}/events`,qu,{query:t,...n})}pause(e,t){return this._client.post(rc`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(rc`/fine_tuning/jobs/${e}/resume`,t)}}fd.Checkpoints=hd;class md extends ec{constructor(){super(...arguments),this.methods=new ud(this._client),this.jobs=new fd(this._client),this.checkpoints=new pd(this._client),this.alpha=new ld(this._client)}}md.Methods=ud,md.Jobs=fd,md.Checkpoints=pd,md.Alpha=ld;class gd extends ec{}class yd extends ec{constructor(){super(...arguments),this.graderModels=new gd(this._client)}}yd.GraderModels=gd;class _d extends ec{createVariation(e,t){return this._client.post("/images/variations",Ku({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",Ku({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class vd extends ec{retrieve(e,t){return this._client.get(rc`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Bu,e)}delete(e,t){return this._client.delete(rc`/models/${e}`,t)}}class wd extends ec{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class bd extends Oc{constructor(e){super(),Ul.add(this),Bl.set(this,void 0),ql.set(this,void 0),zl.set(this,void 0),Zo(this,Bl,e,"f")}static createResponse(e,t,n){const s=new bd(t);return s._run(()=>s._createOrRetrieveResponse(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createOrRetrieveResponse(e,t,n){const s=n?.signal;let r;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Fo(this,Ul,"m",Jl).call(this);let a=null;"response_id"in t?(r=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),a=t.starting_after??null):r=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const e of r)Fo(this,Ul,"m",Wl).call(this,e,a);if(r.controller.signal?.aborted)throw new p;return Fo(this,Ul,"m",Gl).call(this)}[(Bl=new WeakMap,ql=new WeakMap,zl=new WeakMap,Ul=new WeakSet,Jl=function(){this.ended||Zo(this,ql,void 0,"f")},Wl=function(e,t){if(this.ended)return;const n=(e,n)=>{(null==t||n.sequence_number>t)&&this._emit(e,n)},s=Fo(this,Ul,"m",Kl).call(this,e);switch(n("event",e),e.type){case"response.output_text.delta":{const t=s.output[e.output_index];if(!t)throw new l(`missing output at index ${e.output_index}`);if("message"===t.type){const s=t.content[e.content_index];if(!s)throw new l(`missing content at index ${e.content_index}`);if("output_text"!==s.type)throw new l(`expected content to be 'output_text', got ${s.type}`);n("response.output_text.delta",{...e,snapshot:s.text})}break}case"response.function_call_arguments.delta":{const t=s.output[e.output_index];if(!t)throw new l(`missing output at index ${e.output_index}`);"function_call"===t.type&&n("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:n(e.type,e)}},Gl=function(){if(this.ended)throw new l("stream has ended, this shouldn't happen");const e=Fo(this,ql,"f");if(!e)throw new l("request ended without sending any events");Zo(this,ql,void 0,"f");const t=function(e,t){return function(e,t){return t&&function(e){return!!I(e.text?.format)}(t)?Zt(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,t)}(e,Fo(this,Bl,"f"));return Zo(this,zl,t,"f"),t},Kl=function(e){let t=Fo(this,ql,"f");if(!t){if("response.created"!==e.type)throw new l(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return t=Zo(this,ql,e.response,"f"),t}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{const n=t.output[e.output_index];if(!n)throw new l(`missing output at index ${e.output_index}`);"message"===n.type&&n.content.push(e.part);break}case"response.output_text.delta":{const n=t.output[e.output_index];if(!n)throw new l(`missing output at index ${e.output_index}`);if("message"===n.type){const t=n.content[e.content_index];if(!t)throw new l(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new l(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{const n=t.output[e.output_index];if(!n)throw new l(`missing output at index ${e.output_index}`);"function_call"===n.type&&(n.arguments+=e.delta);break}case"response.completed":Zo(this,ql,e.response,"f")}return t},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",n=>{const s=t.shift();s?s.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=Fo(this,zl,"f");if(!e)throw new l("stream ended without producing a ChatCompletion");return e}}class xd extends ec{list(e,t={},n){return this._client.getAPIList(rc`/responses/${e}/input_items`,qu,{query:t,...n})}}class Sd extends ec{constructor(){super(...arguments),this.inputItems=new xd(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&qt(e),e))}retrieve(e,t={},n){return this._client.get(rc`/responses/${e}`,{query:t,...n,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&qt(e),e))}delete(e,t){return this._client.delete(rc`/responses/${e}`,{...t,headers:rl([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>Zt(t,e))}stream(e,t){return bd.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(rc`/responses/${e}/cancel`,t)}}Sd.InputItems=xd;class kd extends ec{create(e,t,n){return this._client.post(rc`/uploads/${e}/parts`,Ku({body:t,...n},this._client))}}class Td extends ec{constructor(){super(...arguments),this.parts=new kd(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(rc`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(rc`/uploads/${e}/complete`,{body:t,...n})}}Td.Parts=kd;class Ad extends ec{create(e,t,n){return this._client.post(rc`/vector_stores/${e}/file_batches`,{body:t,...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){const{vector_store_id:s}=t;return this._client.get(rc`/vector_stores/${s}/file_batches/${e}`,{...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){const{vector_store_id:s}=t;return this._client.post(rc`/vector_stores/${s}/file_batches/${e}/cancel`,{...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){const s=await this.create(e,t);return await this.poll(e,s.id,n)}listFiles(e,t,n){const{vector_store_id:s,...r}=t;return this._client.getAPIList(rc`/vector_stores/${s}/file_batches/${e}/files`,qu,{query:r,...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async poll(e,t,n){const s=rl([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:r,response:a}=await this.retrieve(t,{vector_store_id:e},{...n,headers:s}).withResponse();switch(r.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=a.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Wo(e);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},s){if(null==t||0==t.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const r=s?.maxConcurrency??5,a=Math.min(r,t.length),i=this._client,o=t.values(),u=[...n],c=Array(a).fill(o).map(async function(e){for(let t of e){const e=await i.files.create({file:t,purpose:"assistants"},s);u.push(e.id)}});return await(async e=>{const t=await Promise.allSettled(e),n=t.filter(e=>"rejected"===e.status);if(n.length){for(const e of n)console.error(e.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const s=[];for(const e of t)"fulfilled"===e.status&&s.push(e.value);return s})(c),await this.createAndPoll(e,{file_ids:u})}}class Id extends ec{create(e,t,n){return this._client.post(rc`/vector_stores/${e}/files`,{body:t,...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){const{vector_store_id:s}=t;return this._client.get(rc`/vector_stores/${s}/files/${e}`,{...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){const{vector_store_id:s,...r}=t;return this._client.post(rc`/vector_stores/${s}/files/${e}`,{body:r,...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(rc`/vector_stores/${e}/files`,qu,{query:t,...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){const{vector_store_id:s}=t;return this._client.delete(rc`/vector_stores/${s}/files/${e}`,{...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}async poll(e,t,n){const s=rl([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const r=await this.retrieve(t,{vector_store_id:e},{...n,headers:s}).withResponse(),a=r.data;switch(a.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=r.response.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Wo(e);break;case"failed":case"completed":return a}}}async upload(e,t,n){const s=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)}async uploadAndPoll(e,t,n){const s=await this.upload(e,t,n);return await this.poll(e,s.id,n)}content(e,t,n){const{vector_store_id:s}=t;return this._client.getAPIList(rc`/vector_stores/${s}/files/${e}/content`,Bu,{...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}class Cd extends ec{constructor(){super(...arguments),this.files=new Id(this._client),this.fileBatches=new Ad(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:rl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(rc`/vector_stores/${e}`,{...t,headers:rl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(rc`/vector_stores/${e}`,{body:t,...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",qu,{query:e,...t,headers:rl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(rc`/vector_stores/${e}`,{...t,headers:rl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,n){return this._client.getAPIList(rc`/vector_stores/${e}/search`,Bu,{body:t,method:"post",...n,headers:rl([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}Cd.Files=Id,Cd.FileBatches=Ad;var Od,Ed,Rd,Pd,Nd,$d,Dd,jd=n(271).hp;class Md extends ec{constructor(){super(...arguments),Od.add(this)}async unwrap(e,t,n=this._client.webhookSecret,s=300){return await this.verifySignature(e,t,n,s),JSON.parse(e)}async verifySignature(e,t,n=this._client.webhookSecret,s=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");Fo(this,Od,"m",Ed).call(this,n);const r=rl([t]).values,a=Fo(this,Od,"m",Rd).call(this,r,"webhook-signature"),i=Fo(this,Od,"m",Rd).call(this,r,"webhook-timestamp"),o=Fo(this,Od,"m",Rd).call(this,r,"webhook-id"),u=parseInt(i,10);if(isNaN(u))throw new T("Invalid webhook timestamp format");const c=Math.floor(Date.now()/1e3);if(c-u>s)throw new T("Webhook timestamp is too old");if(u>c+s)throw new T("Webhook timestamp is too new");const l=a.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),d=n.startsWith("whsec_")?jd.from(n.replace("whsec_",""),"base64"):jd.from(n,"utf-8"),p=o?`${o}.${i}.${e}`:`${i}.${e}`,h=await crypto.subtle.importKey("raw",d,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const e of l)try{const t=jd.from(e,"base64");if(await crypto.subtle.verify("HMAC",h,t,(new TextEncoder).encode(p)))return}catch{continue}throw new T("The given webhook signature does not match the expected signature")}}Od=new WeakSet,Ed=function(e){if("string"!=typeof e||0===e.length)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},Rd=function(e,t){if(!e)throw new Error("Headers are required");const n=e.get(t);if(null==n)throw new Error(`Missing required header: ${t}`);return n};class Ld{constructor({baseURL:e=yl("OPENAI_BASE_URL"),apiKey:t=yl("OPENAI_API_KEY"),organization:n=yl("OPENAI_ORG_ID")??null,project:s=yl("OPENAI_PROJECT_ID")??null,webhookSecret:r=yl("OPENAI_WEBHOOK_SECRET")??null,...a}={}){if(Pd.add(this),$d.set(this,void 0),this.completions=new Ql(this),this.chat=new tl(this),this.embeddings=new sd(this),this.files=new od(this),this.images=new _d(this),this.audio=new ul(this),this.moderations=new wd(this),this.models=new vd(this),this.fineTuning=new md(this),this.graders=new yd(this),this.vectorStores=new Cd(this),this.webhooks=new Md(this),this.beta=new Yl(this),this.batches=new cl(this),this.uploads=new Td(this),this.responses=new Sd(this),this.evals=new id(this),this.containers=new nd(this),void 0===t)throw new l("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:n,project:s,webhookSecret:r,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new l("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=i.baseURL,this.timeout=i.timeout??Nd.DEFAULT_TIMEOUT,this.logger=i.logger??console;const o="warn";this.logLevel=o,this.logLevel=Tu(i.logLevel,"ClientOptions.logLevel",this)??Tu(yl("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=i.fetchOptions,this.maxRetries=i.maxRetries??2,this.fetch=i.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),Zo(this,$d,tu,"f"),this._options=i,this.apiKey=t,this.organization=n,this.project=s,this.webhookSecret=r}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return rl([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let n=e;const s=function(e=pu){if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||pu.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=nu;if(void 0!==e.format){if(!au(ru,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const s=ru[n];let r,a=pu.filter;if(("function"==typeof e.filter||qo(e.filter))&&(a=e.filter),r=e.arrayFormat&&e.arrayFormat in cu?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":pu.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=void 0===e.allowDots?1==!!e.encodeDotInKeys||pu.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:pu.addQueryPrefix,allowDots:i,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:pu.allowEmptyArrays,arrayFormat:r,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:pu.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?pu.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:pu.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:pu.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:pu.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:pu.encodeValuesOnly,filter:a,format:n,formatter:s,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:pu.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:pu.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:pu.strictNullHandling}}(t);let r,a;"function"==typeof s.filter?(a=s.filter,n=a("",n)):qo(s.filter)&&(a=s.filter,r=a);const i=[];if("object"!=typeof n||null===n)return"";const o=cu[s.arrayFormat],u="comma"===o&&s.commaRoundTrip;r||(r=Object.keys(n)),s.sort&&r.sort(s.sort);const c=new WeakMap;for(let e=0;e<r.length;++e){const t=r[e];s.skipNulls&&null===n[t]||lu(i,fu(n[t],t,o,u,s.allowEmptyArrays,s.strictNullHandling,s.skipNulls,s.encodeDotInKeys,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,c))}const l=i.join(s.delimiter);let d=!0===s.addQueryPrefix?"?":"";return s.charsetSentinel&&("iso-8859-1"===s.charset?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),l.length>0?d+l:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${Go}`}defaultIdempotencyKey(){return`stainless-node-retry-${Uo()}`}makeStatusError(e,t,n,s){return d.generate(e,t,n,s)}buildURL(e,t,n){const s=!Fo(this,Pd,"m",Dd).call(this)&&n||this.baseURL,r=(e=>Bo.test(e))(e)?new URL(e):new URL(s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return function(e){if(!e)return!0;for(const t in e)return!1;return!0}(a)||(t={...a,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(n=>({method:e,path:t,...n})))}request(e,t=null){return new Zu(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){const s=await e,r=s.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(s);const{req:a,url:i,timeout:o}=await this.buildRequest(s,{retryCount:r-t});await this.prepareRequest(a,{url:i,options:s});const l="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),d=void 0===n?"":`, retryOf: ${n}`,m=Date.now();if(Eu(this).debug(`[${l}] sending request`,Ru({retryOfRequestLogID:n,method:s.method,url:i,options:s,headers:a.headers})),s.signal?.aborted)throw new p;const g=new AbortController,y=await this.fetchWithTimeout(i,a,o,g).catch(c),_=Date.now();if(y instanceof Error){const e=`retrying, ${t} attempts remaining`;if(s.signal?.aborted)throw new p;const r=u(y)||/timed? ?out/i.test(String(y)+("cause"in y?String(y.cause):""));if(t)return Eu(this).info(`[${l}] connection ${r?"timed out":"failed"} - ${e}`),Eu(this).debug(`[${l}] connection ${r?"timed out":"failed"} (${e})`,Ru({retryOfRequestLogID:n,url:i,durationMs:_-m,message:y.message})),this.retryRequest(s,t,n??l);if(Eu(this).info(`[${l}] connection ${r?"timed out":"failed"} - error; no more retries left`),Eu(this).debug(`[${l}] connection ${r?"timed out":"failed"} (error; no more retries left)`,Ru({retryOfRequestLogID:n,url:i,durationMs:_-m,message:y.message})),r)throw new f;throw new h({cause:y})}const v=`[${l}${d}${[...y.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join("")}] ${a.method} ${i} ${y.ok?"succeeded":"failed"} with status ${y.status} in ${_-m}ms`;if(!y.ok){const e=await this.shouldRetry(y);if(t&&e){const e=`retrying, ${t} attempts remaining`;return await async function(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await(e[Symbol.asyncIterator]().return?.());const t=e.getReader(),n=t.cancel();t.releaseLock(),await n}(y.body),Eu(this).info(`${v} - ${e}`),Eu(this).debug(`[${l}] response error (${e})`,Ru({retryOfRequestLogID:n,url:y.url,status:y.status,headers:y.headers,durationMs:_-m})),this.retryRequest(s,t,n??l,y.headers)}const r=e?"error; no more retries left":"error; not retryable";Eu(this).info(`${v} - ${r}`);const a=await y.text().catch(e=>c(e).message),i=(e=>{try{return JSON.parse(e)}catch(e){return}})(a),o=i?void 0:a;throw Eu(this).debug(`[${l}] response error (${r})`,Ru({retryOfRequestLogID:n,url:y.url,status:y.status,headers:y.headers,message:o,durationMs:Date.now()-m})),this.makeStatusError(y.status,i,o,y.headers)}return Eu(this).info(v),Eu(this).debug(`[${l}] response start`,Ru({retryOfRequestLogID:n,url:y.url,status:y.status,headers:y.headers,durationMs:_-m})),{response:y,options:s,controller:g,requestLogID:l,retryOfRequestLogID:n,startTime:m}}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}requestAPIList(e,t){const n=this.makeRequest(t,null,void 0);return new Uu(this,n,e)}async fetchWithTimeout(e,t,n,s){const{signal:r,method:a,...i}=t||{};r&&r.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),n),u=globalThis.ReadableStream&&i.body instanceof globalThis.ReadableStream||"object"==typeof i.body&&null!==i.body&&Symbol.asyncIterator in i.body,c={signal:s.signal,...u?{duplex:"half"}:{},method:"GET",...i};a&&(c.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,n,s){let r;const a=s?.get("retry-after-ms");if(a){const e=parseFloat(a);Number.isNaN(e)||(r=e)}const i=s?.get("retry-after");if(i&&!r){const e=parseFloat(i);r=Number.isNaN(e)?Date.parse(i)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){const n=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,n)}return await Wo(r),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){const n={...e},{method:s,path:r,query:a,defaultBaseURL:i}=n,o=this.buildURL(r,a,i);"timeout"in n&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new l(`${e} must be an integer`);if(t<0)throw new l(`${e} must be a positive integer`)})("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const{bodyHeaders:u,body:c}=this.buildBody({options:n});return{req:{method:s,headers:await this.buildHeaders({options:e,method:s,bodyHeaders:u,retryCount:t}),...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...n.fetchOptions??{}},url:o,timeout:n.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:s}){let r={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);const a=rl([r,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...Xo??(Xo=Ko()),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=rl([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&n.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:Qo(e)}:Fo(this,$d,"f").call(this,{body:e,headers:n})}}Nd=Ld,$d=new WeakMap,Pd=new WeakSet,Dd=function(){return"https://api.openai.com/v1"!==this.baseURL},Ld.OpenAI=Nd,Ld.DEFAULT_TIMEOUT=6e5,Ld.OpenAIError=l,Ld.APIError=d,Ld.APIConnectionError=h,Ld.APIConnectionTimeoutError=f,Ld.APIUserAbortError=p,Ld.NotFoundError=_,Ld.ConflictError=v,Ld.RateLimitError=b,Ld.BadRequestError=m,Ld.AuthenticationError=g,Ld.InternalServerError=x,Ld.PermissionDeniedError=y,Ld.UnprocessableEntityError=w,Ld.InvalidWebhookSignatureError=T,Ld.toFile=async function(e,t,n){if(zu(),(e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&Yu(e))(e=await e))return e instanceof File?e:Ju([await e.arrayBuffer()],e.name);if((e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob)(e)){const s=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),Ju(await Qu(s),t,n)}const s=await Qu(e);if(t||(t=Wu(e)),!n?.type){const e=s.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(n={...n,type:e})}return Ju(s,t,n)},Ld.Completions=Ql,Ld.Chat=tl,Ld.Embeddings=sd,Ld.Files=od,Ld.Images=_d,Ld.Audio=ul,Ld.Moderations=wd,Ld.Models=vd,Ld.FineTuning=md,Ld.Graders=yd,Ld.VectorStores=Cd,Ld.Webhooks=Md,Ld.Beta=Yl,Ld.Batches=cl,Ld.Uploads=Td,Ld.Responses=Sd,Ld.Evals=id,Ld.Containers=nd,new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations","/batches","/images/edits"]);let Zd,Fd,Ud,Bd="responses";function qd(e){Ud=e}function zd(e){Bd=e}function Jd(e){Zd=e}function Wd(e){Fd=e}const Gd={"User-Agent":"Agents/JavaScript 0.0.16"},Kd=pn("openai-agents:openai"),Hd=dr(["in_progress","completed","searching","failed"]).default("failed"),Vd=dr(["in_progress","completed","searching","failed","incomplete"]).default("failed"),Xd=dr(["in_progress","completed","interpreting"]).default("in_progress"),Yd=dr(["in_progress","completed","generating","failed"]).default("failed");function Qd(e={}){const t={type:"web_search",name:e.name??"web_search_preview",user_location:e.userLocation,search_context_size:e.searchContextSize??"medium"};return{type:"hosted_tool",name:e.name??"web_search_preview",providerData:t}}function ep(e,t={}){const n=Array.isArray(e)?e:[e],s={type:"file_search",name:t.name??"file_search",vector_store_ids:n,max_num_results:t.maxNumResults,include_search_results:t.includeSearchResults,ranking_options:t.rankingOptions,filters:t.filters};return{type:"hosted_tool",name:t.name??"file_search",providerData:s}}function tp(e={}){const t={type:"code_interpreter",name:e.name??"code_interpreter",container:e.container??{type:"auto"}};return{type:"hosted_tool",name:e.name??"code_interpreter",providerData:t}}function np(e={}){const t={type:"image_generation",name:e.name??"image_generation",background:e.background,input_fidelity:e.inputFidelity,input_image_mask:e.inputImageMask,model:e.model,moderation:e.moderation,output_compression:e.outputCompression,output_format:e.outputFormat,partial_images:e.partialImages,quality:e.quality,size:e.size};return{type:"hosted_tool",name:e.name??"image_generation",providerData:t}}function sp(e){if(!e||"object"!=typeof e||Array.isArray(e))return e;const t={};for(const[n,s]of Object.entries(e))t[n.replace(/([A-Z])/g,"_$1").toLowerCase()]=sp(s);return t}const rp=dr(["file_search","web_search_preview","computer_use_preview","code_interpreter","image_generation","mcp"]),ap=dr(["auto","required","none"]);function ip(e){if("function"===e.type)return{tool:{type:"function",name:e.name,description:e.description,parameters:e.parameters,strict:e.strict},include:void 0};if("computer"===e.type)return{tool:{type:"computer_use_preview",environment:e.environment,display_width:e.dimensions[0],display_height:e.dimensions[1]},include:void 0};if("hosted_tool"===e.type){if("web_search"===e.providerData?.type)return{tool:{type:"web_search_preview",user_location:e.providerData.user_location,search_context_size:e.providerData.search_context_size},include:void 0};if("file_search"===e.providerData?.type)return{tool:{type:"file_search",vector_store_ids:e.providerData.vector_store_ids||("string"==typeof e.providerData.vector_store_id?[e.providerData.vector_store_id]:e.providerData.vector_store_id),max_num_results:e.providerData.max_num_results,ranking_options:e.providerData.ranking_options,filters:e.providerData.filters},include:e.providerData.include_search_results?["file_search_call.results"]:void 0};if("code_interpreter"===e.providerData?.type)return{tool:{type:"code_interpreter",container:e.providerData.container},include:void 0};if("image_generation"===e.providerData?.type)return{tool:{type:"image_generation",background:e.providerData.background,input_fidelity:e.providerData.input_fidelity,input_image_mask:e.providerData.input_image_mask,model:e.providerData.model,moderation:e.providerData.moderation,output_compression:e.providerData.output_compression,output_format:e.providerData.output_format,partial_images:e.providerData.partial_images,quality:e.providerData.quality,size:e.providerData.size},include:void 0};if("mcp"===e.providerData?.type)return{tool:{type:"mcp",server_label:e.providerData.server_label,server_url:e.providerData.server_url,allowed_tools:e.providerData.allowed_tools,headers:e.providerData.headers,require_approval:(t=e.providerData.require_approval,"never"===t||void 0===t?"never":"always"===t?"always":{never:{tool_names:t.never?.tool_names},always:{tool_names:t.always?.tool_names}})},include:void 0};if(e.providerData)return{tool:e.providerData,include:void 0}}var t;throw new Error(`Unsupported tool type: ${JSON.stringify(e)}`)}function op(e){return{name:e.toolName,description:e.toolDescription,parameters:e.inputJsonSchema,strict:e.strictJsonSchema,type:"function"}}function up(e){if("input_text"===e.type)return{type:"input_text",text:e.text,...sp(e.providerData)};if("input_image"===e.type){const t={type:"input_image",detail:"auto"};return"string"==typeof e.image?t.image_url=e.image:t.file_id=e.image.id,{...t,...sp(e.providerData)}}if("input_file"===e.type){const t={type:"input_file"};if("string"==typeof e.file)if(e.file.startsWith("data:"))t.file_data=e.file;else{if(!e.file.startsWith("https://"))throw new Vt("Unsupported string data for file input. If you're trying to pass an uploaded file's ID, use an object with the ID property instead.");t.file_url=e.file}else"id"in e.file?t.file_id=e.file.id:"url"in e.file&&(t.file_url=e.file.url);return{...t,...sp(e.providerData)}}throw new Vt(`Unsupported input content type: ${JSON.stringify(e)}`)}function cp(e){if("output_text"===e.type)return{type:"output_text",text:e.text,annotations:[],...sp(e.providerData)};if("refusal"===e.type)return{type:"refusal",refusal:e.refusal,...sp(e.providerData)};throw new Vt(`Unsupported output content type: ${JSON.stringify(e)}`)}function lp(e){return{type:"computer_screenshot",image_url:e.output.data}}function dp(e){if("output_text"===e.type){const{type:t,text:n,...s}=e;return{type:t,text:n,...s}}if("refusal"===e.type){const{type:t,refusal:n,...s}=e;return{type:t,refusal:n,...s}}throw new Error(`Unsupported message content type: ${JSON.stringify(e)}`)}function pp(e){return e.map(e=>{if("message"===e.type){const{id:t,type:n,role:s,content:r,status:a,...i}=e;return{id:t,type:n,role:s,content:r.map(dp),status:a,providerData:i}}if("file_search_call"===e.type||"web_search_call"===e.type||"image_generation_call"===e.type||"code_interpreter_call"===e.type){const{status:t,...n}=e;let s;return"result"in n&&null!==n.result&&(s=n.result,delete n.result),{type:"hosted_tool_call",id:e.id,name:e.type,status:t,output:s,providerData:n}}if("function_call"===e.type){const{call_id:t,name:n,status:s,arguments:r,...a}=e;return{type:"function_call",id:e.id,callId:t,name:n,status:s,arguments:r,providerData:a}}if("computer_call"===e.type){const{call_id:t,status:n,action:s,...r}=e;return{type:"computer_call",id:e.id,callId:t,status:n,action:s,providerData:r}}if("mcp_list_tools"===e.type){const{...t}=e;return{type:"hosted_tool_call",id:e.id,name:e.type,status:"completed",output:void 0,providerData:t}}if("mcp_approval_request"===e.type){const{...t}=e;return{type:"hosted_tool_call",id:e.id,name:"mcp_approval_request",status:"completed",output:void 0,providerData:t}}if("mcp_call"===e.type){const{output:t,...n}=e;return{type:"hosted_tool_call",id:e.id,name:e.type,status:"completed",output:t||void 0,providerData:n}}if("reasoning"===e.type){const{summary:t,...n}=e;return{type:"reasoning",id:e.id,content:t.map(e=>{const{text:t,...n}=e;return{type:"input_text",text:t,providerData:n}}),providerData:n}}return{type:"unknown",providerData:e}})}class hp{#B;#q;constructor(e,t){this.#B=e,this.#q=t}async#z(e,t){const n=function(e){return"string"==typeof e?[{role:"user",content:e}]:e.map(e=>{if(function(e){return"message"===e.type||void 0===e.type&&"string"==typeof e.role}(e))return function(e){if("system"===e.role)return{id:e.id,role:"system",content:e.content,...sp(e.providerData)};if("user"===e.role)return"string"==typeof e.content?{id:e.id,role:"user",content:e.content,...sp(e.providerData)}:{id:e.id,role:"user",content:e.content.map(up),...sp(e.providerData)};if("assistant"===e.role)return{type:"message",id:e.id,role:"assistant",content:e.content.map(cp),status:e.status,...sp(e.providerData)};throw new Vt(`Unsupported item ${JSON.stringify(e)}`)}(e);if("function_call"===e.type)return{id:e.id,type:"function_call",name:e.name,call_id:e.callId,arguments:e.arguments,status:e.status,...sp(e.providerData)};if("function_call_result"===e.type){if("text"!==e.output.type)throw new Vt(`Unsupported tool result type: ${JSON.stringify(e.output)}`);return{type:"function_call_output",id:e.id,call_id:e.callId,output:e.output.text,status:e.status,...sp(e.providerData)}}if("reasoning"===e.type)return{id:e.id,type:"reasoning",summary:e.content.map(e=>({type:"summary_text",text:e.text,...sp(e.providerData)})),encrypted_content:e.providerData?.encryptedContent,...sp(e.providerData)};if("computer_call"===e.type)return{type:"computer_call",call_id:e.callId,id:e.id,action:e.action,status:e.status,pending_safety_checks:[],...sp(e.providerData)};if("computer_call_result"===e.type)return{type:"computer_call_output",id:e.id,call_id:e.callId,output:lp(e),status:e.providerData?.status,acknowledged_safety_checks:e.providerData?.acknowledgedSafetyChecks,...sp(e.providerData)};if("hosted_tool_call"===e.type){if("web_search_call"===e.providerData?.type||"web_search"===e.providerData?.type)return{...sp(e.providerData),type:"web_search_call",id:e.id,status:Hd.parse(e.status??"failed")};if("file_search_call"===e.providerData?.type||"file_search"===e.providerData?.type)return{...sp(e.providerData),type:"file_search_call",id:e.id,status:Vd.parse(e.status??"failed"),queries:e.providerData?.queries??[],results:e.providerData?.results};if("code_interpreter_call"===e.providerData?.type||"code_interpreter"===e.providerData?.type)return{...sp(e.providerData),type:"code_interpreter_call",id:e.id,code:e.providerData?.code??"",outputs:e.providerData?.outputs??e.providerData?.results??[],status:Xd.parse(e.status??"failed"),container_id:e.providerData?.container_id};if("image_generation_call"===e.providerData?.type||"image_generation"===e.providerData?.type)return{...sp(e.providerData),type:"image_generation_call",id:e.id,result:e.providerData?.result??null,status:Yd.parse(e.status??"failed")};if("mcp_list_tools"===e.providerData?.type||"mcp_list_tools"===e.name){const t=e.providerData;return{...sp(e.providerData),type:"mcp_list_tools",id:e.id,tools:sp(t.tools),server_label:t.server_label,error:t.error}}if("mcp_approval_request"===e.providerData?.type||"mcp_approval_request"===e.name){const t=e.providerData;return{...sp(e.providerData),type:"mcp_approval_request",id:t.id??e.id,name:t.name,arguments:t.arguments,server_label:t.server_label}}if("mcp_approval_response"===e.providerData?.type||"mcp_approval_response"===e.name){const t=e.providerData;return{...sp(t),type:"mcp_approval_response",id:t.id,approve:t.approve,approval_request_id:t.approval_request_id,reason:t.reason}}if("mcp_call"===e.providerData?.type||"mcp_call"===e.name){const t=e.providerData;return{...sp(t),type:"mcp_call",id:t.id??e.id,name:t.name,arguments:t.arguments,server_label:t.server_label,error:t.error}}throw new Vt(`Unsupported built-in tool call type: ${JSON.stringify(e)}`)}if("unknown"===e.type)return{...sp(e.providerData),id:e.id};const t=e;throw new Vt(`Unsupported item ${JSON.stringify(t)}`)})}(e.input),{tools:s,include:r}=function(e,t){const n=[],s=[];for(const t of e){const{tool:e,include:r}=ip(t);if(n.push(e),r&&r.length>0)for(const e of r)s.push(e)}return{tools:[...n,...t.map(op)],include:s}}(e.tools,e.handoffs),a=function(e){if(void 0===e)return;const t=ap.safeParse(e);if(t.success)return t.data;const n=rp.safeParse(e);return n.success?{type:n.data}:{type:"function",name:e}}(e.modelSettings.toolChoice),i=function(e){if("text"!==e)return{format:e}}(e.outputType),o=function(e){if(!e)return;const t={};for(const[n,s]of Object.entries(e.variables??{}))"string"==typeof s?t[n]=s:"object"==typeof s&&(t[n]=up(s));return{id:e.promptId,version:e.version,variables:t}}(e.prompt);let u;if("boolean"==typeof e.modelSettings.parallelToolCalls){if(e.modelSettings.parallelToolCalls&&0===s.length)throw new Error("Parallel tool calls are not supported without tools");u=e.modelSettings.parallelToolCalls}const c={instructions:e.systemInstructions,model:this.#q,input:n,include:r,tools:s,previous_response_id:e.previousResponseId,prompt:o,temperature:e.modelSettings.temperature,top_p:e.modelSettings.topP,truncation:e.modelSettings.truncation,max_output_tokens:e.modelSettings.maxTokens,tool_choice:a,parallel_tool_calls:u,stream:t,text:i,store:e.modelSettings.store,...e.modelSettings.providerData};Kd.dontLogModelData?Kd.debug("Calling LLM"):Kd.debug(`Calling LLM. Request data: ${JSON.stringify(c,null,2)}`);const l=await this.#B.responses.create(c,{headers:Gd,signal:e.signal});return Kd.dontLogModelData?Kd.debug("Response received"):Kd.debug(`Response received: ${JSON.stringify(l,null,2)}`),l}async getResponse(e){const t=await la(async t=>{const n=await this.#z(e,!1);return e.tracing&&(t.spanData.response_id=n.id,t.spanData._input=e.input,t.spanData._response=n),n});return{usage:new Ei({inputTokens:t.usage?.input_tokens??0,outputTokens:t.usage?.output_tokens??0,totalTokens:t.usage?.total_tokens??0,inputTokensDetails:{...t.usage?.input_tokens_details},outputTokensDetails:{...t.usage?.output_tokens_details}}),output:pp(t.output),responseId:t.id,providerData:t}}async*getStreamedResponse(e){const t=e.tracing?ca():void 0;try{t&&(t.start(),Fr(t),!0===e.tracing&&(t.spanData._input=e.input));const n=await this.#z(e,!0);let s;for await(const e of n){if("response.created"===e.type)yield{type:"response_started",providerData:{...e}};else if("response.completed"===e.type){s=e.response;const{response:t,...n}=e,{output:r,usage:a,id:i,...o}=t;yield{type:"response_done",response:{id:i,output:pp(r),usage:{inputTokens:a?.input_tokens??0,outputTokens:a?.output_tokens??0,totalTokens:a?.total_tokens??0,inputTokensDetails:{...a?.input_tokens_details},outputTokensDetails:{...a?.output_tokens_details}},providerData:o},providerData:n},yield{type:"model",event:e}}else if("response.output_text.delta"===e.type){const{delta:t,...n}=e;yield{type:"output_text_delta",delta:t,providerData:n}}yield{type:"model",event:e}}e.tracing&&t&&s&&(t.spanData.response_id=s.id,t.spanData._response=s)}catch(n){throw t&&t.setError({message:"Error streaming response",data:{error:e.tracing?String(n):n instanceof Error?n.name:void 0}}),n}finally{t&&(t.end(),Ur())}}}function fp(e){if(null!=e&&null!=e)return"auto"===e||"required"===e||"none"===e?e:{type:"function",function:{name:e}}}function mp(e){if("string"==typeof e)return e;const t=[];for(const n of e)if("output_text"===n.type)t.push({type:"text",text:n.text,...n.providerData});else{if("refusal"!==n.type){if("audio"===n.type||"image"===n.type)continue;{const e=n;throw new Error(`Unknown content: ${JSON.stringify(e)}`)}}t.push({type:"refusal",refusal:n.refusal,...n.providerData})}return t}function gp(e){if("string"==typeof e)return e;const t=[];for(const n of e)if("input_text"===n.type)t.push({type:"text",text:n.text,...n.providerData});else if("input_image"===n.type){if("string"!=typeof n.image)throw new Error(`Only image URLs are supported for input_image: ${JSON.stringify(n)}`);const{image_url:e,...s}=n.providerData||{};t.push({type:"image_url",image_url:{url:n.image,...e},...s})}else{if("input_file"===n.type)throw new Error(`File uploads are not supported for chat completions: ${JSON.stringify(n)}`);if("audio"!==n.type){const e=n;throw new Error(`Unknown content: ${JSON.stringify(e)}`)}{const{input_audio:e,...s}=n.providerData||{};t.push({type:"input_audio",input_audio:{data:n.audio,...e},...s})}}return t}function yp(e){return"message"===e.type||void 0===e.type&&"string"==typeof e.role}function _p(e){if("function"===e.type)return{type:"function",function:{name:e.name,description:e.description||"",parameters:e.parameters,strict:e.strict}};throw new Error(`Hosted tools are not supported with the ChatCompletions API. Got tool type: ${e.type}, tool: ${JSON.stringify(e)}`)}function vp(e){return{type:"function",function:{name:e.toolName,description:e.toolDescription||"",parameters:e.inputJsonSchema}}}const wp="FAKE_ID";class bp{#B;#q;constructor(e,t){this.#B=e,this.#q=t}async getResponse(e){const t=await _a(async t=>{t.spanData.model=this.#q,t.spanData.model_config=e.modelSettings?{temperature:e.modelSettings.temperature,top_p:e.modelSettings.topP,frequency_penalty:e.modelSettings.frequencyPenalty,presence_penalty:e.modelSettings.presencePenalty}:{base_url:this.#B.baseURL};const n=await this.#z(e,t,!1);return t&&!0===e.tracing&&(t.spanData.output=[n]),n}),n=[];if(t.choices&&t.choices[0]){const e=t.choices[0].message;if(function(e){return"reasoning"in e&&"string"==typeof e.reasoning&&""!==e.reasoning}(e)&&n.push({type:"reasoning",content:[],rawContent:[{type:"reasoning_text",text:e.reasoning}]}),void 0===e.content||null===e.content||e.tool_calls&&""===e.content){if(e.refusal){const{refusal:s,...r}=e;n.push({id:t.id,type:"message",role:"assistant",content:[{type:"refusal",refusal:s||"",providerData:r}],status:"completed"})}else if(e.audio){const{data:s,...r}=e.audio;n.push({id:t.id,type:"message",role:"assistant",content:[{type:"audio",audio:s,providerData:r}],status:"completed"})}else if(e.tool_calls)for(const s of e.tool_calls){const{id:e,...r}=s,{arguments:a,name:i,...o}=s.function;n.push({id:t.id,type:"function_call",arguments:a,name:i,callId:e,status:"completed",providerData:{...r,...o}})}}else{const{content:s,...r}=e;n.push({id:t.id,type:"message",role:"assistant",content:[{type:"output_text",text:s||"",providerData:r}],status:"completed"})}}var s;return{usage:t.usage?new Ei((s=t.usage,{requests:1,input_tokens:s.prompt_tokens,output_tokens:s.completion_tokens,total_tokens:s.total_tokens,input_tokens_details:{cached_tokens:s.prompt_tokens_details?.cached_tokens||0},output_tokens_details:{reasoning_tokens:s.completion_tokens_details?.reasoning_tokens||0}})):new Ei,output:n,responseId:t.id,providerData:t}}async*getStreamedResponse(e){const t=e.tracing?ya():void 0;try{t&&(t.start(),Fr(t));const n=await this.#z(e,t,!0),s={id:wp,created:Math.floor(Date.now()/1e3),model:this.#q,object:"chat.completion",choices:[],usage:{prompt_tokens:0,completion_tokens:0,total_tokens:0}};for await(const e of async function*(e,t){let n;const s={started:!1,text_content_index_and_output:null,refusal_content_index_and_output:null,function_calls:{},reasoning:""};for await(const e of t){if(s.started||(s.started=!0,yield{type:"response_started",providerData:{...e}}),yield{type:"model",event:e},n=e.usage||void 0,!e.choices?.[0]?.delta)continue;const t=e.choices[0].delta;if(t.content&&(s.text_content_index_and_output||(s.text_content_index_and_output=[s.refusal_content_index_and_output?1:0,{text:"",type:"output_text",providerData:{annotations:[]}}]),yield{type:"output_text_delta",delta:t.content,providerData:{...e}},s.text_content_index_and_output[1].text+=t.content),"reasoning"in t&&t.reasoning&&"string"==typeof t.reasoning&&(s.reasoning+=t.reasoning),"refusal"in t&&t.refusal&&(s.refusal_content_index_and_output||(s.refusal_content_index_and_output=[s.text_content_index_and_output?1:0,{refusal:"",type:"refusal"}]),s.refusal_content_index_and_output[1].refusal+=t.refusal),t.tool_calls)for(const e of t.tool_calls){e.index in s.function_calls||(s.function_calls[e.index]={id:wp,arguments:"",name:"",type:"function_call",callId:""});const t=e.function;s.function_calls[e.index].arguments+=t?.arguments||"",s.function_calls[e.index].name+=t?.name||"",s.function_calls[e.index].callId+=e.id||""}}const r=[];if(s.reasoning&&r.push({type:"reasoning",content:[],rawContent:[{type:"reasoning_text",text:s.reasoning}]}),s.text_content_index_and_output||s.refusal_content_index_and_output){const e={id:wp,content:[],role:"assistant",type:"message",status:"completed"};s.text_content_index_and_output&&e.content.push(s.text_content_index_and_output[1]),s.refusal_content_index_and_output&&e.content.push(s.refusal_content_index_and_output[1]),r.push(e)}for(const e of Object.values(s.function_calls))r.push(e);const a={type:"response_done",response:{id:e.id,usage:{inputTokens:n?.prompt_tokens??0,outputTokens:n?.completion_tokens??0,totalTokens:n?.total_tokens??0,inputTokensDetails:{cached_tokens:n?.prompt_tokens_details?.cached_tokens??0},outputTokensDetails:{reasoning_tokens:n?.completion_tokens_details?.reasoning_tokens??0}},output:r}};yield a}(s,n))yield e;t&&s&&!0===e.tracing&&(t.spanData.output=[s])}catch(n){throw t&&t.setError({message:"Error streaming response",data:{error:!0===e.tracing?String(n):n instanceof Error?n.name:void 0}}),n}finally{t&&(t.end(),Ur())}}async#z(e,t,n){const s=[];if(e.tools)for(const t of e.tools)s.push(_p(t));if(e.handoffs)for(const t of e.handoffs)s.push(vp(t));const r="text"===(a=e.outputType)?{type:"text"}:"json_schema"===a.type?{type:"json_schema",json_schema:{name:a.name,strict:a.strict,schema:a.schema}}:{type:"json_object"};var a;let i;if("boolean"==typeof e.modelSettings.parallelToolCalls){if(e.modelSettings.parallelToolCalls&&0===s.length)throw new Error("Parallel tool calls are not supported without tools");i=e.modelSettings.parallelToolCalls}const o=function(e){if("string"==typeof e)return[{role:"user",content:e}];const t=[];let n=null;const s=()=>{n&&(n.tool_calls&&0!==n.tool_calls.length||delete n.tool_calls,t.push(n),n=null)},r=()=>(n||(n={role:"assistant",tool_calls:[]}),n);for(const n of e)if(yp(n)){const{content:e,role:r,providerData:a}=n;if(s(),"assistant"===r){const n={role:"assistant",content:mp(e),...a},s=e.find(e=>"audio"===e.type);s&&(n.audio={id:"",...s.providerData}),t.push(n)}else"user"===r?t.push({role:r,content:gp(e),...a}):"system"===r&&t.push({role:"system",content:e,...a})}else{if("reasoning"===n.type){r().reasoning=n.rawContent?.[0]?.text;continue}if("hosted_tool_call"===n.type){if("file_search_call"===n.name){const e=r(),t=e.tool_calls??[],s=n,{function:a,...i}=s.providerData??{},{arguments:o,...u}=a??{};t.push({id:s.id||"",type:"function",function:{name:"file_search_call",arguments:JSON.stringify({queries:s.providerData?.queries??[],status:s.status,...o}),...u},...i}),e.tool_calls=t;continue}throw new Vt("Hosted tool calls are not supported for chat completions. Got item: "+JSON.stringify(n))}if("computer_call"===n.type||"computer_call_result"===n.type)throw new Vt("Computer use calls are not supported for chat completions. Got item: "+JSON.stringify(n));if("function_call"===n.type){const e=r(),t=e.tool_calls??[],s=n;t.push({id:s.callId,type:"function",function:{name:s.name,arguments:s.arguments??"{}"}}),e.tool_calls=t}else if("function_call_result"===n.type){s();const e=n;if("text"!==e.output.type)throw new Vt("Only text output is supported for chat completions. Got item: "+JSON.stringify(n));t.push({role:"tool",tool_call_id:e.callId,content:e.output.text,...e.providerData})}else{if("unknown"!==n.type){const e=n;throw new Error(`Unknown item type: ${JSON.stringify(e)}`)}t.push({...n.providerData})}}return s(),t}(e.input);e.systemInstructions&&o.unshift({content:e.systemInstructions,role:"system"}),t&&!0===e.tracing&&(t.spanData.input=o);const u={model:this.#q,messages:o,tools:s.length?s:void 0,temperature:e.modelSettings.temperature,top_p:e.modelSettings.topP,frequency_penalty:e.modelSettings.frequencyPenalty,presence_penalty:e.modelSettings.presencePenalty,max_tokens:e.modelSettings.maxTokens,tool_choice:fp(e.modelSettings.toolChoice),response_format:r,parallel_tool_calls:i,stream:n,store:e.modelSettings.store,...e.modelSettings.providerData};Kd.dontLogModelData?Kd.debug("Calling LLM"):Kd.debug(`Calling LLM. Request data: ${JSON.stringify(u,null,2)}`);const c=await this.#B.chat.completions.create(u,{headers:Gd,signal:e.signal});return Kd.dontLogModelData?Kd.debug("Response received"):Kd.debug(`Response received: ${JSON.stringify(c,null,2)}`),c}}class xp{#B;#J;#W;constructor(e={}){if(this.#W=e,this.#W.openAIClient){if(this.#W.apiKey)throw new Error("Cannot provide both apiKey and openAIClient");if(this.#W.baseURL)throw new Error("Cannot provide both baseURL and openAIClient");this.#B=this.#W.openAIClient}this.#J=this.#W.useResponses}#G(){return this.#B||(this.#B=Zd??new Ld({apiKey:this.#W.apiKey??Fd??{}.OPENAI_API_KEY,baseURL:this.#W.baseURL,organization:this.#W.organization,project:this.#W.project})),this.#B}async getModel(e){const t=e||"gpt-4.1";return this.#J??"responses"===Bd?new hp(this.#G(),t):new bp(this.#G(),t)}}class Sp{#W;constructor(e={}){this.#W={apiKey:e.apiKey??void 0,organization:e.organization??"",project:e.project??"",endpoint:e.endpoint??"https://api.openai.com/v1/traces/ingest",maxRetries:e.maxRetries??3,baseDelay:e.baseDelay??1e3,maxDelay:e.maxDelay??3e4}}async export(e,t){const n=this.#W.apiKey??Ud??{}.OPENAI_API_KEY;if(!n)return void Kd.error("No API key provided for OpenAI tracing exporter. Exports will be skipped");const s={data:e.map(e=>e.toJSON()).filter(e=>!!e)};let r=0,a=this.#W.baseDelay;for(;r<this.#W.maxRetries;){try{const e=await fetch(this.#W.endpoint,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`,"OpenAI-Beta":"traces=v1",...Gd},body:JSON.stringify(s),signal:t});if(e.ok)return void Kd.debug(`Exported ${s.data.length} items`);if(e.status>=400&&e.status<500)return void Kd.error(`[non-fatal] Tracing client error ${e.status}: ${await e.text()}`);Kd.warn(`[non-fatal] Tracing: server error ${e.status}, retrying.`)}catch(e){Kd.error("[non-fatal] Tracing: request failed: ",e)}if(t?.aborted)return void Kd.error("Tracing: request aborted");const e=a+.1*Math.random()*a;await new Promise(t=>setTimeout(t,e)),a=Math.min(2*a,this.#W.maxDelay),r++}Kd.error(`Tracing: failed to export traces after ${this.#W.maxRetries} attempts`)}}function kp(){const e=new Sp;Pa([new Jr(e)])}const Tp="0.0.16";function Ap(e){const t=atob(e),n=t.length,s=new Uint8Array(n);for(let e=0;e<n;e++)s[e]=t.charCodeAt(e);return s.buffer}function Ip(e){const t=String.fromCharCode(...new Uint8Array(e));return btoa(t)}function Cp(e){if(null==e||"object"!=typeof e||!("type"in e)||"string"!=typeof e.type||!e.type)return;if("message"!==e.type)return;if(!("content"in e)||!Array.isArray(e.content)||e.content.length<1)return;const t=e.content[e.content.length-1];return"type"in t&&"string"==typeof t.type?"text"===t.type?"string"==typeof t.text?t.text:void 0:"audio"===t.type&&"string"==typeof t.transcript?t.transcript:void 0:void 0}function Op(e){return"system"===e.role?e:"assistant"===e.role?{...e,content:e.content.map(e=>"audio"===e.type?{...e,audio:null}:e)}:"user"===e.role?{...e,content:e.content.map(e=>"input_audio"===e.type?{...e,audio:null}:e)}:e}function Ep(e,t,n){if("conversation.item.input_audio_transcription.completed"===t.type)return e.map(e=>{if(e.itemId===t.item_id&&"message"===e.type&&"role"in e&&"user"===e.role){const n=e.content.map(e=>"input_audio"===e.type?{...e,transcript:t.transcript}:e);return{...e,content:n,status:"completed"}}return e});const s=n||"message"!==t.type?t:Op(t),r=e.findIndex(e=>e.itemId===t.itemId);if(-1!==r)return e.map((e,t)=>t===r?s:n||"message"!==e.type?e:Op(e));if(t.previousItemId){const n=e.findIndex(e=>e.itemId===t.previousItemId);return-1!==n?[...e.slice(0,n+1),s,...e.slice(n+1)]:[...e,s]}return[...e,s]}const Rp={"User-Agent":`Agents/JavaScript ${Tp}`,"X-OpenAI-Agents-SDK":`openai-agents-sdk.${Tp}`},Pp=`openai-agents-sdk.${Tp}`;class Np extends $o{voice;constructor(e){super(e),this.voice=e.voice??"ash"}}function $p({policyHint:e,...t}){const n=Za(t),s=e??n.name;return{...n,policyHint:s,run:async e=>{const t=await n.run(e);return{...t,guardrail:{...t.guardrail,policyHint:s}}}}}const Dp=pn("openai-agents:realtime"),jp=(ar({itemId:er()}),or("role",[ar({itemId:er(),previousItemId:er().nullable().optional(),type:lr("message"),role:lr("system"),content:rr(ar({type:lr("input_text"),text:er()}))}),ar({itemId:er(),previousItemId:er().nullable().optional(),type:lr("message"),role:lr("user"),status:dr(["in_progress","completed"]),content:rr(ar({type:lr("input_text"),text:er()}).or(ar({type:lr("input_audio"),audio:er().nullable().optional(),transcript:er().nullable()})))}),ar({itemId:er(),previousItemId:er().nullable().optional(),type:lr("message"),role:lr("assistant"),status:dr(["in_progress","completed","incomplete"]),content:rr(ar({type:lr("text"),text:er()}).or(ar({type:lr("audio"),audio:er().nullable().optional(),transcript:er().nullable().optional()})))})])),Mp=ar({itemId:er(),previousItemId:er().nullable().optional(),type:lr("function_call"),status:dr(["in_progress","completed"]),arguments:er(),name:er(),output:er().nullable()}),Lp=ar({id:er().optional().nullable(),conversation_id:er().optional().nullable(),max_output_tokens:tr().or(lr("inf")).optional().nullable(),metadata:ur(er(),sr()).optional().nullable(),modalities:rr(er()).optional().nullable(),object:lr("realtime.response").optional().nullable(),output:rr(sr()).optional().nullable(),output_audio_format:er().optional().nullable(),status:dr(["completed","incomplete","failed","cancelled","in_progress"]).optional().nullable(),status_details:ur(er(),sr()).optional().nullable(),usage:ar({input_tokens:tr().optional(),input_tokens_details:ur(er(),sr()).optional().nullable(),output_tokens:tr().optional(),output_tokens_details:ur(er(),sr()).optional().nullable()}).optional().nullable(),voice:er().optional().nullable()}),Zp=ar({id:er().optional(),audio:er().nullable().optional(),text:er().nullable().optional(),transcript:er().nullable().optional(),type:ir([lr("input_text"),lr("input_audio"),lr("item_reference"),lr("text"),lr("audio")])}),Fp=ar({id:er().optional(),arguments:er().optional(),call_id:er().optional(),content:rr(Zp).optional(),name:er().optional(),object:lr("realtime.item").optional(),output:er().optional(),role:dr(["user","assistant","system"]).optional(),status:dr(["completed","incomplete","in_progress"]).optional(),type:dr(["message","function_call","function_call_output"]).optional()}),Up=ar({type:lr("conversation.created"),event_id:er(),conversation:ar({id:er().optional(),object:lr("realtime.conversation").optional()})}),Bp=ar({type:lr("conversation.item.created"),event_id:er(),item:Fp,previous_item_id:er().nullable().optional()}),qp=ar({type:lr("conversation.item.deleted"),event_id:er(),item_id:er()}),zp=ar({type:lr("conversation.item.input_audio_transcription.completed"),event_id:er(),item_id:er(),content_index:tr(),transcript:er(),logprobs:rr(sr()).nullable().optional()}),Jp=ar({type:lr("conversation.item.input_audio_transcription.delta"),event_id:er(),item_id:er(),content_index:tr().optional(),delta:er().optional(),logprobs:rr(sr()).nullable().optional()}),Wp=ar({type:lr("conversation.item.input_audio_transcription.failed"),event_id:er(),item_id:er(),content_index:tr(),error:ar({code:er().optional(),message:er().optional(),param:er().optional(),type:er().optional()})}),Gp=ar({type:lr("conversation.item.retrieved"),event_id:er(),item:Fp}),Kp=ar({type:lr("conversation.item.truncated"),event_id:er(),item_id:er(),audio_end_ms:tr(),content_index:tr()}),Hp=ar({type:lr("conversation.item.create"),item:Fp,event_id:er().optional(),previous_item_id:er().nullable().optional()}),Vp=ar({type:lr("conversation.item.delete"),item_id:er(),event_id:er().optional()}),Xp=ar({type:lr("conversation.item.retrieve"),item_id:er(),event_id:er().optional()}),Yp=ar({type:lr("conversation.item.truncate"),item_id:er(),audio_end_ms:tr(),content_index:tr(),event_id:er().optional()}),Qp=ar({type:lr("error"),event_id:er().optional(),error:sr().optional()}),eh=ar({type:lr("input_audio_buffer.cleared"),event_id:er()}),th=ar({type:lr("input_audio_buffer.append"),audio:er(),event_id:er().optional()}),nh=ar({type:lr("input_audio_buffer.clear"),event_id:er().optional()}),sh=ar({type:lr("input_audio_buffer.commit"),event_id:er().optional()}),rh=ar({type:lr("input_audio_buffer.committed"),event_id:er(),item_id:er(),previous_item_id:er().nullable().optional()}),ah=ar({type:lr("input_audio_buffer.speech_started"),event_id:er(),item_id:er(),audio_start_ms:tr()}),ih=ar({type:lr("input_audio_buffer.speech_stopped"),event_id:er(),item_id:er(),audio_end_ms:tr()}),oh=ar({type:lr("output_audio_buffer.started"),event_id:er()}).passthrough(),uh=ar({type:lr("output_audio_buffer.stopped"),event_id:er()}).passthrough(),ch=ar({type:lr("output_audio_buffer.cleared"),event_id:er()}),lh=ar({type:lr("rate_limits.updated"),event_id:er(),rate_limits:rr(ar({limit:tr().optional(),name:dr(["requests","tokens"]).optional(),remaining:tr().optional(),reset_seconds:tr().optional()}))}),dh=ar({type:lr("response.audio.delta"),event_id:er(),item_id:er(),content_index:tr(),delta:er(),output_index:tr(),response_id:er()}),ph=ar({type:lr("response.audio.done"),event_id:er(),item_id:er(),content_index:tr(),output_index:tr(),response_id:er()}),hh=ar({type:lr("response.audio_transcript.delta"),event_id:er(),item_id:er(),content_index:tr(),delta:er(),output_index:tr(),response_id:er()}),fh=ar({type:lr("response.audio_transcript.done"),event_id:er(),item_id:er(),content_index:tr(),transcript:er(),output_index:tr(),response_id:er()}),mh=ar({type:lr("response.content_part.added"),event_id:er(),item_id:er(),content_index:tr(),output_index:tr(),response_id:er(),part:ar({audio:er().optional(),text:er().optional(),transcript:er().optional(),type:dr(["text","audio"]).optional()})}),gh=ar({type:lr("response.content_part.done"),event_id:er(),item_id:er(),content_index:tr(),output_index:tr(),response_id:er(),part:ar({audio:er().optional(),text:er().optional(),transcript:er().optional(),type:dr(["text","audio"]).optional()})}),yh=ar({type:lr("response.created"),event_id:er(),response:Lp}),_h=ar({type:lr("response.done"),event_id:er(),response:Lp}),vh=ar({type:lr("response.function_call_arguments.delta"),event_id:er(),item_id:er(),call_id:er(),delta:er(),output_index:tr(),response_id:er()}),wh=ar({type:lr("response.function_call_arguments.done"),event_id:er(),item_id:er(),call_id:er(),arguments:er(),output_index:tr(),response_id:er()}),bh=ar({type:lr("response.output_item.added"),event_id:er(),item:Fp,output_index:tr(),response_id:er()}),xh=ar({type:lr("response.output_item.done"),event_id:er(),item:Fp,output_index:tr(),response_id:er()}),Sh=ar({type:lr("response.text.delta"),event_id:er(),item_id:er(),content_index:tr(),delta:er(),output_index:tr(),response_id:er()}),kh=ar({type:lr("response.text.done"),event_id:er(),item_id:er(),content_index:tr(),text:er(),output_index:tr(),response_id:er()}),Th=ar({type:lr("session.created"),event_id:er(),session:sr()}),Ah=ar({type:lr("session.updated"),event_id:er(),session:sr()}),Ih=ar({type:lr("response.cancel"),event_id:er().optional(),response_id:er().optional()}),Ch=ar({type:lr("response.create"),event_id:er().optional(),response:sr().optional()}),Oh=ar({type:lr("session.update"),event_id:er().optional(),session:sr()}),Eh=ar({type:lr("transcription_session.update"),event_id:er().optional(),session:sr()}),Rh=ar({type:lr("transcription_session.updated"),event_id:er(),session:sr()}),Ph=ar({type:er(),event_id:er().optional().nullable()}).passthrough(),Nh=or("type",[Up,Bp,qp,zp,Jp,Wp,Gp,Kp,Qp,eh,rh,ah,ih,oh,uh,ch,lh,dh,ph,hh,fh,mh,gh,yh,_h,vh,wh,bh,xh,Sh,kh,Th,Ah,Rh]);function $h(e){const t=JSON.parse(e.data.toString()),n=Nh.safeParse(t);if(!n.success){const e=Ph.safeParse(t);return e.success?{data:e.data,isGeneric:!0}:{data:null,isGeneric:!0}}return{data:n.data,isGeneric:!1}}or("type",[Hp,Vp,Xp,Yp,th,nh,sh,Ih,Ch,Oh,Eh]);const Dh="gpt-4o-realtime-preview",jh={voice:"ash",modalities:["text","audio"],inputAudioFormat:"pcm16",outputAudioFormat:"pcm16",inputAudioTranscription:{model:"gpt-4o-mini-transcribe"},turnDetection:{type:"semantic_vad"},inputAudioNoiseReduction:null,speed:1};class Mh extends Da{#q;#K;#H=null;#V=null;eventEmitter=new Ar;constructor(e={}){super(),this.#q=e.model??Dh,this.#K=e.apiKey}get currentModel(){return this.#q}set currentModel(e){this.#q=e}get _rawSessionConfig(){return this.#V??null}async _getApiKey(e){const t=e.apiKey??this.#K;return"function"==typeof t?await t():t}_onMessage(e){const{data:t,isGeneric:n}=$h(e);if(null!==t&&(this.emit("*",t),!n))if("error"===t.type?this.emit("error",{type:"error",error:t}):this.emit(t.type,t),"response.created"!==t.type){if("session.updated"===t.type&&(this.#V=t.session),"response.done"===t.type){const e=_h.safeParse(t);if(!e.success)return void Dp.error("Error parsing response done event",e.error);const n=e.data.response.usage?.input_tokens??0,s=e.data.response.usage?.output_tokens??0,r=n+s,a=new Ei({inputTokens:n,inputTokensDetails:e.data.response.usage?.input_tokens_details??{},outputTokens:s,outputTokensDetails:e.data.response.usage?.output_tokens_details??{},totalTokens:r});return this.emit("usage_update",a),void this.emit("turn_done",{type:"response_done",response:{id:e.data.response.id??"",output:e.data.response.output??[],usage:{inputTokens:n,inputTokensDetails:e.data.response.usage?.input_tokens_details??{},outputTokens:s,outputTokensDetails:e.data.response.usage?.output_tokens_details??{},totalTokens:r}}})}if("response.audio.done"!==t.type)if("conversation.item.deleted"!==t.type)if("conversation.item.input_audio_transcription.completed"!==t.type&&"conversation.item.truncated"!==t.type)if("conversation.item.input_audio_transcription.delta"!==t.type&&"response.text.delta"!==t.type&&"response.audio_transcript.delta"!==t.type&&"response.function_call_arguments.delta"!==t.type){if(("conversation.item.created"===t.type||"conversation.item.retrieved"===t.type)&&"message"===t.item.type){const e="conversation.item.created"===t.type?t.previous_item_id:null,n=jp.parse({itemId:t.item.id,previousItemId:e,type:t.item.type,role:t.item.role,content:t.item.content,status:t.item.status});return void this.emit("item_update",n)}if("response.output_item.done"===t.type||"response.output_item.added"===t.type){const e=t.item;if("function_call"===e.type&&"completed"===e.status){const t=Mp.parse({itemId:e.id,type:e.type,status:"in_progress",arguments:e.arguments,name:e.name,output:null});return this.emit("item_update",t),void this.emit("function_call",{id:e.id,type:"function_call",callId:e.call_id??"",arguments:e.arguments??"",name:e.name??""})}if("message"===e.type){const e=jp.parse({itemId:t.item.id,type:t.item.type,role:t.item.role,content:t.item.content,status:"in_progress"});return void this.emit("item_update",e)}}}else"response.audio_transcript.delta"===t.type&&this.emit("audio_transcript_delta",{type:"transcript_delta",delta:t.delta,itemId:t.item_id,responseId:t.response_id});else this.sendEvent({type:"conversation.item.retrieve",item_id:t.item_id});else this.emit("item_deleted",{itemId:t.item_id});else this.emit("audio_done")}else this.emit("turn_started",{type:"response_started",providerData:{...t}})}_onError(e){this.emit("error",{type:"error",error:e})}_onOpen(){this.emit("connected")}_onClose(){this.emit("disconnected")}sendMessage(e,t){this.sendEvent({type:"conversation.item.create",item:"string"==typeof e?{type:"message",role:"user",content:[{type:"input_text",text:e}]}:e,...t}),this.sendEvent({type:"response.create"})}_getMergedSessionConfig(e){const t={instructions:e.instructions,model:e.model??this.#q??jh.model,voice:e.voice??jh.voice,speed:e.speed??jh.speed,modalities:e.modalities??jh.modalities,input_audio_format:e.inputAudioFormat??jh.inputAudioFormat,output_audio_format:e.outputAudioFormat??jh.outputAudioFormat,input_audio_transcription:e.inputAudioTranscription??jh.inputAudioTranscription,input_audio_noise_reduction:e.inputAudioNoiseReduction??jh.inputAudioNoiseReduction,turn_detection:Mh.buildTurnDetectionConfig(e.turnDetection)??jh.turnDetection,tool_choice:e.toolChoice??jh.toolChoice,tools:e.tools?.map(e=>({...e,strict:void 0})),...e.providerData??{}};return t}static buildTurnDetectionConfig(e){if(void 0===e)return;const{type:t,createResponse:n,create_response:s,eagerness:r,interruptResponse:a,interrupt_response:i,prefixPaddingMs:o,prefix_padding_ms:u,silenceDurationMs:c,silence_duration_ms:l,threshold:d,...p}=e,h={type:t,create_response:n||s,eagerness:r,interrupt_response:a||i,prefix_padding_ms:o||u,silence_duration_ms:c||l,threshold:d,...p};return Object.keys(h).forEach(e=>{void 0===h[e]&&delete h[e]}),Object.keys(h).length>0?h:void 0}set _tracingConfig(e){this.#H=e}_updateTracingConfig(e){if(void 0===this.#H&&(this.#H=null),"auto"!==e){if("string"==typeof this.#H||"string"==typeof e)return null===e?(Dp.debug("Disabling tracing for this session. It cannot be turned on for this session from this point on."),void this.sendEvent({type:"session.update",session:{tracing:null}})):void(null!==this.#H&&"string"!=typeof this.#H?e?.group_id===this.#H?.group_id&&e?.metadata===this.#H?.metadata&&e?.workflow_name===this.#H?.workflow_name?this.sendEvent({type:"session.update",session:{tracing:e}}):Dp.warn("Mismatch in tracing config. Ignoring the new tracing config. This likely happens when you already set a tracing config on session creation. Current tracing config: %s, new tracing config: %s",JSON.stringify(this.#H),JSON.stringify(e)):this.sendEvent({type:"session.update",session:{tracing:e}}));Dp.warn("Tracing config is already set, skipping setting it again. This likely happens when you already set a tracing config on session creation.")}else this.sendEvent({type:"session.update",session:{tracing:"auto"}})}updateSessionConfig(e){const t=this._getMergedSessionConfig(e);this.sendEvent({type:"session.update",session:t})}sendFunctionCallOutput(e,t,n=!0){this.sendEvent({type:"conversation.item.create",item:{type:"function_call_output",output:t,call_id:e.callId}});try{const n=Mp.parse({itemId:e.id,previousItemId:e.previousItemId,type:"function_call",status:"completed",arguments:e.arguments,name:e.name,output:t});this.emit("item_update",n)}catch(t){Dp.error("Error parsing tool call item",t,e)}n&&this.sendEvent({type:"response.create"})}sendAudio(e,{commit:t=!1}={}){this.sendEvent({type:"input_audio_buffer.append",audio:Ip(e)}),t&&this.sendEvent({type:"input_audio_buffer.commit"})}resetHistory(e,t){const{removals:n,additions:s,updates:r}=function(e,t){return{removals:e.filter(e=>!t.some(t=>t.itemId===e.itemId)),additions:t.filter(t=>!e.some(e=>e.itemId===t.itemId)),updates:t.filter(t=>e.some(e=>e.itemId===t.itemId&&JSON.stringify(e)!==JSON.stringify(t)))}}(e,t),a=new Set(n.map(e=>e.itemId));for(const e of r)a.add(e.itemId);if(a.size>0)for(const e of a)this.sendEvent({type:"conversation.item.delete",item_id:e});const i=[...s,...r];for(const e of i)if("message"===e.type){const t={type:"message",role:e.role,content:e.content,id:e.itemId};"system"!==e.role&&e.status&&(t.status=e.status),this.sendEvent({type:"conversation.item.create",item:t})}else"function_call"===e.type&&Dp.warn("Function calls cannot be manually added or updated at the moment. Ignoring.")}}class Lh extends Mh{options;#X;#Y={status:"disconnected",peerConnection:void 0,dataChannel:void 0};#Q;#ee=!1;#te=!1;constructor(e={}){if("undefined"==typeof RTCPeerConnection)throw new Error("WebRTC is not supported in this environment");super(e),this.options=e,this.#X=e.baseUrl??"https://api.openai.com/v1/realtime",this.#Q=e.useInsecureApiKey??!1}get status(){return this.#Y.status}get connectionState(){return this.#Y}get muted(){return this.#te}async connect(e){if("connected"===this.#Y.status)return;"connecting"===this.#Y.status&&Dp.warn("Realtime connection already in progress. Please await original promise");const t=e.model??this.currentModel;this.currentModel=t;const n=e.url??this.#X,s=await this._getApiKey(e),r="string"==typeof s&&s.startsWith("ek_");if(!this.#Q&&!r)throw new Vt("Using the WebRTC connection in a browser environment requires an insecure API key. Please use a WebSocket connection instead or set the useInsecureApiKey option to true.");return new Promise(async(t,r)=>{try{const a={...e.initialSessionConfig||{},model:this.currentModel},i=new URL(n);let o=new RTCPeerConnection;const u=o.createDataChannel("oai-events");this.#Y={status:"connecting",peerConnection:o,dataChannel:u},this.emit("connection_change",this.#Y.status),u.addEventListener("open",()=>{this.#Y={status:"connected",peerConnection:o,dataChannel:u},this.updateSessionConfig(a),this.emit("connection_change",this.#Y.status),this._onOpen(),t()}),u.addEventListener("error",e=>{this.close(),this._onError(e),r(e)}),u.addEventListener("message",e=>{this._onMessage(e);const{data:t,isGeneric:n}=$h(e);t&&!n&&("response.created"===t.type?this.#ee=!0:"response.done"===t.type&&(this.#ee=!1),"session.created"===t.type&&(this._tracingConfig=t.session.tracing,this._updateTracingConfig(a.tracing??"auto")))});const c=this.options.audioElement??document.createElement("audio");c.autoplay=!0,o.ontrack=e=>{c.srcObject=e.streams[0]};const l=this.options.mediaStream??await navigator.mediaDevices.getUserMedia({audio:!0});o.addTrack(l.getAudioTracks()[0]),this.options.changePeerConnection&&(o=await this.options.changePeerConnection(o),this.#Y={...this.#Y,peerConnection:o});const d=await o.createOffer();if(await o.setLocalDescription(d),!d.sdp)throw new Error("Failed to create offer");const p={...this._getMergedSessionConfig(a),model:this.currentModel},h=new FormData;h.append("sdp",d.sdp),h.append("session",JSON.stringify(p));const f=await fetch(i,{method:"POST",body:h,headers:{Authorization:`Bearer ${s}`,"X-OpenAI-Agents-SDK":Rp["X-OpenAI-Agents-SDK"]}}),m={type:"answer",sdp:await f.text()};await o.setRemoteDescription(m)}catch(e){this.close(),this._onError(e),r(e)}})}sendEvent(e){if(!this.#Y.dataChannel||"open"!==this.#Y.dataChannel.readyState)throw new Error("WebRTC data channel is not connected. Make sure you call `connect()` before sending events.");this.#Y.dataChannel.send(JSON.stringify(e))}mute(e){this.#te=e,this.#Y.peerConnection&&this.#Y.peerConnection.getSenders().forEach(t=>{t.track&&(t.track.enabled=!e)})}close(){if(this.#Y.dataChannel&&this.#Y.dataChannel.close(),this.#Y.peerConnection){const e=this.#Y.peerConnection;e.getSenders().forEach(e=>{e.track?.stop()}),e.close()}"disconnected"!==this.#Y.status&&(this.#Y={status:"disconnected",peerConnection:void 0,dataChannel:void 0},this.emit("connection_change",this.#Y.status),this._onClose())}interrupt(){this.#ee&&(this.sendEvent({type:"response.cancel"}),this.#ee=!1),this.sendEvent({type:"output_audio_buffer.clear"})}}const Zh=globalThis.WebSocket;class Fh extends Mh{#K;#X;#Y={status:"disconnected",websocket:void 0};#Q;#ne;#se;_firstAudioTimestamp;_audioLengthMs=0;#ee=!1;constructor(e={}){super(e),this.#X=e.url,this.#Q=e.useInsecureApiKey??!1}get status(){return this.#Y.status}get connectionState(){return this.#Y}get muted(){return null}get currentItemId(){return this.#ne}_onAudio(e){this.emit("audio",e)}#re(e,t,n){if(this.#Y.websocket)return void e();if(!this.#K)throw new Vt("API key is not set. Please call `connect()` with an API key first.");if(!this.#K.startsWith("ek_")&&!this.#Q)throw new Vt("Using the WebSocket connection in a browser environment requires an ephemeral client key. If you have to use a regular API key, set the `useInsecureApiKey` option to true.");const s=["realtime","openai-insecure-api-key."+this.#K,"openai-beta.realtime-v1",Pp],r=new Zh(this.#X,s);this.#Y={status:"connecting",websocket:r},this.emit("connection_change",this.#Y.status),r.addEventListener("open",()=>{this.#Y={status:"connected",websocket:r},this.emit("connection_change",this.#Y.status),this._onOpen(),e()}),r.addEventListener("error",e=>{this._onError(e),this.#Y={status:"disconnected",websocket:void 0},this.emit("connection_change",this.#Y.status),t(e)}),r.addEventListener("message",e=>{this._onMessage(e);const{data:t,isGeneric:s}=$h(e);if(t&&!s)if("response.audio.delta"===t.type){this.#se=t.content_index,this.#ne=t.item_id,void 0===this._firstAudioTimestamp&&(this._firstAudioTimestamp=Date.now(),this._audioLengthMs=0);const e=Ap(t.delta);(this._rawSessionConfig?.output_audio_format??"pcm16").startsWith("g711_")?this._audioLengthMs+=e.byteLength/8:this._audioLengthMs+=e.byteLength/24/2;const n={type:"audio",data:e,responseId:t.response_id};this._onAudio(n)}else if("input_audio_buffer.speech_started"===t.type){const e=this._rawSessionConfig?.turn_detection?.interrupt_response??!1;this.interrupt(!e)}else"response.created"===t.type?this.#ee=!0:"response.done"===t.type?this.#ee=!1:"session.created"===t.type&&(this._tracingConfig=t.session.tracing,this._updateTracingConfig(n.tracing??"auto"))}),r.addEventListener("close",()=>{this.#Y={status:"disconnected",websocket:void 0},this.emit("connection_change",this.#Y.status),this._onClose()})}async connect(e){const t=e.model??this.currentModel;this.currentModel=t,this.#K=await this._getApiKey(e);const n=e.url??this.#X??`wss://api.openai.com/v1/realtime?model=${this.currentModel}`;this.#X=n;const s={...e.initialSessionConfig||{},model:this.currentModel};await new Promise((e,t)=>{try{this.#re(e,t,s)}catch(e){t(e)}}),await this.updateSessionConfig(s)}sendEvent(e){if(!this.#Y.websocket)throw new Error("WebSocket is not connected. Make sure you call `connect()` before sending events.");this.#Y.websocket.send(JSON.stringify(e))}close(){this.#Y.websocket?.close(),this.#ne=void 0,this._firstAudioTimestamp=void 0,this._audioLengthMs=0,this.#se=void 0}mute(e){throw new Error("Mute is not supported for the WebSocket transport. You have to mute the audio input yourself.")}sendAudio(e,t={}){"connected"===this.#Y.status&&super.sendAudio(e,t)}_cancelResponse(){this.#ee&&(this.sendEvent({type:"response.cancel"}),this.#ee=!1)}_interrupt(e,t=!0){if(e<0)return;t&&this._cancelResponse();const n=this._audioLengthMs??Number.POSITIVE_INFINITY,s=Math.max(0,Math.min(Math.floor(e),n));this.emit("audio_interrupted"),this.sendEvent({type:"conversation.item.truncate",item_id:this.#ne,content_index:this.#se,audio_end_ms:s})}interrupt(e=!0){if(!this.#ne||"number"!=typeof this._firstAudioTimestamp)return;const t=Date.now()-this._firstAudioTimestamp;t>=0&&this._interrupt(t,e),this.#ne=void 0,this._firstAudioTimestamp=void 0,this._audioLengthMs=0,this.#se=void 0}}class Uh extends Ar{initialAgent;options;#ae;#ie;#oe=[];#ue;#ce=[];#le;#de={};#pe=[];#he;#fe={};#me=!1;#ge=null;constructor(e,t={}){super(),this.initialAgent=e,this.options=t,void 0===t.transport&&"undefined"!=typeof window&&void 0!==window.RTCPeerConnection||"webrtc"===t.transport?this.#ae=new Lh:"websocket"===t.transport||void 0===t.transport?this.#ae=new Fh:this.#ae=t.transport,this.#ie=e,this.#ue=new Ri({...t.context??{},history:this.#pe}),this.#ce=(t.outputGuardrails??[]).map($p),this.#le={debounceTextLength:(t.outputGuardrailSettings??{}).debounceTextLength??100},this.#he=t.historyStoreAudio??!1}get transport(){return this.#ae}get currentAgent(){return this.#ie}get usage(){return this.#ue.usage}get context(){return this.#ue}get muted(){return this.#ae.muted}get history(){return this.#pe}async#ye(e){this.#ie=e;const t=this.#ie.handoffs.map(qa).map(e=>e.getHandoffAsFunctionTool()),n=await this.#ie.getAllTools(this.#ue);this.#oe=[...n.filter(e=>"function"===e.type),...t]}async#_e(e={}){const t=await this.#ie.getSystemPrompt(this.#ue),n=this.options.tracingDisabled?null:this.options.workflowName?{workflow_name:this.options.workflowName}:"auto";null!==n&&"auto"!==n?(this.options.groupId&&(n.group_id=this.options.groupId),this.options.traceMetadata&&(n.metadata=this.options.traceMetadata)):(this.options.groupId||this.options.traceMetadata)&&Dp.warn("In order to set traceMetadata or a groupId you need to specify a workflowName.");const s={...{...this.#ge??{},...this.options.config??{},...e??{}},instructions:t,voice:this.#ie.voice,model:this.options.model,tools:this.#oe,tracing:n};return this.#ge=s,s}async updateAgent(e){return this.#ie.emit("agent_handoff",this.#ue,e),this.emit("agent_handoff",this.#ue,this.#ie,e),await this.#ye(e),await this.#ae.updateSessionConfig(await this.#_e()),e}async#ve(e,t){const n=await t.onInvokeHandoff(this.#ue,e.arguments);this.#ie.emit("agent_handoff",this.#ue,n),this.emit("agent_handoff",this.#ue,this.#ie,n),await this.#ye(n),await this.#ae.updateSessionConfig(await this.#_e());const s=Fa(n);return this.#ae.sendFunctionCallOutput(e,s,!0),n}async#we(e,t){this.#ue.context.history=JSON.parse(JSON.stringify(this.#pe));let n=e.arguments;if(t.parameters&&(n=tn(t.parameters)?t.parameters.parse(n):JSON.parse(n)),await t.needsApproval(this.#ue,n,e.callId)){const n=this.context.isToolApproved({toolName:t.name,callId:e.callId});if(!1===n){this.emit("agent_tool_start",this.#ue,this.#ie,t,{toolCall:e}),this.#ie.emit("agent_tool_start",this.#ue,t,{toolCall:e});const n="Tool execution was not approved.";return this.#ae.sendFunctionCallOutput(e,n,!0),this.emit("agent_tool_end",this.#ue,this.#ie,t,n,{toolCall:e}),void this.#ie.emit("agent_tool_end",this.#ue,t,n,{toolCall:e})}if(void 0===n)return void this.emit("tool_approval_requested",this.#ue,this.#ie,{type:"function_approval",tool:t,approvalItem:new zi(e,this.#ie)})}this.emit("agent_tool_start",this.#ue,this.#ie,t,{toolCall:e}),this.#ie.emit("agent_tool_start",this.#ue,t,{toolCall:e}),this.#ue.context.history=JSON.parse(JSON.stringify(this.#pe));const s=mn(await t.invoke(this.#ue,e.arguments));this.#ae.sendFunctionCallOutput(e,s,!0),this.emit("agent_tool_end",this.#ue,this.#ie,t,s,{toolCall:e}),this.#ie.emit("agent_tool_end",this.#ue,t,s,{toolCall:e})}async#be(e){const t=new Map(this.#ie.handoffs.map(qa).map(e=>[e.toolName,e])),n=await this.#ie.getAllTools(this.#ue),s=new Map(n.map(e=>[e.name,e])),r=t.get(e.name);if(r)await this.#ve(e,r);else{const t=s.get(e.name);if(!t||"function"!==t.type)throw new Ht(`Tool ${e.name} not found`);await this.#we(e,t)}}async#Z(e,t,n){if(0===this.#ce.length)return;const s={agent:this.#ie,agentOutput:e,context:this.#ue},r=(await Promise.all(this.#ce.map(e=>e.run(s)))).find(e=>e.output.tripwireTriggered);if(r){if(this.#fe[t])return;this.#fe[t]=!0;const e=new en(`Output guardrail triggered: ${JSON.stringify(r.output.outputInfo)}`,r);this.emit("guardrail_tripped",this.#ue,this.#ie,e,{itemId:n}),this.interrupt();const s=`\n Your last answer was blocked. \nFailed Guardrail Reason: ${(a=r).guardrail.policyHint}. \nFailure Details: ${JSON.stringify(a.output.outputInfo??{})}. \nPlease respond again following policy. Apologize for not being able to answer the question (while avoiding the specific reason) and divert discussion back to an approved topic immediately and not invite more discussion.\n`.trim();return void this.sendMessage(s)}var a}#xe(){this.#ae.on("*",e=>{if(this.emit("transport_event",e),"conversation.item.input_audio_transcription.completed"===e.type)try{const t=e;this.#pe=Ep(this.#pe,t,this.#he),this.#ue.context.history=this.#pe,this.emit("history_updated",this.#pe)}catch(e){this.emit("error",{type:"error",error:e})}}),this.#ae.on("audio",e=>{this.#me||(this.#me=!0,this.emit("audio_start",this.#ue,this.#ie)),this.emit("audio",e)}),this.#ae.on("turn_started",()=>{this.#me=!1,this.emit("agent_start",this.#ue,this.#ie),this.#ie.emit("agent_start",this.#ue,this.#ie)}),this.#ae.on("turn_done",e=>{const t=e.response.output[e.response.output.length-1],n=Cp(t)??"",s=t?.id??"";this.emit("agent_end",this.#ue,this.#ie,n),this.#ie.emit("agent_end",this.#ue,n),this.#Z(n,e.response.id,s)}),this.#ae.on("audio_done",()=>{this.#me&&(this.#me=!1),this.emit("audio_stopped",this.#ue,this.#ie)});let e,t=0;this.#ae.on("audio_transcript_delta",n=>{try{const s=n.delta,r=n.itemId,a=n.responseId;e!==r&&(e=r,t=0);const i=(this.#de[r]??"")+s;if(this.#de[r]=i,this.#le.debounceTextLength<0)return;const o=Math.floor(i.length/this.#le.debounceTextLength);o>t&&(t=o,this.#Z(i,a,r))}catch(e){this.emit("error",{type:"error",error:e})}}),this.#ae.on("item_update",e=>{try{const t=!this.#pe.some(t=>t.itemId===e.itemId);if(this.#pe=Ep(this.#pe,e,this.#he),this.#ue.context.history=this.#pe,t){const t=this.#pe.find(t=>t.itemId===e.itemId);t&&this.emit("history_added",t)}this.emit("history_updated",this.#pe)}catch(e){this.emit("error",{type:"error",error:e})}}),this.#ae.on("item_deleted",e=>{try{this.#pe=this.#pe.filter(t=>t.itemId!==e.itemId),this.#ue.context.history=this.#pe,this.emit("history_updated",this.#pe)}catch(e){this.emit("error",{type:"error",error:e})}}),this.#ae.on("function_call",async e=>{try{await this.#be(e)}catch(e){Dp.error("Error handling function call",e),this.emit("error",{type:"error",error:e})}}),this.#ae.on("usage_update",e=>{this.#ue.usage.add(e)}),this.#ae.on("audio_interrupted",()=>{this.#me&&(this.#me=!1),this.emit("audio_interrupted",this.#ue,this.#ie)}),this.#ae.on("error",e=>{this.emit("error",e)})}async connect(e){await this.#ye(this.initialAgent),this.#xe(),await this.#ae.connect({apiKey:e.apiKey??this.options.apiKey,model:this.options.model,url:e.url,initialSessionConfig:await this.#_e(this.options.config)}),this.#pe=[],this.emit("history_updated",this.#pe)}updateHistory(e){let t;t="function"==typeof e?e(this.#pe):e,this.#ae.resetHistory(this.#pe,t)}sendMessage(e,t={}){this.#ae.sendMessage(e,t)}mute(e){this.#ae.mute(e)}close(){this.#fe={},this.#ae.close()}sendAudio(e,t={}){this.#ae.sendAudio(e,t)}interrupt(){this.#ae.interrupt()}async approve(e,t={alwaysApprove:!1}){this.#ue.approveTool(e,t);const n=this.#ie.tools.find(t=>t.name===e.rawItem.name);if(!n||"function"!==n.type||"function_call"!==e.rawItem.type)throw new Ht(`Tool ${e.rawItem.name} not found`);await this.#we(e.rawItem,n)}async reject(e,t={alwaysReject:!1}){this.#ue.rejectTool(e,t);const n=this.#ie.tools.find(t=>t.name===e.rawItem.name);if(!n||"function"!==n.type||"function_call"!==e.rawItem.type)throw new Ht(`Tool ${e.rawItem.name} not found`);await this.#we(e.rawItem,n)}}const Bh={base64ToArrayBuffer:Ap,arrayBufferToBase64:Ip,getLastTextFromAudioOutputMessage:Cp};Ja(new xp),kp()})(),s})());