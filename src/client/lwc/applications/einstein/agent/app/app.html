<template>
    <template lwc:if={hasError}>
        <slds-information-block class="slds-p-around_x-small" title={error_title} variant="error">
            <p>{error_message}</p>
        </slds-information-block>
    </template>
    <div class="assistant-container slds-fill-height slds-is-relative">
        <!-- Prompt Result -->
        <section role="log" class="slds-chat slds-fill-height">
            <div class="slds-grid slds-wrap slds-grid_align-center">
                <div class="slds-col slds-size_1-of-1">
                    <ul class="slds-chat-list">
                        <!-- Welcome message -->
                        <agent-message item={welcomeMessage}></agent-message>
                        <!-- Messages -->
                        <template for:each={messages} for:item="item">
                            <agent-message
                                key={item.key}
                                item={item}
                            ></agent-message>
                        </template>
                        <template lwc:if={currentMessage}>
                            <!-- Current message displayed alone to improve performances -->
                            <agent-message class="chat-item" item={currentMessage} is-current-message></agent-message>
                        </template>
                        <template lwc:if={isLoading}>
                            <li class="slds-chat-listitem slds-chat-listitem_inbound chat-item">
                                <div class="slds-chat-message">
                                    <div class="slds-chat-message__body">
                                        <div
                                            class="slds-chat-message__text slds-chat-message__text_inbound slds-chat-loading">
                                            <span
                                                class="slds-icon-typing slds-is-animated"
                                                title="Analyzing your request">
                                                <span class="slds-icon-typing__dot"></span>
                                                <span class="slds-icon-typing__dot"></span>
                                                <span class="slds-icon-typing__dot"></span>
                                                <span class="slds-assistive-text">
                                                    Analyzing your request
                                                </span>
                                            </span>
                                            <span aria-hidden="true">Analyzing your request</span>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </template>
                    </ul>
                </div>
            </div>
        </section>
        <!-- Prompt Entry -->
        <agent-publisher
            is-audio-recorder-disabled={isAudioRecorderDisabled}
            openai-key={openaiKey}
            onsend={handleSendClick}
            onstop={handleStopClick}
            onclear={handleClearClick}
            is-loading={isStreaming}
        ></agent-publisher>
    </div>
</template>
