<template>
    <div class="slds-publisher slds-is-active slds-p-left_small slds-p-right_small slds-p-bottom_x-small">
        <div class="slds-grid slds-wrap slds-grid_align-center">
            <div class="slds-col slds-size_1-of-1">
                <!--<label for="comment-text-input2" class="slds-publisher__toggle-visibility slds-m-bottom_small">To: Assistant </label>-->
                <div class="chat-input-container file-upload-container" ondragover={handleDragOver} ondragleave={handleDragLeave} ondrop={handleDrop}>
                    <div class="chat-input-pills-row">
                        <template lwc:if={hasFiles}>
                            <template for:each={filePills} for:item="pill">
                                <div key={pill.file.name} class="chat-pill" tabindex="0" aria-label={pill.file.name}>
                                    <template lwc:if={pill.isImage}>
                                        <img src={pill.preview} alt="Image preview" class="chat-pill-thumbnail" />
                                        <span>Image</span>
                                    </template>
                                    <template lwc:else>
                                        <span class="chat-pill-icon">ðŸ“Ž</span>
                                        <span>{pill.file.name}</span>
                                    </template>
                                    <button class="chat-pill-remove" title="Remove file" aria-label="Remove file" data-filename={pill.file.name} onclick={removeSelectedFile} tabindex="0">Ã—</button>
                                </div>
                            </template>
                        </template>
                    </div>
                    <textarea
                        id="comment-text-input2"
                        class="chat-textarea"
                        placeholder="Write a promptâ€¦"
                        onkeydown={handleKeyDown}
                        onkeyup={handleInputChange}
                        onpaste={handleInputChange}
                        disabled={isLoading}
                        aria-label="Prompt input"
                    ></textarea>
                    <div class="chat-input-actions-row">
                        <div class="chat-input-actions-left">
                            <template lwc:if={isAudioRecorderDisplayed}>
                                <agent-audio-recorder
                                    openai-key={openaiKey}
                                    onchange={handleSpeechChange}
                                ></agent-audio-recorder>
                            </template>
                        </div>
                        <div class="chat-input-actions-right">
                            <button class="chat-btn" title="Attach File" aria-label="Attach File" onclick={triggerFileInput} tabindex="0" disabled={isLoading}>
                                <lightning-icon icon-name="utility:attach" size="x-small" alternative-text="Attach File"></lightning-icon>
                            </button>
                            <button class="chat-btn" title="Clear" aria-label="Clear" onclick={handleClearClick} tabindex="0" disabled={isClearButtonDisabled}>
                                <lightning-icon icon-name="utility:delete" size="x-small" alternative-text="Clear"></lightning-icon>
                            </button>
                            <template lwc:if={isLoading}>
                                <button class="chat-btn" title="Stop" aria-label="Stop" onclick={handleStopClick} tabindex="0">
                                    <lightning-icon icon-name="utility:stop" size="x-small" alternative-text="Stop"></lightning-icon>
                                </button>
                            </template>
                            <template lwc:else>
                                <button class="chat-btn" title="Send" aria-label="Send" onclick={handleSendClick} tabindex="0">
                                    <lightning-icon icon-name="utility:send" size="x-small" alternative-text="Send"></lightning-icon>
                                </button>
                            </template>
                        </div>
                        <input type="file" class="file-input" onchange={handleFileChange} aria-label="File input" tabindex="-1" multiple />
                    </div>
                    <template lwc:if={dragActive}>
                        <div class="file-upload-drag-overlay">Drop images or PDFs here</div>
                    </template>
                </div>
                <!-- <div class="slds-publisher__actions slds-grid slds-grid_align-spread">
                    <ul class="slds-grid slds-publisher__toggle-visibility">
                        <li lwc:if={isAudioRecorderDisplayed}>
                            <agent-audio-recorder
                                openai-key={openaiKey}
                                onchange={handleSpeechChange}
                            ></agent-audio-recorder>
                        </li>
                    </ul>
                    <div>
                        <lightning-button
                            label="Clear Dialog"
                            onclick={handleClearClick}
                            disabled={isClearButtonDisabled}
                        ></lightning-button>
                        <lightning-button
                            label="Send"
                            onclick={handleSendClick}
                            disabled={isSendButtonDisabled}
                            class="slds-p-left_x-small"
                            variant="brand"
                        ></lightning-button>
                    </div>
                </div> -->
            </div>
        </div>
    </div>
</template>